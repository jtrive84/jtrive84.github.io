<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>The Pleasure of Finding Things Out: A blog by James Triveri</title>
<link>https://www.jtrive.com/#category=Statistical%20Modeling</link>
<atom:link href="https://www.jtrive.com/index-statistical modeling.xml" rel="self" type="application/rss+xml"/>
<description>A technical blog by James Triveri&quot;</description>
<generator>quarto-1.5.57</generator>
<lastBuildDate>Thu, 26 Sep 2024 05:00:00 GMT</lastBuildDate>
<item>
  <title>Generating Correlated Boostrap Reserve Estimates</title>
  <link>https://www.jtrive.com/posts/correl-reserves-r/correl-reserves-r.html</link>
  <description><![CDATA[ 





<p>In this post, a technique to estimate total reserves accounting for correlation between lines of business is introduced. We focus on workers compensation, commercial auto, product liability and other liability data sourced from the CAS Loss Reserves Database. We’ll demonstrate how to account for correlation between lines, and show how changes to the correlation assumption affects the total reserve estimate.</p>
<p>The <a href="https://www.casact.org/publications-research/research/research-resources/loss-reserving-data-pulled-naic-schedule-p">CAS Loss Reserves Database</a> represents a set of triangles intended for use in claims reserving studies. The data includes major personal and commercial lines of business from U.S. property casualty insurers. The claims data comes from Schedule P in the National Association of Insurance Commissioners (NAIC) database. NAIC Schedule P contains information on claims for major personal and commercial lines for all P&amp;C insurers that write business in US.</p>
<p>The data can be downloaded from the CAS website directly using data.table’s <code>fread</code>. We perform some preprocessing to normalize column names and assign like columns the same name in each table.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.table"</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreach"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ChainLadder"</span>)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6">DF1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www.casact.org/sites/default/files/2021-04/wkcomp_pos.csv"</span>)   <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># workers compensation</span></span>
<span id="cb1-7">DF2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www.casact.org/sites/default/files/2021-04/comauto_pos.csv"</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># commercial auto</span></span>
<span id="cb1-8">DF3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www.casact.org/sites/default/files/2021-04/prodliab_pos.csv"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># product liability</span></span>
<span id="cb1-9">DF4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fread</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://www.casact.org/sites/default/files/2021-04/othliab_pos.csv"</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># other liability</span></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(DF1) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(DF1))</span>
<span id="cb1-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(DF2) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(DF2))</span>
<span id="cb1-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(DF3) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(DF3))</span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(DF4) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(DF4))</span>
<span id="cb1-15"></span>
<span id="cb1-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setnames</span>(</span>
<span id="cb1-17">    DF1, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"incurloss_d"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bulkloss_d"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accidentyear"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"developmentlag"</span>),</span>
<span id="cb1-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"incurloss"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bulkloss"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"origin"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dev"</span>)</span>
<span id="cb1-19">    )</span>
<span id="cb1-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setnames</span>(</span>
<span id="cb1-21">    DF2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"incurloss_c"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bulkloss_c"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accidentyear"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"developmentlag"</span>),</span>
<span id="cb1-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"incurloss"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bulkloss"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"origin"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dev"</span>)</span>
<span id="cb1-23">    )</span>
<span id="cb1-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setnames</span>(</span>
<span id="cb1-25">    DF3, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"incurloss_r1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bulkloss_r1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accidentyear"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"developmentlag"</span>),</span>
<span id="cb1-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"incurloss"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bulkloss"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"origin"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dev"</span>)</span>
<span id="cb1-27">    )</span>
<span id="cb1-28"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setnames</span>(</span>
<span id="cb1-29">    DF4, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"incurloss_h1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bulkloss_h1"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"accidentyear"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"developmentlag"</span>),</span>
<span id="cb1-30">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"incurloss"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bulkloss"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"origin"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dev"</span>)</span>
<span id="cb1-31">    )</span>
<span id="cb1-32"></span>
<span id="cb1-33">dfList <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">wkcomp=</span>DF1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">comauto=</span>DF2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prodliab=</span>DF3, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">othliab=</span>DF4) </span></code></pre></div>
<p><br></p>
<p>Each dataset contains loss data indexed by grcode, which is a company id. We need to find a company with losses in DF1, DF2, DF3 and DF4. This can be accomplished with the following:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">grcodes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Reduce</span>(</span>
<span id="cb2-2">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(v1, v2) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">intersect</span>(v1, v2),</span>
<span id="cb2-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(dfList, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(DF) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(DF[,grcode]))</span>
<span id="cb2-4">    )</span>
<span id="cb2-5">grnamesDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(</span>
<span id="cb2-6">    DF1[grcode <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> grcodes, .(grcode, grname)]</span>
<span id="cb2-7">    )</span>
<span id="cb2-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setorderv</span>(grnamesDF, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grcode"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span></code></pre></div>
<p><br></p>
<p>Which yields:</p>
<pre class="text"><code>    grcode                              grname
 1:    337                  California Cas Grp
 2:    715               West Bend Mut Ins Grp
 3:   1066                  Island Ins Cos Grp
 4:   1538              Farmers Automobile Grp
 5:   1767                  State Farm Mut Grp
 6:   2143   Farmers Alliance Mut &amp; Affiliates
 7:   5185                    Grinnell Mut Grp
 8:   7080        New Jersey Manufacturers Grp
 9:   9466                      Lumber Ins Cos
10:  10048    Hyundai Marine &amp; Fire Ins Co Ltd
11:  11126 Yasuda Fire &amp; Marine Ins Co Of Amer
12:  13439                 Partners Mut Ins Co
13:  13528              Brotherhood Mut Ins Co
14:  13587                  Chicago Mut Ins Co
15:  14044                Goodville Mut Cas Co
16:  14257                      IMT Ins Co Mut
17:  14370                  Lebanon Mut Ins Co
18:  14508         Michigan Millers Mut Ins Co
19:  15024                Preferred Mut Ins Co
20:  18791                 Virginia Mut Ins Co
21:  23663            National American Ins Co
22:  26433                   Harco Natl Ins Co
23:  28258             Continental Natl Ind Co
24:  35408                  Sirius Amer Ins Co
25:  38300    Samsung Fire &amp; Marine Ins Co Ltd
26:  38733                   Alaska Nat Ins Co
27:  44091 Dowa Fire &amp; Marine Ins Co Ltd Us Br
    grcode                              grname</code></pre>
<p><br></p>
<p>Let’s go with <strong>1767</strong>, which represents State Farm. In the next code block, we subset each data.table to only those records with <code>grcode=="1767"</code>, then create runoff triangles for each line of business:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">GRCODE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1767</span> </span>
<span id="cb4-2">grList <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(dfList, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(DF) DF[grcode<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>GRCODE,])</span>
<span id="cb4-3"></span>
<span id="cb4-4">triData <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(</span>
<span id="cb4-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ii=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(grList), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.inorder=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.errorhandling=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stop"</span>,</span>
<span id="cb4-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.final=</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(ll) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setNames</span>(ll, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(grList))</span>
<span id="cb4-7">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%do%</span> {</span>
<span id="cb4-8">    currLOB <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(grList)[[ii]]</span>
<span id="cb4-9">    DFInit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> grList[[ii]]</span>
<span id="cb4-10">    DF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> DFInit[dev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(origin) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> origin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]</span>
<span id="cb4-11">    DF[,value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span>incurloss <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> bulkloss]</span>
<span id="cb4-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.triangle</span>(DF[,.(origin, dev, value)])</span>
<span id="cb4-13">}</span></code></pre></div>
<p><br></p>
<p>Triangles for each lob are presented below:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> triData</span>
<span id="cb5-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>wkcomp</span>
<span id="cb5-3">      dev</span>
<span id="cb5-4">origin      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb5-5">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1988</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50758</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">94150</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">106804</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">113733</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120148</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123986</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127650</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128622</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">129791</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">130625</span></span>
<span id="cb5-6">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65423</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110204</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">131509</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">140383</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">147011</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150266</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">152264</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">155017</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">155979</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-7">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">68719</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">141501</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">165694</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181789</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">189149</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">194315</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">196897</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">201780</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-8">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1991</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">82409</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">165813</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">199016</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">213698</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">222994</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">229774</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">232413</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-9">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97138</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">183451</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">208163</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220275</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">227404</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">234320</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-10">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1993</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">106508</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">167688</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">195533</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212777</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220063</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-11">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1994</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">93736</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">141067</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160848</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">173457</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-12">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">81309</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">116739</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">135447</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-13">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1996</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">66073</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">92365</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-14">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1997</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">56003</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-15"></span>
<span id="cb5-16"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>prodliab</span>
<span id="cb5-17">      dev</span>
<span id="cb5-18">origin   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb5-19">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1988</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">696</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">737</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">881</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1002</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1379</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1451</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1741</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1814</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1818</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1850</span></span>
<span id="cb5-20">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">428</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">351</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">617</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">718</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">761</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">788</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">797</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">802</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">804</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-21">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">77</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">92</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">135</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">197</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">235</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">250</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">263</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-22">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1991</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">121</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">140</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">141</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">172</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">189</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">190</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-23">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">109</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">101</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">107</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">131</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">130</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-24">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1993</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">119</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">133</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">211</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">278</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-25">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1994</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-26">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">57</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">53</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">54</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-27">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1996</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-28">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1997</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-29"></span>
<span id="cb5-30"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>comauto</span>
<span id="cb5-31">      dev</span>
<span id="cb5-32">origin      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb5-33">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1988</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">110231</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">152848</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168137</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">180062</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">186150</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">188142</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">189352</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">191307</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">191867</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">194000</span></span>
<span id="cb5-34">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">121678</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">158218</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">176744</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">188127</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">192966</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">196104</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">199178</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">199655</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200949</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-35">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123376</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">175239</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">201955</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">214113</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">219988</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">223308</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">225841</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226373</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-36">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1991</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">117457</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">162601</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">183338</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">198607</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">203398</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">205870</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">206957</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-37">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">124611</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">166788</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">189771</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">201033</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">206826</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">212361</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-38">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1993</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">137902</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">185952</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">209357</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">220428</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226541</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-39">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1994</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150582</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">194528</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">216205</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">231077</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-40">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150511</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">194730</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">215037</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-41">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1996</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">142301</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">184283</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-42">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1997</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">143970</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-43"></span>
<span id="cb5-44"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>othliab</span>
<span id="cb5-45">      dev</span>
<span id="cb5-46">origin     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb5-47">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1988</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22417</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">58806</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">77536</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">103003</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">112976</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120070</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">124641</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">126954</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127444</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128036</span></span>
<span id="cb5-48">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24740</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">55381</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">76543</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">97608</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">113777</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">124341</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">126171</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128952</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">132618</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-49">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1990</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19432</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">63891</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">94243</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">119678</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">124938</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">129990</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">133964</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">133949</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-50">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1991</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25821</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84453</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">136275</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">159204</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">169820</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">172446</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">181744</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-51">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1992</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38377</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">98045</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">138205</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">154554</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">171701</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">177467</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-52">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1993</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">53001</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150478</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">196273</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">224523</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">232681</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-53">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1994</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50848</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">127767</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">187297</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">233255</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-54">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1995</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">59140</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">149648</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">215701</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-55">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1996</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">71637</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">159561</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb5-56">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1997</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">82937</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>     <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span></code></pre></div>
<p><br></p>
<p>Next, for each triangle call the <code>BootChainLadder</code> function (available in the ChainLadder library), running 5000 iterations and retaining only the total IBNR samples (discarding IBNR simulations by accident year). We replace simulated values less than or equal to 1 with 1:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">ibnrSimsDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(</span>
<span id="cb6-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ii=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(triData), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.inorder=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.errorhandling=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stop"</span>,</span>
<span id="cb6-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cbind.data.frame"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.final=</span>setDT</span>
<span id="cb6-4">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%do%</span> {</span>
<span id="cb6-5">    tri <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> triData[[ii]]</span>
<span id="cb6-6">    bcl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">BootChainLadder</span>(tri, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">R=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">process.distr=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>)</span>
<span id="cb6-7">    lobSims <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> bcl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IBNR.Totals</span>
<span id="cb6-8">    lobSims[lobSims<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-9">    lobSims</span>
<span id="cb6-10">}</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set names of each column in simsDataDF to associated LOB.</span></span>
<span id="cb6-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ibnrSimsDF) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(triData)</span></code></pre></div>
<p><br></p>
<p>Inspecting <code>ibnrSimsDF</code> yields:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(ibnrSimsDF)</span>
<span id="cb7-2">     wkcomp prodliab  comauto  othliab</span>
<span id="cb7-3"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">213282.5</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">309.9531</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">207524.1</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">836339.0</span></span>
<span id="cb7-4"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">185281.3</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">453.1356</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">228032.9</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">876116.3</span></span>
<span id="cb7-5"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">178462.7</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">263.7076</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">246759.9</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">633045.5</span></span>
<span id="cb7-6"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">204928.1</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">169.7184</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">246953.0</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">641145.2</span></span>
<span id="cb7-7"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">168382.3</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">408.6908</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">213764.4</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">717701.9</span></span>
<span id="cb7-8"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">158486.8</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">194.0509</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">227606.5</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">711641.2</span></span></code></pre></div>
<p><br></p>
<p><code>ibnrSimsDF</code> contains 5000 rows, with the value in each row representing the total simulated reserve need across all accident years for the lob in question. It is possible to produce histograms of the simulated total IBNR using ggplot2. The code that follows generates a faceted quad-plot of the sampling distribution of total IBNR for each lob, with a vertical dashed red line marking the location of the distribution mean. We first transform <code>ibnrSimsDF</code> into a ggplot2-compatible format (which is <code>ggDF</code>):</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create faceted quad-plot representing sampling distribution of total IBNR.</span></span>
<span id="cb8-2">ggDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> data.table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(</span>
<span id="cb8-3">    ibnrSimsDF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">measure.vars=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ibnrSimsDF), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value.name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ibnr"</span>, </span>
<span id="cb8-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable.name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lob"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable.factor=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb8-5">    )</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add mean.ibnr for huistogram overlay.</span></span>
<span id="cb8-8">ggDF[,mean.ibnr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(ibnr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lob"</span>]</span>
<span id="cb8-9"></span>
<span id="cb8-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(ggDF, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>ibnr)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bins=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-12">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(</span>
<span id="cb8-13">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept=</span>mean.ibnr), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dashed"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-14">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb8-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb8-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb8-18">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb8-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(</span>
<span id="cb8-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">big.mark=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scientific=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb8-21">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb8-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>lob, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>)</span></code></pre></div>
<p><br></p>
<p>Running the code above produces:</p>
<p><img src="https://www.jtrive.com/posts/correl-reserves-r/correlated0.png" class="img-fluid"></p>
<p><br></p>
<section id="quantifying-total-reserve-variability" class="level3">
<h3 class="anchored" data-anchor-id="quantifying-total-reserve-variability">Quantifying Total Reserve Variability</h3>
<p>If all we are trying to do is determine the expected value of the reserve run-off, we can calculate the expected value for each lob separately and add all the expectations together. However, if we are trying to quantify a value other than the mean (such as the 75th percentile), we cannot simply sum across lines of business. If we do so, we will overstate the aggregate reserve need. The only time the sum of each lob’s 75th percentile would be appropriate for the aggregate reserve indication is when all lines are fully correlated with each other, which is highly unlikely.</p>
<p>To account for correlation between lobs, we rely on the rank correlation methodology described in <a href="https://www.casact.org/sites/default/files/database/forum_02fforum_02ff211.pdf"><em>Two Approaches to Calculating Correlated Reserve Indications Across Multiple Lines of Business</em></a>. The methodology is carried out through a two-step process:</p>
<p>In the first step, a stochastic reserving technique is used to generate N possible reserve runoffs from each data triangle being analyzed (this is what we have in <code>ibnrSimsDF</code>). In the second step, a correlation matrix is specified, where individual elements of the correlation matrix describe the association between different pairs of lobs. With the correlation matrix <img src="https://latex.codecogs.com/png.latex?%5CSigma">, carry out the following steps:</p>
<ol type="1">
<li><p>Compute the Cholesky decomposition of <img src="https://latex.codecogs.com/png.latex?%5CSigma">, that is, find the unique lower triangular matrix <img src="https://latex.codecogs.com/png.latex?A"> such that <img src="https://latex.codecogs.com/png.latex?AA%5E%7BT%7D%20=%20%5CSigma">.</p></li>
<li><p>Compute <img src="https://latex.codecogs.com/png.latex?Z%20=%20(z_%7B1%7D,%20%5Cdots,%20z_%7Bn%7D)%5E%7BT%7D">, a vector whose components are <img src="https://latex.codecogs.com/png.latex?n"> independent standard normal variates (for our example, <img src="https://latex.codecogs.com/png.latex?n=5000">.)</p></li>
<li><p>Let <img src="https://latex.codecogs.com/png.latex?X%20=%20%5Cmu%20+%20AZ">. Since <img src="https://latex.codecogs.com/png.latex?Z"> represents independent draws from the standard normal distribution, the value of the mean vector <img src="https://latex.codecogs.com/png.latex?%5Cmu"> is 0. Therefore correlated random draws are obtained by matrix multiplying <img src="https://latex.codecogs.com/png.latex?A"> with <img src="https://latex.codecogs.com/png.latex?Z">.</p></li>
</ol>
<p>For the correlation matrix, we’ll initially assume no correlation between lobs (all off-diagonal elements=0). Later<br>
we’ll compare estimated reserve need as a function of changing correlation.</p>
<p>The correlation matrix can be initialized as follows:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">sigma <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(</span>
<span id="cb9-2">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), </span>
<span id="cb9-3">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb9-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb9-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb9-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, </span>
<span id="cb9-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ibnrSimsDF), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ibnrSimsDF))</span>
<span id="cb9-8">    )</span></code></pre></div>
<p><br></p>
<p>Which looks like the following:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">         wkcomp prodliab comauto othliab</span>
<span id="cb10-2">wkcomp        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-3">prodliab      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-4">comauto       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-5">othliab       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
<p><br></p>
<p>The next code block implements steps 1-3:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">chol</span>(sigma))</span>
<span id="cb11-2">Z <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(A) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(A))</span>
<span id="cb11-3">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Z <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> A</span></code></pre></div>
<p><br></p>
<p>Checking out the first few records of <code>X</code> yields:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(X)</span>
<span id="cb12-2">         wkcomp    prodliab    comauto    othliab</span>
<span id="cb12-3">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2256225</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.66492692</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8239846</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5497317</span></span>
<span id="cb12-4">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,]  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1101583</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.60652201</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9572046</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5200923</span></span>
<span id="cb12-5">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5961369</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.13732270</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5355783</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0622470</span></span>
<span id="cb12-6">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,]  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6863108</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02719480</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1086142</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4941367</span></span>
<span id="cb12-7">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,]  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3918400</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.09805293</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.3412182</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1409186</span></span>
<span id="cb12-8">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,]  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5547157</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.57012447</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1263973</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7135559</span></span></code></pre></div>
<p><br></p>
<p>For each column in X, we need to obtain the rank of each correlated random draw. This can be accomplished by running:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">rankX <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ii=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(X), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cbind"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%do%</span> { <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rank</span>(X[,ii]) }</span>
<span id="cb13-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(rankX) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(sigma)</span></code></pre></div>
<p>Inspecting the first few records from <code>rankX</code> yields:</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(rankX)</span>
<span id="cb14-2">     wkcomp prodliab comauto othliab</span>
<span id="cb14-3">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,]   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2971</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3758</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3975</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">293</span></span>
<span id="cb14-4">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,]   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2751</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3658</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">856</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1493</span></span>
<span id="cb14-5">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,]   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1393</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2759</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">288</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4335</span></span>
<span id="cb14-6">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,]   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3785</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">782</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2746</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1544</span></span>
<span id="cb14-7">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,]   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4619</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2684</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3178</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2221</span></span>
<span id="cb14-8">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,]   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3569</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4687</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2784</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3866</span></span></code></pre></div>
<p><br></p>
<p>To prepare for the rank correlation step, we need to order the total IBNR simulations from smallest to largest within each lob column:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Order total bootstrapped ibnr samples from smallest to largest. </span></span>
<span id="cb15-2">orderedSimsDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(</span>
<span id="cb15-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ii=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ibnrSimsDF)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cbind.data.frame"</span>,</span>
<span id="cb15-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.final=</span>setDT</span>
<span id="cb15-5">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%do%</span> {</span>
<span id="cb15-6">    currLOB <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ibnrSimsDF)[[ii]]</span>
<span id="cb15-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sort</span>(ibnrSimsDF[[currLOB]])</span>
<span id="cb15-8">}</span>
<span id="cb15-9"></span>
<span id="cb15-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(orderedSimsDF) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(ibnrSimsDF)</span></code></pre></div>
<p>Then for each rank in <code>rankX</code>, we lookup the corresponding position-wise element from <code>orderedSimsDF</code>. This ensures that the rank order correlations between lobs are the same as the correlations imposed on the random normal samples. For example, the first row of <code>rankX</code> is:</p>
<pre><code>  wkcomp prodliab  comauto  othliab 
    2971     3758     3975      293 </code></pre>
<p><br></p>
<p>Then using <code>orderedSimsDF</code>, we lookup the 2971st element under wkcomp, the 3758th element under prodliab, the 3975th element under comauto and the 293rd element under othliab. This can be accomplished as follows:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get correlated IBNR samples.</span></span>
<span id="cb17-2">corrIBNR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(</span>
<span id="cb17-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ii=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(orderedSimsDF)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.combine=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cbind"</span></span>
<span id="cb17-4">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%do%</span> {</span>
<span id="cb17-5">    currLOB <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(orderedSimsDF)[[ii]]</span>
<span id="cb17-6">    lobIndx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> rankR[,currLOB]</span>
<span id="cb17-7">    orderedSimsDF[lobIndx, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">get</span>(currLOB)]</span>
<span id="cb17-8">}</span>
<span id="cb17-9"></span>
<span id="cb17-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(corrIBNR) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(orderedSimsDF)</span></code></pre></div>
<p><br></p>
<p>Finally, we sum the correlated samples across lobs, resulting in a vector of values representing the aggregate reserve distribution:</p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">totalIBNR <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(corrIBNR, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MARGIN=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, sum)</span></code></pre></div>
<p><br></p>
<p>Percentiles of the aggregate IBNR distribution can be obtained by calling:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(totalIBNR, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span>))</span>
<span id="cb19-2">       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%       25%</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%       75%</span>       <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span>% </span>
<span id="cb19-3"> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">962340.6</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1107900.3</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1171348.8</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1241553.0</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1428743.0</span> </span></code></pre></div>
<p><br></p>
</section>
<section id="comparing-different-values-of-sigma" class="level3">
<h3 class="anchored" data-anchor-id="comparing-different-values-of-sigma">Comparing different values of <img src="https://latex.codecogs.com/png.latex?%5CSigma"></h3>
<p>We’ve re-run the procedure described in the previous section for 5 different correlation matrices, assuming 0, .25, .50, .75 and .99 off-diagonal correlation, and combined the results into a single data.table <code>qqDF</code>. I then estimated the 1st, 25th, 50th, 75th and 99th percentile of each aggregate reserve distribution and created an exhibit comparing the distribution of each as a function of percentile. The code used to create the exhibit is given below:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ------------------------------------------------------------------------</span></span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Assume qqDF contains  1st, 25th, 50th, 75th and 99th percentile of the</span></span>
<span id="cb20-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># aggregate IBNR distribution for off-diagonal correlation values of </span></span>
<span id="cb20-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 0, .25, .50, .75 and .99. The first few records of qqDF look like:</span></span>
<span id="cb20-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#</span></span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#          rho    x         y</span></span>
<span id="cb20-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       1:  0% 0.00  871243.8</span></span>
<span id="cb20-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       2:  0% 0.25 1107900.3</span></span>
<span id="cb20-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       3:  0% 0.50 1171348.8</span></span>
<span id="cb20-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       4:  0% 0.75 1241553.0</span></span>
<span id="cb20-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#       5:  0% 0.99 1428743.0</span></span>
<span id="cb20-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span></span>
<span id="cb20-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ------------------------------------------------------------------------</span></span>
<span id="cb20-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(qqDF, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>rho), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(</span>
<span id="cb20-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">big.mark=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scientific=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb20-17">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb20-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb20-20">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlim</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb20-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Aggregate reserve distribution by off-diagonal correlation"</span>)</span></code></pre></div>
<p><br></p>
<p>Which produces:</p>
<p><img src="https://www.jtrive.com/posts/correl-reserves-r/correlated1.png" class="img-fluid"></p>
<p><br></p>
<p>By setting <code>xlim(.50, 1)</code>, we can zoom in on the right-hand side of the distribution:</p>
<p><img src="https://www.jtrive.com/posts/correl-reserves-r/correlated2.png" class="img-fluid"></p>
<p><br></p>
<p>We see that around .50 mark on the x-axis, there is essntially no difference between 0% and 25% off-diagonal correlation assumption. However, as we move right along the x-axis, there’s a greater and greater discrepancy. when x=.99, the difference in the estimated total needed reserve is ~50,000, which represents approximately a 5% difference.</p>
<p><strong>A few take-aways:</strong></p>
<ul>
<li><p>If the goal is to determine the expected value of the reserve run-off, the expected value for each lob can be computed separately then added together.</p></li>
<li><p>If the aim is to quantify a value other than the mean such as the 75th percentile, we cannot simply sum across the lines of business, as this is akin to assuming full correlation between lines of business, which is unlikely and will overstate the aggregate reserve need.</p></li>
<li><p>Off-diagonal correlation values do not need to be the same, but the matrix does need to be symmetric (identical values at <img src="https://latex.codecogs.com/png.latex?m_%7Bi,j%7D"> and <img src="https://latex.codecogs.com/png.latex?m_%7Bj,i%7D">).</p></li>
<li><p>See <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2597405">Correlations between insurance lines of business: An illusion or a real phenomenon? Some methodological considerations</a> for further context.</p></li>
</ul>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>Actuarial</category>
  <category>R</category>
  <guid>https://www.jtrive.com/posts/correl-reserves-r/correl-reserves-r.html</guid>
  <pubDate>Thu, 26 Sep 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Introduction to Markov Chain Monte Carlo - The Metropolis-Hastings Algorithm</title>
  <link>https://www.jtrive.com/posts/introduction-to-metropolis-hastings/introduction-to-metropolis-hastings.html</link>
  <description><![CDATA[ 





<p>Markov Chain Monte Carlo (MCMC) is a class of algorithms used to sample from probability distributions when direct sampling is difficult or inefficient. It leverages Markov chains to explore the target distribution and Monte Carlo methods to perform repeated random sampling. MCMC algorithms are widely used in the insurance industry, particularly in areas involving risk assessment, pricing, reserving, and capital modeling. Markov Chain Monte Carlo is an alternative to rejection sampling, which can be inefficient when dealing with high-dimensional probability distributions. MCMC is considered a Bayesian approach to statistical inference since it incorporates both prior knowledge and observed data into the estimation of the posterior distribution.</p>
<p>The <em>Metropolis-Hastings</em> algorithm is a method used to generate a sequence of samples from a probability distribution for which direct sampling might be difficult. It is a particiular variant of MCMC, which approximates a desired distribution by creating a chain of values that resemble samples drawn from that distribution. The algorithm generates a sequence of samples by proposing new candidates and deciding whether to accept or reject them based on a ratio of probabilities from the target distribution.</p>
<p>Before getting into the details of Metropolis-Hastings, a few key definitions:</p>
<p><strong>Likelihood</strong>: <br> The apriori assumption specifying the distribution from which the data are assumed to originate. For example, if we assume losses follow an exponential distribution within unknown parameter <img src="https://latex.codecogs.com/png.latex?%5Ctheta">, this is equivalent to specifying an exponential likelihood. Symbolically, the likelihood is represented as <img src="https://latex.codecogs.com/png.latex?f(x%7C%5Ctheta)">.</p>
<p><strong>Prior</strong>:<br> Sticking with the exponential likelihood example, once we’ve proposed the likelihood, we need to specify a distribution for each parameter of the likelihood. In the case of the exponential there is only a single parameter, <img src="https://latex.codecogs.com/png.latex?%5Ctheta">. Typically when selecting prior distributions, it should have the same domain as the parameter itself. When parameterizing the exponential distribution, we know that <img src="https://latex.codecogs.com/png.latex?0%20%3C%20%5Ctheta%20%3C%20%5Cinfty">, so the prior distribution should be valid on <img src="https://latex.codecogs.com/png.latex?(0,%20%5Cinfty)">. Valid distributions for <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> are gamma, lognormal, pareto, weibull, etc. Invalid distributions would be any discrete distribution or the normal distribution. Symbolically, the prior is represented as <img src="https://latex.codecogs.com/png.latex?f(%5Ctheta)">.</p>
<p><strong>Posterior</strong>: <br> This is the expression which encapsulates the power, simplicity and flexibility of the Bayesian approach and is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BPosterior%7D%20%5Cpropto%20%5Cmathrm%7BLikelihood%7D%20%5Ctimes%20%5Cmathrm%7BPrior%7D%0A"></p>
<p>The posterior is represented as <img src="https://latex.codecogs.com/png.latex?f(%5Ctheta%7Cx)">, so the above expression becomes:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Ctheta%7Cx)%20%5Cpropto%20f(x%7C%5Ctheta)%20f(%5Ctheta).%0A"></p>
<p>We can update the proportionality to direct equality by the inclusion of a normalizing constant, which ensures the expression on the RHS integrates to 1:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Ctheta%7Cx)%20=%20%5Cfrac%7Bf(x%7C%5Ctheta)%20%20f(%5Ctheta)%7D%7Bf(x)%7D.%0A"></p>
<section id="metropolis-hastings-outline" class="level3">
<h3 class="anchored" data-anchor-id="metropolis-hastings-outline">Metropolis-Hastings Outline</h3>
<p>Suppose we have a collection of <img src="https://latex.codecogs.com/png.latex?%5C%7B%5Ctheta%5E%7B(1)%7D,%20%5Cdots%20%5Ctheta%5E%7B(s)%7D%5C%7D">, to which we would like to add a new value <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s+1)%7D">. We generate a sample from our transition kernel <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B*%7D"> which is nearby <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s)%7D">.</p>
<ul>
<li>If <img src="https://latex.codecogs.com/png.latex?f(%5Ctheta%5E%7B*%7D%7Cy)%20%3E%20f(%5Ctheta%5E%7B(s)%7D%7Cy)">, then we should include <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B*%7D"> with probability 1.<br>
</li>
<li>If <img src="https://latex.codecogs.com/png.latex?f(%5Ctheta%5E%7B*%7D%7Cy)%20%3C%20f(%5Ctheta%5E%7B(s)%7D%7Cy)">, we will include <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B*%7D"> with probability determined by the acceptance ratio.</li>
</ul>
<p>For <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B*%7D">, the posterior is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Ctheta%5E%7B*%7D%7Cy)%20%20=%20%5Cfrac%7Bf(y%7C%5Ctheta%5E%7B*%7D)%20f(%5Ctheta%5E%7B*%7D)%7D%7Bf(y)%7D,%0A"></p>
<p>and for <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s)%7D">, the posterior is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Ctheta%5E%7B(s)%7D%7Cy)%20%20=%20%5Cfrac%7Bf(y%7C%5Ctheta%5E%7B(s)%7D)%20f(%5Ctheta%5E%7B(s)%7D)%7D%7Bf(y)%7D.%0A"></p>
<p><br></p>
<p>Next, compute the acceptance ratio, <img src="https://latex.codecogs.com/png.latex?%5Calpha">, as <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7Bf(%5Ctheta%5E%7B*%7D%7Cy)%7D%7Bf(%5Ctheta%5E%7B(s)%7D%7Cy)%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Calpha%20=%20%5Cfrac%7Bf(%5Ctheta%5E%7B*%7D%7Cy)%7D%7Bf(%5Ctheta%5E%7B(s)%7D%7Cy)%7D%20=%20%5Cfrac%7Bf(y%7C%5Ctheta%5E%7B*%7D)%20f(%5Ctheta%5E%7B*%7D)%7D%7Bf(y)%7D%20%5Ctimes%20%5Cfrac%7Bf(y)%7D%7Bf(y%7C%5Ctheta%5E%7B(s)%7D)%20f(%5Ctheta%5E%7B(s)%7D)%7D%20=%20%5Cfrac%7Bf(y%7C%5Ctheta%5E%7B*%7D)%20f(%5Ctheta%5E%7B*%7D)%7D%7Bf(y%7C%5Ctheta%5E%7B(s)%7D)%20f(%5Ctheta%5E%7B(s)%7D)%7D.%0A"> <br></p>
<ul>
<li><p>If <img src="https://latex.codecogs.com/png.latex?%5Calpha"> &gt;= 1: We add <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B*%7D"> to our collection of samples, since it has a higher likelihood than <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s)%7D">. Set <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s%20+%201)%7D%20=%20%5Ctheta%5E%7B*%7D">.</p></li>
<li><p>If <img src="https://latex.codecogs.com/png.latex?%5Calpha"> &lt; 1: Set <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s%20+%201)%7D%20=%20%5Ctheta%5E%7B*%7D"> with probability <img src="https://latex.codecogs.com/png.latex?%5Calpha">.</p></li>
</ul>
<p>Notice that the acceptance ratio is calculated without needing to compute the normalizing constant <img src="https://latex.codecogs.com/png.latex?f(y)">, which can be difficult to do, especially in high-dimensional settings. This is the power of Metropolis-Hastings and MCMC in general: It provides a way to approximate the posterior distribution by generating samples from it without direct calculation of the normalizing constant.</p>
<p><br></p>
<p>Metropolis-Hastings accept-reject logic can be summarized in three steps:</p>
<ol type="1">
<li>Generate sample from proposal distribution / transition kernel <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B*%7D%20%5Csim%20J(%5Ctheta%7C%5Ctheta%5E%7B(s)%7D)">.</li>
<li>Compute acceptance ratio <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%20%5Cfrac%7Bf(y%7C%5Ctheta%5E%7B*%7D)%20f(%5Ctheta%5E%7B*%7D)%7D%7Bf(y%7C%5Ctheta%5E%7B(s)%7D)%20f(%5Ctheta%5E%7B(s)%7D)%7D">.</li>
<li>Sample <img src="https://latex.codecogs.com/png.latex?u%20%5Csim%20%5Cmathrm%7Buniform%7D(0,%201)">.
<ul>
<li>If <img src="https://latex.codecogs.com/png.latex?%5Calpha%20%5Cgeq%20u">, set <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s%20+%201)%7D%20=%20%5Ctheta%5E%7B*%7D">.</li>
<li>If <img src="https://latex.codecogs.com/png.latex?%5Calpha%20%3C%20u">, set <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s%20+%201)%7D%20=%20%5Ctheta%5E%7B(s)%7D">.</li>
</ul></li>
</ol>
<p><br></p>
</section>
<section id="conjugate-priors" class="level3">
<h3 class="anchored" data-anchor-id="conjugate-priors">Conjugate Priors</h3>
<p><a href="(https://en.wikipedia.org/wiki/Conjugate_prior#cite_note-beta_rate-7)">Conjugate priors</a> are a class of prior distributions in Bayesian statistics that result in a posterior distribution that has the same functional form as the prior when combined with a particular likelihood function. This makes the posterior distribution easier to compute and analyze, as it remains within the same family of distributions as the prior. For example, if we select an exponential likelihood with a gamma prior, the posterior distribution is also gamma, with a specified parameterization.</p>
<p>Further, many of these conjugate priors have analytical expressions for the posterior predictive distribution, which represents the modeled target output of our analysis. We can use conjugate prior relationships as a means to validate the output of our MCMC sampler.</p>
<p><br></p>
<p><br></p>
</section>
<section id="example-conjugate-normal-normal-model-with-known-variance" class="level3">
<h3 class="anchored" data-anchor-id="example-conjugate-normal-normal-model-with-known-variance">Example: Conjugate Normal-Normal Model with Known Variance</h3>
<p>Let’s start with a simple example where we assume a model with normal likelihood and prior (adapted from Chapter 10 of <em>A First Course in Bayesian Statistical Methods</em> by Peter Hoff). Assume:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5C%7By_%7B1%7D,%20%5Cdots,%20y_%7Bn%7D%5C%7D%20%5Csim%20%5Cmathcal%7BN%7D(%5Cmu,%20%5Csigma%5E%7B2%7D)">.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cmu%20%5Csim%20%5Cmathcal%7BN%7D(%5Cmu_%7B0%7D,%20%5Csigma%5E%7B2%7D_%7B0%7D)"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D%20=%201"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cmu_%7B0%7D%20=%205"></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D_%7B0%7D%20=%2010"></li>
<li><img src="https://latex.codecogs.com/png.latex?y%20=%20(9.37,%2010.18,%209.16,%2011.60,%2010.33)"></li>
</ul>
<p><br> Because this model is conjugate, we have analytical expressions for the posterior parameters:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmu_%7B0%7D%5E%7B'%7D%20=%20%5Cfrac%7B1%7D%7B%5Cfrac%7B1%7D%7B%5Csigma%5E%7B2%7D_%7B0%7D%7D%20+%20%5Cfrac%7Bn%7D%7B%5Csigma%5E%7B2%7D%7D%7D%20%5CBigg(%5Cfrac%7B%5Cmu_%7B0%7D%7D%7B%5Csigma%5E%7B2%7D_%7B0%7D%7D%20+%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_%7Bi%7D%7D%7B%5Csigma%5E%7B2%7D%7D%20%5CBigg);%20%5Chspace%7B.50em%7D%20%7B%5Csigma%5E%7B2%7D_%7B0%7D%7D%5E%7B'%7D%20=%20%5CBigg(%20%5Cfrac%7B1%7D%7B%5Csigma%5E%7B2%7D_%7B0%7D%7D%20+%20%5Cfrac%7Bn%7D%7B%5Csigma%5E%7B2%7D%7D%20%5CBigg)%5E%7B-1%7D%0A"></p>
<p><br></p>
<p>We can compute these quantities for later reference:</p>
<div id="cell-2" class="cell" data-tags="[]" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute posterior mean and variance using closed-form expressions. </span></span>
<span id="cb1-3">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.37</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.16</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.60</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.33</span>]</span>
<span id="cb1-4">s2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-5">mu_prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb1-6">s2_prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb1-7">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(y)</span>
<span id="cb1-8"></span>
<span id="cb1-9">mu_posterior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> s2_prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> s2)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (mu_prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>  s2_prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(y) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> s2)</span>
<span id="cb1-10">s2_posterior  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> s2_prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> s2)</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"mu_prior     : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu_prior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"s2_prior     : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>s2_prior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"mu_posterior : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu_posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"s2_posterior : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>s2_posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mu_prior     : 5.000
s2_prior     : 10.000
mu_posterior : 10.027
s2_posterior : 0.196</code></pre>
</div>
</div>
<p>The posterior distribution parameter estimates have been updated in the direction of the data. Next imagine a scenario in which closed form expressions for posterior parameters did not exist, and it was necessary to use Metropolis-Hastings to approximate the posterior. The acceptance ratio comparing <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B*%7D"> to <img src="https://latex.codecogs.com/png.latex?%5Ctheta%5E%7B(s)%7D"> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Calpha%20=%20%5Cfrac%7Bf(%5Ctheta%5E%7B*%7D%7Cy)%7D%7Bf(%5Ctheta%5E%7B(s)%7D%7Cy)%7D%20=%20%5CBigg(%5Cfrac%7B%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20%5Cmathrm%7Bdnorm%7D(y_%7Bi%7D,%20%5Ctheta%5E%7B*%7D,%20%5Csigma)%7D%7B%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20%5Cmathrm%7Bdnorm%7D(y_%7Bi%7D,%20%5Ctheta%5E%7B(s)%7D,%20%5Csigma)%7D%5CBigg)%20%5Ctimes%20%5CBigg(%5Cfrac%7B%5Cmathrm%7Bdnorm%7D(%5Ctheta%5E%7B*%7D,%20%5Cmu_%7B0%7D,%20%5Csigma_%7B0%7D)%7D%7B%5Cmathrm%7Bdnorm%7D(%5Ctheta%5E%7B(s)%7D,%20%5Cmu_%7B0%7D,%20%5Csigma_%7B0%7D)%7D%5CBigg).%0A"></p>
<p><br></p>
<p>An implementation of Metropolis-Hastings to recover the posterior mean is provided below.</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Implementation of Metropolis-Hastings algorithm for normal likelihood </span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">and normal prior with known variance.</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Goal is to recover the posterior distribution of the unknown parameter mu. </span></span>
<span id="cb3-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb3-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb3-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb3-8"></span>
<span id="cb3-9">rng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.default_rng(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb3-10"></span>
<span id="cb3-11"></span>
<span id="cb3-12">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.37</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.16</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.60</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.33</span>]</span>
<span id="cb3-13"></span>
<span id="cb3-14">nbr_samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of samples to generate.</span></span>
<span id="cb3-15">s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation of likelihood.</span></span>
<span id="cb3-16">s0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prior standard deviation.</span></span>
<span id="cb3-17">mu0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prior mean.</span></span>
<span id="cb3-18">s_prop <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation of proposal distribution / transition kernel.</span></span>
<span id="cb3-19"></span>
<span id="cb3-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Array to hold posterior samples, initialized with prior mean.</span></span>
<span id="cb3-21">samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(nbr_samples)</span>
<span id="cb3-22"></span>
<span id="cb3-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize prior density.</span></span>
<span id="cb3-24">prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mu0, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>s0)</span>
<span id="cb3-25"></span>
<span id="cb3-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Track the number of accepted samples. </span></span>
<span id="cb3-27">accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb3-28"></span>
<span id="cb3-29"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nbr_samples):</span>
<span id="cb3-30"></span>
<span id="cb3-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get most recently accepted sample.</span></span>
<span id="cb3-32">    theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> samples[ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb3-33"></span>
<span id="cb3-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate sample from proposal distribution.</span></span>
<span id="cb3-35">    theta_star <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>s_prop)</span>
<span id="cb3-36"></span>
<span id="cb3-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute numerator and denominator of acceptance ratio.</span></span>
<span id="cb3-38">    numer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.prod(norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta_star, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>s).pdf(y)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> prior.pdf(theta_star)</span>
<span id="cb3-39">    denom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.prod(norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>s).pdf(y)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> prior.pdf(theta)</span>
<span id="cb3-40">    ar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> numer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> denom</span>
<span id="cb3-41"></span>
<span id="cb3-42">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate random uniform sample.</span></span>
<span id="cb3-43">    u <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.uniform(low<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, high<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-44">    </span>
<span id="cb3-45">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check whether theta_star should be added to samples by comparing ar with u.</span></span>
<span id="cb3-46">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> ar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> u:</span>
<span id="cb3-47">        theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta_star</span>
<span id="cb3-48">        accepted<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-49"></span>
<span id="cb3-50">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update samples array.</span></span>
<span id="cb3-51">    samples[ii] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta</span>
<span id="cb3-52"></span>
<span id="cb3-53">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb3-54">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ii<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: theta_star: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>theta_star<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, ar: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ar<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, curr_rate: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ii<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-55"></span>
<span id="cb3-56">acc_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> nbr_samples</span>
<span id="cb3-57"></span>
<span id="cb3-58"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Acceptance rate     : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>acc_rate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb3-59"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Posterior mean (mh) : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>samples<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb3-60"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Posterior mean (cp) : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu_posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1000: theta_star: 9.35597, ar: 1.08038, curr_rate: 0.24600
2000: theta_star: 13.01504, ar: 0.00000, curr_rate: 0.25900
3000: theta_star: 9.28924, ar: 0.27716, curr_rate: 0.25567
4000: theta_star: 8.22652, ar: 0.00034, curr_rate: 0.26200
5000: theta_star: 6.09725, ar: 0.00000, curr_rate: 0.26440
6000: theta_star: 10.27182, ar: 2.13374, curr_rate: 0.26483
7000: theta_star: 10.73066, ar: 0.30604, curr_rate: 0.26414
8000: theta_star: 12.76409, ar: 0.00000, curr_rate: 0.26637
9000: theta_star: 8.88424, ar: 0.03592, curr_rate: 0.26522

Acceptance rate     : 0.267.
Posterior mean (mh) : 10.03768.
Posterior mean (cp) : 10.02745.</code></pre>
</div>
</div>
<p>Generally the acceptance rate should fall between 20%-40%, so our result seems reasonable, if not a little on the low side.</p>
<p>In the Metropolis-Hastings update step, we compute the product of many potentially small numbers to determine the acceptance ratio, which can be numerically unstable. We can instead compute the log of the RHS of the acceptance ratio, which will result in more stability especially as the number of data points increases. The posterior estimates will be no different, but we reduce the chance of numerical underflow by replacing the product with a sum. The update step using the log basis is given below:</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Implementation of Metropolis-Hastings algorithm for Normal likelihood </span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">and Normal prior with known variance.</span></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Goal is to recover the posterior distribution of the unknown parameter mu. </span></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb5-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb5-8"></span>
<span id="cb5-9">rng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.default_rng(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb5-10"></span>
<span id="cb5-11"></span>
<span id="cb5-12">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.37</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.18</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.16</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.60</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.33</span>]</span>
<span id="cb5-13"></span>
<span id="cb5-14">nbr_samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of samples to generate.</span></span>
<span id="cb5-15">s <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>                <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation of likelihood.</span></span>
<span id="cb5-16">s0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span>          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prior standard deviation.</span></span>
<span id="cb5-17">mu0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>              <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prior mean.</span></span>
<span id="cb5-18">s_prop <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>           <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard deviation of proposal distribution / transition kernel.</span></span>
<span id="cb5-19"></span>
<span id="cb5-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Array to hold posterior samples, initialized with prior mean.</span></span>
<span id="cb5-21">samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(nbr_samples)</span>
<span id="cb5-22"></span>
<span id="cb5-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize prior density.</span></span>
<span id="cb5-24">prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mu0, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>s0)</span>
<span id="cb5-25"></span>
<span id="cb5-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Track the number of accepted samples. </span></span>
<span id="cb5-27">accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-28"></span>
<span id="cb5-29"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nbr_samples):</span>
<span id="cb5-30"></span>
<span id="cb5-31">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get most recently accepted sample.</span></span>
<span id="cb5-32">    theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> samples[ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb5-33"></span>
<span id="cb5-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate sample from proposal distribution.</span></span>
<span id="cb5-35">    theta_star <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>s_prop)</span>
<span id="cb5-36"></span>
<span id="cb5-37">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute numerator and denominator of acceptance ratio using log basis. </span></span>
<span id="cb5-38">    ar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta_star, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>s).logpdf(y)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> prior.logpdf(theta_star)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-\</span></span>
<span id="cb5-39">         (np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>s).logpdf(y)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> prior.logpdf(theta))</span>
<span id="cb5-40"></span>
<span id="cb5-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate random uniform sample.</span></span>
<span id="cb5-42">    u <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.uniform(low<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, high<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-43">    </span>
<span id="cb5-44">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check whether theta_star should be added to samples by comparing a with u.</span></span>
<span id="cb5-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> ar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> np.log(u):</span>
<span id="cb5-46">        theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta_star</span>
<span id="cb5-47">        accepted<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-48"></span>
<span id="cb5-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update samples array.</span></span>
<span id="cb5-50">    samples[ii] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta</span>
<span id="cb5-51"></span>
<span id="cb5-52">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb5-53">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ii<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: theta_star: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>theta_star<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, ar: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ar<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, curr_rate: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ii<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-54"></span>
<span id="cb5-55"></span>
<span id="cb5-56">acc_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> nbr_samples</span>
<span id="cb5-57"></span>
<span id="cb5-58"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Acceptance rate   : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>acc_rate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb5-59"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Posterior mean (mh) : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>samples<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb5-60"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Posterior mean (cp) : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu_posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1000: theta_star: 9.35597, ar: 0.07731, curr_rate: 0.24600
2000: theta_star: 13.01504, ar: -20.59962, curr_rate: 0.25900
3000: theta_star: 9.28924, ar: -1.28315, curr_rate: 0.25567
4000: theta_star: 8.22652, ar: -7.99570, curr_rate: 0.26200
5000: theta_star: 6.09725, ar: -39.02023, curr_rate: 0.26440
6000: theta_star: 10.27182, ar: 0.75788, curr_rate: 0.26483
7000: theta_star: 10.73066, ar: -1.18404, curr_rate: 0.26414
8000: theta_star: 12.76409, ar: -18.37748, curr_rate: 0.26637
9000: theta_star: 8.88424, ar: -3.32637, curr_rate: 0.26522

Acceptance rate   : 0.267.
Posterior mean (mh) : 10.03768.
Posterior mean (cp) : 10.02745.</code></pre>
</div>
</div>
<p>As expected, this aligns with the original non-log basis results.</p>
<p>We can visualize the distribution of posterior samples as well as the traceplot. Traceplots are graphical tools used to diagnose the convergence and mixing of MCMC simulations. They help assess whether the algorithm has properly explored the target distribution and whether the samples are representative of the posterior distribution.</p>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"></span>
<span id="cb7-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mpl</span>
<span id="cb7-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb7-4"></span>
<span id="cb7-5"></span>
<span id="cb7-6">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb7-7"></span>
<span id="cb7-8">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior samples (normal likelihood)"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb7-9">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(</span>
<span id="cb7-10">    samples, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7595"</span>, </span>
<span id="cb7-11">    edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb7-12">    )</span>
<span id="cb7-13">    </span>
<span id="cb7-14">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].axvline(mu_posterior, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\mu^{'}$"</span>)</span>
<span id="cb7-15">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_yticklabels([])</span>
<span id="cb7-16">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb7-17">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb7-18">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_xlim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb7-19">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb7-20">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb7-21">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb7-22">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb7-23">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb7-24">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb7-25">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb7-26">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb7-27">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper right"</span>, fancybox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"small"</span>)</span>
<span id="cb7-28"></span>
<span id="cb7-29">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Traceplot"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb7-30">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].plot(samples, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>)</span>
<span id="cb7-31">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb7-32">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb7-33">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_ylabel(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \mu$"</span>)</span>
<span id="cb7-34">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb7-35">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb7-36">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb7-37">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb7-38"></span>
<span id="cb7-39">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/introduction-to-metropolis-hastings/introduction-to-metropolis-hastings_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Notice in the traceplot that even though we started far from the estimated posterior mean, it made little difference, as the algorithm was able to quickly zero in on the region of higher likelihood. You want to see that the samples have stabilized around a certain value after an initial “burn-in” period. If the trace shows significant fluctuations without settling, it may indicate that the chain has not yet converged. This is not the case with our samples.</p>
<p><br></p>
</section>
<section id="severity-modeling" class="level2">
<h2 class="anchored" data-anchor-id="severity-modeling">Severity Modeling</h2>
<p>MCMC approaches can be leveraged to estimate severity or size-of-loss curves for a given line of business based on past claim history. Severity estimates are used in multiple actuarial contexts, especially reserving and capital modeling. Imagine we have loss data we believe originates from an exponential distribution with unknown rate parameter:</p>
<blockquote class="blockquote">
<p>266, 934, 138</p>
</blockquote>
<p>We again assume a conjugate relationship between prior and posterior distributions:</p>
<ul>
<li><p><strong>Likelihood</strong>: Losses are exponentially distributed with unknown rate <img src="https://latex.codecogs.com/png.latex?%5Clambda">.</p></li>
<li><p><strong>Prior</strong>: Gamma with <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B0%7D">, <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B0%7D">.</p></li>
<li><p><strong>Posterior</strong>: Gamma with <img src="https://latex.codecogs.com/png.latex?%5Calpha%5E%7B'%7D%20=%20%5Calpha_%7B0%7D%20+%20n"> and <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B'%7D%20=%20%5Cbeta_%7B0%7D%20+%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20x_%7Bi%7D">.</p></li>
<li><p><strong>Posterior predictive</strong>: Lomax (shifted Pareto with support beginning at zero) with <img src="https://latex.codecogs.com/png.latex?%5Calpha%5E%7B'%7D,%20%5Cbeta%5E%7B'%7D">. The expected value of the posterior predictive distribution is <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cbeta%5E%7B'%7D%7D%7B%5Calpha%5E%7B'%7D%20-%201%7D">.</p></li>
</ul>
<p>We judgmentally set <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B0%7D%20=%202"> and <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B0%7D%20=%201,000">. Prior and posterior predictive means are computed in the next cell.</p>
<div id="cell-11" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"></span>
<span id="cb8-2">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">266</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">934</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">138</span>]</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Judgmentally select a0 and b0.</span></span>
<span id="cb8-5">a0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb8-6">b0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb8-7">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(y)</span>
<span id="cb8-8">a_posterior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n</span>
<span id="cb8-9">b_posterior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(y)</span>
<span id="cb8-10">prior_mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b0</span>
<span id="cb8-11">post_pred_mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b_posterior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (a_posterior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-12"></span>
<span id="cb8-13"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"a0              : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>a0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"b0              : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>b0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"a_posterior     : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>a_posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb8-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"b_posterior     : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>b_posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb8-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Empirical mean  : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean(y)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Prior mean      : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>prior_mean<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Post. pred. mean: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>post_pred_mean<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a0              : 2
b0              : 1000
a_posterior     : 5.
b_posterior     : 2338.
Empirical mean  : 446.0
Prior mean      : 2000
Post. pred. mean: 584.50</code></pre>
</div>
</div>
<p><br></p>
<p>Using Metropolis-Hastings, the mean of generated samples should match the posterior predictive mean obtained from the analytical expression (584.50 above). Adapting the sampling code from the previous model, an exponential distribution is used to generate proposals, since the exponential scale parameter must be strictly greater than 0. We have the following:</p>
<div id="cell-13" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Implementation of Metropolis-Hastings algorithm for exponential likelihood</span></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">with gamma prior.</span></span>
<span id="cb10-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Goal is to recover the posterior distribution of the unknown parameter lambda. </span></span>
<span id="cb10-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb10-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb10-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> expon, norm, gamma, lomax</span>
<span id="cb10-8"></span>
<span id="cb10-9">rng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.default_rng(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb10-10"></span>
<span id="cb10-11">nbr_samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb10-12">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">266</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">934</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">138</span>]</span>
<span id="cb10-13">a0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb10-14">b0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb10-15"></span>
<span id="cb10-16"></span>
<span id="cb10-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Array to hold posterior samples, initialized with prior mean.</span></span>
<span id="cb10-18">samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(nbr_samples)</span>
<span id="cb10-19">samples[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean(y)</span>
<span id="cb10-20"></span>
<span id="cb10-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize prior density.</span></span>
<span id="cb10-22">prior <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gamma(a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>a0, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>b0)</span>
<span id="cb10-23"></span>
<span id="cb10-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Track the number of accepted samples. </span></span>
<span id="cb10-25">accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb10-26"></span>
<span id="cb10-27"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, nbr_samples):</span>
<span id="cb10-28"></span>
<span id="cb10-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get most recently accepted sample.</span></span>
<span id="cb10-30">    theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> samples[ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb10-31"></span>
<span id="cb10-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate sample from proposal distribution.</span></span>
<span id="cb10-33">    theta_star <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.exponential(scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta)</span>
<span id="cb10-34"></span>
<span id="cb10-35">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute numerator and denominator of acceptance ratio.</span></span>
<span id="cb10-36">    numer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.prod(expon(scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta_star).pdf(y)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> prior.pdf(theta_star)</span>
<span id="cb10-37">    denom <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.prod(expon(scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>theta).pdf(y)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> prior.pdf(theta)</span>
<span id="cb10-38">    ar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> numer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> denom</span>
<span id="cb10-39"></span>
<span id="cb10-40">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate random uniform sample.</span></span>
<span id="cb10-41">    u <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.uniform(low<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, high<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb10-42">    </span>
<span id="cb10-43">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check whether theta_star should be added to samples by comparing ar with u.</span></span>
<span id="cb10-44">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> ar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> u:</span>
<span id="cb10-45">        theta <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta_star</span>
<span id="cb10-46">        accepted<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb10-47"></span>
<span id="cb10-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Update samples array.</span></span>
<span id="cb10-49">    samples[ii] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theta</span>
<span id="cb10-50"></span>
<span id="cb10-51">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb10-52">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ii<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: theta_star: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>theta_star<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, ar: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ar<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, curr_rate: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> ii<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-53"></span>
<span id="cb10-54">acc_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> accepted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> nbr_samples</span>
<span id="cb10-55"></span>
<span id="cb10-56"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">Acceptance rate    : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>acc_rate<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb10-57"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Posterior sample mean: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>samples<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.3f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1000: theta_star: 82.99100, ar: 0.00008, curr_rate: 0.45900
2000: theta_star: 544.00186, ar: 1.07857, curr_rate: 0.46450
3000: theta_star: 246.98682, ar: 0.33871, curr_rate: 0.47433
4000: theta_star: 73.75990, ar: 0.00002, curr_rate: 0.47900
5000: theta_star: 451.83333, ar: 0.97910, curr_rate: 0.47880
6000: theta_star: 607.07687, ar: 1.45090, curr_rate: 0.47833
7000: theta_star: 1509.11070, ar: 0.74937, curr_rate: 0.48186
8000: theta_star: 677.30894, ar: 1.04365, curr_rate: 0.48187
9000: theta_star: 740.90659, ar: 1.58914, curr_rate: 0.48156

Acceptance rate    : 0.481.
Posterior sample mean: 586.353.</code></pre>
</div>
</div>
<p><br></p>
<p>Visualizing the histogram of posterior samples along with the traceplot:</p>
<div id="cell-15" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"></span>
<span id="cb12-2">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb12-3"></span>
<span id="cb12-4">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_title(</span>
<span id="cb12-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior samples (exponential likelihood)"</span>, </span>
<span id="cb12-6">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span></span>
<span id="cb12-7">)</span>
<span id="cb12-8">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].hist(</span>
<span id="cb12-9">    samples, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7595"</span>, </span>
<span id="cb12-10">    edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb12-11">)</span>
<span id="cb12-12">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].axvline(</span>
<span id="cb12-13">    samples.mean(), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, </span>
<span id="cb12-14">    label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posterior mean"</span></span>
<span id="cb12-15">)</span>
<span id="cb12-16"></span>
<span id="cb12-17">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb12-18">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb12-19">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_xlim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2500</span>)</span>
<span id="cb12-20">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb12-21">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb12-22">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb12-23">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb12-24">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb12-25">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb12-26">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb12-27">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb12-28">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb12-29">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper right"</span>, fancybox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span>)</span>
<span id="cb12-30"></span>
<span id="cb12-31">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Traceplot"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb12-32">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].plot(samples, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>)</span>
<span id="cb12-33">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb12-34">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sample"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb12-35">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].set_ylabel(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \beta$"</span>)</span>
<span id="cb12-36">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb12-37">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb12-38">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb12-39">ax[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb12-40"></span>
<span id="cb12-41">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/introduction-to-metropolis-hastings/introduction-to-metropolis-hastings_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The distribution of posterior samples resembles a gamma distribution, which we expect.</p>
<p>Next, to generate posterior predictive samples, we randomly sample from an exponential distribution parameterized using each scale parameter. This is accomplished in the next cell:</p>
<div id="cell-17" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb13-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Generate posterior predictive samples, one random draw per posterior scale sample.</span></span>
<span id="cb13-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb13-4"></span>
<span id="cb13-5">post_pred_samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.exponential(scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>samples)</span>
<span id="cb13-6"></span>
<span id="cb13-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Posterior predictive mean (cp): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>post_pred_mean<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb13-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Posterior predictive mean (mh): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>post_pred_samples<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>mean()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Posterior predictive mean (cp): 584.50000
Posterior predictive mean (mh): 585.71307</code></pre>
</div>
</div>
<p><br></p>
<p>We can overlay the posterior predictive distribution with the histogram of posterior predictive samples and assess how well they match:</p>
<div id="cell-19" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"></span>
<span id="cb15-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mpl</span>
<span id="cb15-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb15-4"></span>
<span id="cb15-5">pp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lomax(c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>a_posterior, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>b_posterior)</span>
<span id="cb15-6">xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, pp.ppf(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.995</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb15-7">yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pp.pdf(xx)</span>
<span id="cb15-8"></span>
<span id="cb15-9"></span>
<span id="cb15-10">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb15-11"></span>
<span id="cb15-12">ax.set_title(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior predictive samples with analytical density"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb15-13"></span>
<span id="cb15-14">ax.hist(</span>
<span id="cb15-15">    post_pred_samples, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7595"</span>, </span>
<span id="cb15-16">    edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior predictive samples"</span></span>
<span id="cb15-17">)</span>
<span id="cb15-18">ax.plot(</span>
<span id="cb15-19">    xx, yy, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, </span>
<span id="cb15-20">    label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\mathrm</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{Lomax}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">($"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>a_posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>b_posterior<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$)$"</span></span>
<span id="cb15-21">)</span>
<span id="cb15-22">ax.axvline(</span>
<span id="cb15-23">    post_pred_mean, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-."</span>, </span>
<span id="cb15-24">    label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posterior preditive mean"</span></span>
<span id="cb15-25">)</span>
<span id="cb15-26"></span>
<span id="cb15-27">ax.set_xlim(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span>)</span>
<span id="cb15-28">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb15-29">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb15-30">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb15-31">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb15-32">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb15-33">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb15-34">ax.xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb15-35">ax.xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb15-36">ax.yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb15-37">ax.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb15-38">ax.set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb15-39">ax.legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper right"</span>, fancybox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span>)</span>
<span id="cb15-40">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/introduction-to-metropolis-hastings/introduction-to-metropolis-hastings_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The plot shows the two distributions align well. Finally, we can compare quantiles of our posterior predictive samples with the analytical density to see how well they agree in the extreme left and right tails:</p>
<div id="cell-21" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"></span>
<span id="cb16-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb16-3"></span>
<span id="cb16-4">q <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.025</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.25</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.50</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.75</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.90</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.95</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.99</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.995</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.999</span>]</span>
<span id="cb16-5"></span>
<span id="cb16-6">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame({</span>
<span id="cb16-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"q"</span>: q,</span>
<span id="cb16-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cp"</span>: pp.ppf(q), </span>
<span id="cb16-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mh"</span>: np.quantile(post_pred_samples, q)</span>
<span id="cb16-10">})</span>
<span id="cb16-11"></span>
<span id="cb16-12">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"error"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cp"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mh"</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cp"</span>] </span>
<span id="cb16-13"></span>
<span id="cb16-14">df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">q</th>
<th data-quarto-table-cell-role="th">cp</th>
<th data-quarto-table-cell-role="th">mh</th>
<th data-quarto-table-cell-role="th">error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.010</td>
<td>4.704263</td>
<td>4.841719</td>
<td>-2.921931</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.025</td>
<td>11.868630</td>
<td>12.136623</td>
<td>-2.257991</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.050</td>
<td>24.108192</td>
<td>23.368946</td>
<td>3.066368</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.100</td>
<td>49.789318</td>
<td>47.340357</td>
<td>4.918647</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.250</td>
<td>138.465340</td>
<td>135.870227</td>
<td>1.874197</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0.500</td>
<td>347.656754</td>
<td>347.845394</td>
<td>-0.054260</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.750</td>
<td>747.009495</td>
<td>736.928440</td>
<td>1.349522</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0.900</td>
<td>1367.480284</td>
<td>1387.431296</td>
<td>-1.458962</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0.950</td>
<td>1918.479107</td>
<td>1958.620885</td>
<td>-2.092375</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0.990</td>
<td>3534.790477</td>
<td>3488.275714</td>
<td>1.315913</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>0.995</td>
<td>4408.064760</td>
<td>4380.679896</td>
<td>0.621245</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>0.999</td>
<td>6969.745648</td>
<td>6872.765923</td>
<td>1.391439</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><br></p>
<p>In the table above:</p>
<ul>
<li><code>q</code> represents the target quantile.</li>
<li><code>cp</code> represents analytical quantiles from the conjugate prior posterior predictive distribution.</li>
<li><code>mh</code> represents quantiles from the Metropolis-Hastings generated posterior predictive samples.</li>
<li><code>error</code> represents the percent deviation from analytical quantiles.</li>
</ul>
<p>Even at q=0.999, <code>cp</code> and <code>mh</code> differ by less than 1.50%.</p>
<p>Unfortunately, most distributional relationships used in practice are not conjugate. But by leveraging conjugate relationships we were able to demonstrate that when the same likelihood, prior and loss data are used, Metropolis-Hastings will yield distributional estimates of the posterior predictive distribution very to close to the analytical distribution.</p>
<p>While implementing your own MCMC sampler is a great way to gain a better understanding of the inner workings of Markov Chain Monte Carlo, in practice it is almost always preferrable to an optimized MCMC library such as PyStan or PyMC3. These will be explored in a future post.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/introduction-to-metropolis-hastings/introduction-to-metropolis-hastings.html</guid>
  <pubDate>Sat, 21 Sep 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Creating Runoff Triangles in R</title>
  <link>https://www.jtrive.com/posts/runoff-triangles-in-r/runoff-triangles-in-r.html</link>
  <description><![CDATA[ 





<p>Runoff triangles in actuarial analysis are used to estimate the development of claims over time, helping actuaries analyze the patterns of how insurance claims are reported, developed, and settled. Runoff triangles aggregate incurred or paid losses over multiple periods, providing insights into how claims mature. By observing the progression of claims across development periods, actuaries can make more accurate projections about ultimate losses and calculate reserve estimates for future liabilities. The goal is to assess whether current reserves are adequate to cover outstanding claims, as well as losses that have been incurred by not reported.</p>
<p>Throughout this article, examples will focus on a synthetic incremental loss dataset given in a 3-column data.table with columns <code>yyyy</code> for origin year, <code>dev</code> for development period and <code>value</code> for loss amount. We apply a decay factor to the random gamma draws which is inversely proportional to development period. Finally, in order to provide a more generally useful example, we randomly drop 25% of incremental losses to reflect zero incremental loss amounts at various origin-development period intersections.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create synthetic loss data with columns yyyy, dev and value.</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.table"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb1-4"></span>
<span id="cb1-5">lossDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> data.table<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CJ</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yyyy=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dev=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb1-6">lossDF[,max_dev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2022</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> yyyy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>]</span>
<span id="cb1-7">lossDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> lossDF[dev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span>max_dev]</span>
<span id="cb1-8">lossDF[,value_init<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(lossDF), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">121</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> dev)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span>]</span>
<span id="cb1-9">lossDF[,temp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(lossDF))]</span>
<span id="cb1-10">lossDF[,value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(temp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(value_init, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA_real_</span>)]</span>
<span id="cb1-11">lossDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> lossDF[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(value), .(yyyy, dev, value)]</span></code></pre></div>
<p><br></p>
<p>Inspecting the first 10 records:</p>
<pre><code>&gt; lossDF[1:10,]
    yyyy dev value
 1: 2011  12  2368
 2: 2011  36  4053
 3: 2011  48  4875
 4: 2011  60   915
 5: 2011  96  1305
 6: 2011 108   226
 7: 2011 120    12
 8: 2012  24  6050
 9: 2012  48  3352
10: 2012  60  2691</code></pre>
<section id="data.table-approach" class="level3">
<h3 class="anchored" data-anchor-id="data.table-approach"><code>data.table</code> Approach</h3>
<p>data.table exposes two powerful reshaping functions that work as opposites of each other: <code>melt</code> transforms a wide dataset into a tall dataset, whereas <code>dcast</code> transforms a tall dataset to a wide dataset, somewhat akin to pivoting in Excel. First the code to create the incremental loss triangle:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Using data.table::dcast to create an incremental loss triangle.</span></span>
<span id="cb3-2">incrTriDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcast</span>(lossDF, yyyy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>dev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value.var=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun.aggregate=</span>sum, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span></code></pre></div>
<p><br></p>
<p>A description of the arguments passed to <code>dcast</code>:</p>
<ul>
<li><code>lossDF</code>: The data.table to transform into a runoff triangle.</li>
<li><code>yyyy ~ dev</code>: A formulaic expression of the form <code>LHS ~ RHS</code> dictating how to transform <code>lossDF</code>. The argument on the LHS, in this example <code>yyyy</code>, represents the key in the resulting table. The RHS argument, in this example <code>dev</code> represents the column whose levels become column names in the new table.</li>
<li><code>fun.aggregate=sum</code>: Although not required in this case, if our original data wasn’t aggregated by yyyy and dev, including this argument would perform the aggregation. In our example, this argument has no effect.</li>
<li><code>fill=NA</code>: Specifies how to populate missing values. Excluding values in cells intentionally removed to provide a more robust example, for a given origin period yyyy, development periods in excess of <code>(2020 - yyyy + 1) * 12</code> represent future evaluation dates which should be set to <code>NA</code>.</li>
</ul>
<p>Calling <code>dcast</code> with these arguments results in:</p>
<pre><code>&gt; incrTriDF
    yyyy   12   24   36   48   60   72   84   96 108 120
 1: 2011 2368   NA 4053 4875  915   NA   NA 1305 226  12
 2: 2012   NA 6050   NA 3352 2691 2064  830   NA 418  NA
 3: 2013   NA 5707   NA 2699 3025   NA 1500   NA  NA  NA
 4: 2014 3440 2565   NA 1989 1614 1298   NA   NA  NA  NA
 5: 2015 5636 8477 2317 2666   NA   NA   NA   NA  NA  NA
 6: 2016 2718 7054   NA 2166 2933   NA   NA   NA  NA  NA
 7: 2017 5469 3168 1900 1591   NA   NA   NA   NA  NA  NA
 8: 2018 4045 2318   NA   NA   NA   NA   NA   NA  NA  NA
 9: 2019 2164 2290   NA   NA   NA   NA   NA   NA  NA  NA
10: 2020 3515   NA   NA   NA   NA   NA   NA   NA  NA  NA</code></pre>
<p><br></p>
<p>For origin period cells having an <code>NA</code> value for a development period <code>dev</code> less than or equal to <code>(2020 - yyyy + 1) * 12</code>, we need to replace <code>NA</code> with <code>0</code>. This can be accomplished using <code>dcast</code>’s counterpart <code>melt</code>:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replacing NA values with 0 for cells in which `dev period &lt;= (2020 - yyyy + 1) * 12`. </span></span>
<span id="cb5-2">lossDF2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(incrTriDF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id.vars=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yyyy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable.name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dev"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable.factor=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>)</span>
<span id="cb5-3">lossDF2[,dev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(dev)]</span>
<span id="cb5-4">lossDF2[,value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(dev<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> yyyy <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(value), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, value)]</span>
<span id="cb5-5"></span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Transform lossDF2 into incrTriDF.</span></span>
<span id="cb5-7">incrTriDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcast</span>(lossDF2, yyyy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>dev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value.var=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun.aggregate=</span>sum, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span></code></pre></div>
<p><br></p>
<p>Running this code gives <code>incrTriDF</code> with relevant <code>NA</code>s replaced with 0s resulting in:</p>
<pre><code>    yyyy   12   24   36   48   60   72   84   96 108 120
 1: 2011 2368    0 4053 4875  915    0    0 1305 226  12
 2: 2012    0 6050    0 3352 2691 2064  830    0 418  NA
 3: 2013    0 5707    0 2699 3025    0 1500    0  NA  NA
 4: 2014 3440 2565    0 1989 1614 1298    0   NA  NA  NA
 5: 2015 5636 8477 2317 2666    0    0   NA   NA  NA  NA
 6: 2016 2718 7054    0 2166 2933   NA   NA   NA  NA  NA
 7: 2017 5469 3168 1900 1591   NA   NA   NA   NA  NA  NA
 8: 2018 4045 2318    0   NA   NA   NA   NA   NA  NA  NA
 9: 2019 2164 2290   NA   NA   NA   NA   NA   NA  NA  NA
10: 2020 3515   NA   NA   NA   NA   NA   NA   NA  NA  NA</code></pre>
<p><br></p>
<p>A cumulative triangle can be created in one of two ways: 1) starting from <code>lossDF2</code> (the tabular representation of losses created to replace <code>NA</code>s with 0s), or 2) working with <code>incrTriDF</code> directly. both techniques will be demonstrated.</p>
<p>In some sense, working with <code>lossDF2</code> is easiest given the flexibility of applying group-wise operations in data.table. We add a new column identified as <code>cum_value</code> representing the cumulative loss amount by <code>yyyy</code> in order of increasing <code>dev</code>:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setorderv</span>(lossDF2, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yyyy"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dev"</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb7-2">lossDF2[,cum_value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(value), by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yyyy"</span>]</span>
<span id="cb7-3">cumTriDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcast</span>(lossDF2, yyyy<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>dev, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value.var=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cum_value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fun.aggregate=</span>sum, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span></code></pre></div>
<p>Inspecting <code>cumTriDF</code> yields:</p>
<pre><code>    yyyy   12    24    36    48    60    72    84    96   108   120
 1: 2011 2368  2368  6421 11296 12211 12211 12211 13516 13742 13754
 2: 2012    0  6050  6050  9402 12093 14157 14987 14987 15405    NA
 3: 2013    0  5707  5707  8406 11431 11431 12931 12931    NA    NA
 4: 2014 3440  6005  6005  7994  9608 10906 10906    NA    NA    NA
 5: 2015 5636 14113 16430 19096 19096 19096    NA    NA    NA    NA
 6: 2016 2718  9772  9772 11938 14871    NA    NA    NA    NA    NA
 7: 2017 5469  8637 10537 12128    NA    NA    NA    NA    NA    NA
 8: 2018 4045  6363  6363    NA    NA    NA    NA    NA    NA    NA
 9: 2019 2164  4454    NA    NA    NA    NA    NA    NA    NA    NA
10: 2020 3515    NA    NA    NA    NA    NA    NA    NA    NA    NA</code></pre>
<p><br></p>
<p>It is also possible to create a cumulative triangle from the incremental triangle directly. This method is less efficient, since it requires converting the data.table to a matrix and users base R’s <code>apply</code>, but is still worth demonstrating:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First convert incrTriDF to a matrix class.</span></span>
<span id="cb9-2">incrTri <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(</span>
<span id="cb9-3">    incrTriDF[,<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rownames=</span>incrTriDF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>yyyy, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colnames=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(incrTriDF), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yyyy"</span>)</span>
<span id="cb9-4">    )</span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform row-wise cumulative sum, then convert back to data.table.</span></span>
<span id="cb9-7">cumTri <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(incrTri, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, cumsum))</span>
<span id="cb9-8">cumTriDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.table</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">apply</span>(incrTri, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, cumsum)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep.rownames=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yyyy"</span>)</span></code></pre></div>
<p><br></p>
<p>Although less performant, we arrive at the same result:</p>
<pre><code>    yyyy   12    24    36    48    60    72    84    96   108   120
 1: 2011 2368  2368  6421 11296 12211 12211 12211 13516 13742 13754
 2: 2012    0  6050  6050  9402 12093 14157 14987 14987 15405    NA
 3: 2013    0  5707  5707  8406 11431 11431 12931 12931    NA    NA
 4: 2014 3440  6005  6005  7994  9608 10906 10906    NA    NA    NA
 5: 2015 5636 14113 16430 19096 19096 19096    NA    NA    NA    NA
 6: 2016 2718  9772  9772 11938 14871    NA    NA    NA    NA    NA
 7: 2017 5469  8637 10537 12128    NA    NA    NA    NA    NA    NA
 8: 2018 4045  6363  6363    NA    NA    NA    NA    NA    NA    NA
 9: 2019 2164  4454    NA    NA    NA    NA    NA    NA    NA    NA
10: 2020 3515    NA    NA    NA    NA    NA    NA    NA    NA    NA</code></pre>
</section>
<section id="chainladder-library" class="level2">
<h2 class="anchored" data-anchor-id="chainladder-library">ChainLadder Library</h2>
<p>The ChainLadder library is a third-party R package that contains a number of routines to assist with Actuarial reserving. One of these utilities is the function <code>as.triangle</code>, which takes as input a data.frame/data.table, and column names representing accident year, development period and target metric (“origin”, “dev” and “value” respectively), and returns a triangle instance which is a subclass of the matrix type. To transform our original <code>lossDF</code> into an incremental triangle is a single function call:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ChainLadder"</span>)</span>
<span id="cb11-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> incrTri <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.triangle</span>(lossDF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">origin=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"yyyy"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dev=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dev"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>)</span>
<span id="cb11-3"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> incrTri</span>
<span id="cb11-4">      dev</span>
<span id="cb11-5">  yyyy   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">108</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span></span>
<span id="cb11-6">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2368</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4053</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4875</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">915</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1305</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">226</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span></span>
<span id="cb11-7">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2012</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6050</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3352</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2691</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2064</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">830</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">418</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-8">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5707</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2699</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3025</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1500</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-9">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3440</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2565</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1989</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1614</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1298</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-10">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2015</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5636</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8477</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2317</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2666</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-11">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2718</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7054</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2166</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2933</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-12">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5469</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3168</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1900</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1591</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-13">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4045</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2318</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-14">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2164</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2290</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-15">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3515</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>   <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>  <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb11-16"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(incrTri)</span>
<span id="cb11-17">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"triangle"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"matrix"</span> </span></code></pre></div>
<p><br></p>
<p>This gives the same transformation as <code>dcast</code>, but as a triangle matrix object instead of a data.table. To obtain a cumulative triangle from<code>incrTri</code>, we leverage the <code>incr2cum</code> function, including <code>na.rm=TRUE</code>:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> cumTri <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">incr2cum</span>(incrTri, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb12-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> cumTri</span>
<span id="cb12-3"> dev</span>
<span id="cb12-4">yyyy   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">48</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">72</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">84</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">108</span>   <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">120</span></span>
<span id="cb12-5"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2011</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2368</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2368</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6421</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11296</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12211</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12211</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12211</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13516</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13742</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13754</span></span>
<span id="cb12-6"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2012</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6050</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6050</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9402</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12093</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14157</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14987</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14987</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15405</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb12-7"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2013</span>    <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5707</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5707</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8406</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11431</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11431</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12931</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12931</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb12-8"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3440</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6005</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6005</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7994</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9608</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10906</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10906</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb12-9"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2015</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5636</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14113</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16430</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19096</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19096</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19096</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb12-10"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2016</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2718</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9772</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9772</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11938</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14871</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb12-11"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2017</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5469</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8637</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10537</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12128</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb12-12"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2018</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4045</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6363</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6363</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb12-13"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2019</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2164</span>  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4454</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span>
<span id="cb12-14"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3515</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span></span></code></pre></div>
<p>which is the same as before.</p>
<p>One thing to note when using ChainLadder’s <code>incr2cum/cum2incr</code>: When converting loss data into a triangle class via <code>as.triangle</code>, there is no internal reference that tracks whether the data originally represented cumulative or incremental losses. If you have incremental losses that are transformed into a triangle instance and then call <code>incr2cum</code> on that triangle, a triangle of cumulative losses will be returned as expected. However, if you pass that cumulative loss triangle to <code>incr2cum</code> again, the already-cumulated losses will be cumulated again, and no warning or error message will be produced. This usually won’t be an issue, just be sure to track the state of your data when relying on ChainLadder to convert between cumulative and incremental losses.</p>


</section>

 ]]></description>
  <category>R</category>
  <category>Statistical Modeling</category>
  <category>Actuarial</category>
  <guid>https://www.jtrive.com/posts/runoff-triangles-in-r/runoff-triangles-in-r.html</guid>
  <pubDate>Wed, 31 Jul 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Estimating Logistic Regression coefficients From Scratch in Python</title>
  <link>https://www.jtrive.com/posts/logistic-regression-python/logistic-regression-python.html</link>
  <description><![CDATA[ 





<p>In this post, I’ll demonstrate how to estimate the coefficients of a logistic regression model using the Fisher Scoring algorithm in Python. These estimates will be compared with statsmodels coefficients to ensure consistency.</p>
<p>In a generalized linear model (GLM), the response may have any distribution from the exponential family. Rather than assuming the mean is a linear function of the explanatory variables, we assume that a function of the mean, or the link function, is a linear function of the explanatory variables.</p>
<p>Logistic regression is used for modeling data with a categorical response. Although it’s possible to model multinomial data using logistic regression, in this post our analysis will be limited to models targeting a dichotomous response, where the outcome can be classified as ‘Yes/No’ or ‘1/0’.</p>
<p>The logistic regression model is a GLM whose canonical link is the logit, or log-odds:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BLn%7D%20%5Cbig(%5Cfrac%7B%5Cpi_%7Bi%7D%7D%7B1%20-%20%5Cpi_%7Bi%7D%7D%20%5Cbig)%20=%20%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D%0A"></p>
<p>for <img src="https://latex.codecogs.com/png.latex?i%20=%20(1,%20%5Cldots%20,%20n)">.</p>
<p>Solving the logit for <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7Bi%7D">, which is a stand-in for the predicted probability associated with observation <img src="https://latex.codecogs.com/png.latex?x_%7Bi%7D">, yields</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cpi_%7Bi%7D%20=%20%5Cfrac%20%7Be%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D%7D%7D%7B1%20+%20e%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D%7D%7D%20=%20%5Cfrac%20%7B1%7D%7B1%20+%20e%5E%7B-(%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D)%7D%7D,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?-%5Cinfty%20%3C%20x_%7Bi%7D%20%3C%20%5Cinfty"> and <img src="https://latex.codecogs.com/png.latex?0%20%3C%20%5Cpi_%7Bi%20%7D%3C%201">.</p>
<section id="parameter-estimation" class="level3">
<h3 class="anchored" data-anchor-id="parameter-estimation">Parameter Estimation</h3>
<p>Maximum Likelihood Estimation can be used to determine the parameters of a Logistic Regression model, which entails finding the set of parameters for which the probability of the observed data is greatest. The objective is to estimate the <img src="https://latex.codecogs.com/png.latex?p%20+%201"> unknown <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B0%7D,%20%5Cldots%20,%5Cbeta_%7Bp%7D">.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?Y_%7Bi%7D"> represent independent, dichotomous response values for each of <img src="https://latex.codecogs.com/png.latex?n"> observations, where <img src="https://latex.codecogs.com/png.latex?Y_i=1"> denotes a success and <img src="https://latex.codecogs.com/png.latex?Y_i=0"> denotes a failure. The density function of a single observation <img src="https://latex.codecogs.com/png.latex?Y_i"> is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap(y_%7Bi%7D)%20=%20%5Cpi_%7Bi%7D%5E%7By_%7Bi%7D%7D(1-%5Cpi_%7Bi%7D)%5E%7B1-y_%7Bi%7D%7D,%0A"></p>
<p>and the corresponding likelihood function is</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL(%5Cbeta)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20%5Cpi_%7Bi%7D%5E%7By_%7Bi%7D%7D(1-%5Cpi_%7Bi%7D)%5E%7B1-y_%7Bi%7D%7D.%0A"></p>
<p>Taking the natural log of the maximum likelihood estimate results in the log-likelihood function:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Al(%5Cbeta)%20&amp;=%20%5Cmathrm%7BLn%7D(L(%5Cbeta))%20=%20%5Cmathrm%7BLn%7D%20%5CBig(%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20%5Cpi_%7Bi%7D%5E%7By_%7Bi%7D%7D(1-%5Cpi_%7Bi%7D)%5E%7B1-y_%7Bi%7D%7D%20%5CBig)%0A=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_%7Bi%7D%20%5Ccdot%20%5Cmathrm%7BLn%7D(%5Cpi_%7Bi%7D)%20+%20(1-y_%7Bi%7D)%20%5Ccdot%20%5Cmathrm%7BLn%7D(1-%5Cpi_%7Bi%7D)%5C%5C%0A&amp;=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_%7Bi%7D%20%5Ccdot%20%5Cmathrm%7BLn%7D%20%5CBig(%5Cfrac%20%7Be%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D%7D%7D%7B1%20+%20e%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D%7D%7D%20%5CBig)%20+%20(1%20-%20y_%7Bi%7D)%20%5Ccdot%20%5Cmathrm%7BLn%7D%20%5CBig(%5Cfrac%20%7B1%7D%7B1%20+%20e%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D%7D%7D%20%5CBig)%5C%5C%0A&amp;=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_%7Bi%7D(%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D)%20-%20%5Cmathrm%7BLn%7D(1%20+%20e%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Cbeta_%7Bp%7Dx_%7Bip%7D%7D)%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
<p>The first-order partial derivatives of the log-likelihood are calculated and set to zero for each <img src="https://latex.codecogs.com/png.latex?k%20=%200,%201,%20%5Cldots,%20p"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%20%7B%5Cpartial%20l(%5Cbeta)%7D%7B%5Cpartial%20%5Cbeta_%7Bk%7D%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_%7Bi%7Dx_%7Bik%7D%20-%20%5Cpi_%7Bi%7Dx_%7Bik%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20x_%7Bik%7D(y_%7Bi%7D%20-%20%5Cpi_%7Bi%7D)%20=%200,%0A"></p>
<p>which can be represented in matrix notation as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%20%7B%5Cpartial%20l(%5Cbeta)%7D%7B%5Cpartial%20%5Cbeta%7D%20=%20X%5E%7BT%7D(y%20-%20%5Cpi),%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?X%5E%7BT%7D"> is a (p + 1)-by-n matrix and <img src="https://latex.codecogs.com/png.latex?(y%20-%20%5Cpi)"> an n-by-1 vector.</p>
<p>The vector of first-order partial derivatives of the log-likelihood function is referred to as the score function and is typically represented as <img src="https://latex.codecogs.com/png.latex?U">.</p>
<p>These (p+1) equations are solved simultaneously to obtain the parameter estimates <img src="https://latex.codecogs.com/png.latex?%5Chat%5Cbeta_%7B0%7D,%20%5Cldots%20,%5Chat%5Cbeta_%7Bp%7D">.</p>
<p>Each solution specifies a critical-point which will be either a maximum or a minimum. The critical point will be a maximum if the matrix of second partial derivatives is negative definite (which means every element on the diagonal of the matrix is less than zero).</p>
<p>The matrix of second partial derivatives is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta_%7Bk%7D%7D%7B%5Cpartial%20%5Cbeta_%7Bk%7D%7D%5E%7BT%7D%7D%20=%20-%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20x_%7Bik%7D%5Cpi_%7Bi%7D(1-%5Cpi_%7Bi%7D)%7Bx_%7Bik%7D%7D%5E%7BT%7D,%0A"></p>
<p>represented in matrix form as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20=%20-X%5E%7BT%7DWX,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?W"> is an n-by-n diagonal matrix of weights with each element equal to <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7Bi%7D(1%20-%20%5Cpi_%7Bi%7D)"> for logistic regression models (in general, the weights matrix <img src="https://latex.codecogs.com/png.latex?W"> will have entries inversely proportional to the variance of the response).</p>
<p>Since no closed-form solution exists for determining logistic regression model coefficients, iterative techniques must be employed.</p>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the Model</h3>
<p>Two distinct but related iterative methods can be utilized in determining model coefficients: the Newton-Raphson method and Fisher Scoring. The Newton-Raphson method relies on the matrix of second partial derivatives, also known as the Hessian. The Newton-Raphson update expression is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbeta%5E%7B(t+1)%7D%20=%20%5Cbeta%5E%7B(t)%7D%20-%20(H%5E%7B(t)%7D)%5E%7B-1%7DU%5E%7B(t)%7D,%0A"></p>
<p>where:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t+1)%7D"> = the vector of updated coefficient estimates.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t)%7D"> = the vector of coefficient estimates from the previous iteration.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?(H%5E%7B(t)%7D)%5E%7B-1%7D"> = the inverse of the Hessian, <img src="https://latex.codecogs.com/png.latex?%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)%5E%7B-1%7D">.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?U%5E%7B(t)%7D"> = the vector of first-order partial derivatives of the log-likelihood function, <img src="https://latex.codecogs.com/png.latex?X%5E%7BT%7D(y%20-%20%5Cpi)">.</li>
</ul>
<p>The Newton-Raphson method starts with an initial guess for the solution, and obtains a second guess by approximating the function to be maximized in a neighborhood of the initial guess by a second-degree polynomial, and then finding the location of that polynomial’s maximum value. This process continues until it converges to the actual solution. The convergence of <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7Bt%7D"> to <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D"> is usually fast, with adequate convergence frequently realized after fewer than 50 iterations.</p>
<p>An alternative method, <em>Fisher Scoring</em>, utilizes the expected information <img src="https://latex.codecogs.com/png.latex?-E%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)">. Let <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BI%7D"> serve as a stand-in for the expected value of the information:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathcal%7BI%7D%20=%20-E%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig).%0A"></p>
<p>The Fisher scoring update step replaces <img src="https://latex.codecogs.com/png.latex?-H%5E%7B(t)%7D"> from Newton-Raphson with <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BI%7D%5E%7B(t)%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cbeta%5E%7B(t+1)%7D%20&amp;=%20%5Cbeta%5E%7B(t)%7D%20+%20(%5Cmathcal%7BI%7D%5E%7B(t)%7D)%5E%7B-1%7DU%5E%7B(t)%7D%5C%5C%0A&amp;=%20%5Cbeta%5E%7B(t)%7D%20+%20(X%5E%7BT%7DWX)%5E%7B-1%7DX%5E%7BT%7D(y%20-%20%5Cpi)%5C%5C%0A%5Cend%7Balign*%7D%0A"></p>
<p>where:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t+1)%7D"> = the vector of updated coefficient estimates.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t)%7D"> = the vector of coefficient estimates from the previous iteration.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?(%5Cmathcal%7BI%7D%5E%7B(t)%7D)%5E%7B-1%7D"> = the inverse of the expected information matrix, <img src="https://latex.codecogs.com/png.latex?-E%20%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)%5E%7B-1%7D">.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?U%5E%7B(t)%7D"> = the vector of first-order partial derivatives of the log-likelihood function, <img src="https://latex.codecogs.com/png.latex?X%5E%7BT%7D(y%20-%20%5Cpi)">.</li>
</ul>
<p>For GLMs with a canonical link (of which employing the logit for logistic regression is an example), the observed and expected information are the same. When the response follows an exponential family distribution, and the canonical link function is employed, observed and expected information coincide so that Fisher scoring and Newton-Raphson are identical.</p>
<p>When the canonical link is used, the second partial derivatives of the log-likelihood do not depend on the observation <img src="https://latex.codecogs.com/png.latex?y_i">, and therefore</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20=%20E%20%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20%5CBig).%0A"></p>
<p>Fisher scoring has the advantage that it produces the asymptotic covariance matrix as a by-product.</p>
<p>To summarize:</p>
<ul>
<li>The <em>Hessian</em> is the matrix of second partial derivatives of the log-likelihood with respect to the parameters, <img src="https://latex.codecogs.com/png.latex?H%20=%20%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D">.</li>
<li>The <em>observed information</em> is <img src="https://latex.codecogs.com/png.latex?-%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D">.<br>
</li>
<li>The <em>expected information</em> is <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BI%7D%20=%20E%5CBig(-%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)">.</li>
<li>The <em>asymptotic covariance matrix</em> is <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BVar%7D(%5Chat%7B%5Cbeta%7D)%20=%20E%5CBig(-%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)%5E%7B-1%7D%20=%20(X%5E%7BT%7DWX)%5E%7B-1%7D">.</li>
</ul>
<p>For models employing a canonical link function:</p>
<ul>
<li>The observed and expected information are the same, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20=%20E%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)">.</li>
<li><img src="https://latex.codecogs.com/png.latex?H%20=%20-%5Cmathcal%7BI%7D">, or <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20=%20E%5CBig(-%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)">.</li>
<li>The Newton-Raphson and Fisher Scoring algorithms yield identical results.</li>
</ul>
</section>
<section id="fisher-scoring-implementation" class="level3">
<h3 class="anchored" data-anchor-id="fisher-scoring-implementation">Fisher Scoring Implementation</h3>
<p>The data used for our sample calculation can be obtained <a href="https://gist.githubusercontent.com/jtrive84/835514a76f7afd552c999e4d9134baa8/raw/6dac51b80f892ef051174a46766eb53c7b609ebd/Challenger.csv">here</a>. The data represents O-Ring failures in the 23 pre-Challenger space shuttle missions. TEMPERATURE will serve as the single explanatory variable which will be used to predict O_RING_FAILURE, which is 1 if a failure occurred, 0 otherwise.</p>
<p>Once the parameters have been determined, the model estimate of the probability of success for a given observation can be calculated with:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Cpi_%7Bi%7D%20=%20%5Cfrac%20%7Be%5E%7B%5Chat%5Cbeta_%7B0%7D%20+%20%5Chat%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Chat%5Cbeta_%7Bp%7Dx_%7Bip%7D%7D%7D%7B1%20+%20e%5E%7B%5Chat%5Cbeta_%7B0%7D%20+%20%5Chat%5Cbeta_%7B1%7Dx_%7Bi1%7D%20+%20%5Cldots%20+%20%5Chat%5Cbeta_%7Bp%7Dx_%7Bip%7D%7D%7D%0A"></p>
<p>In the following code, we define a single function, <code>get_params</code>, which returns the estimated model coefficients as a (p+1)-by-1 array. In addition, the function returns the number of scoring iterations, fitted values and the variance-covariance matrix for the estimated parameters.</p>
<div id="cell-2" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> estimate_lr_params(X, y, epsilon<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.001</span>):</span>
<span id="cb1-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Estimate logistic regression coefficients using Fisher Scoring.Iteration </span></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ceases once changes between elements in coefficient matrix across</span></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    consecutive iterations is less than epsilon.</span></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">   </span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - design_matrix      `X` : n-by-(p+1)                                </span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - response_vector    `y` : n-by-1                                   </span></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - probability_vector `p` : n-by-1                                   </span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - weights_matrix     `W` : n-by-n                                    </span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - epsilon                : threshold above which iteration continues</span></span>
<span id="cb1-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - n                      : Number of observations                        </span></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - (p + 1)                : Number of parameters (+1 for intercept term) </span></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">   </span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - U: First derivative of log-likelihood with respect to                </span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">           each beta_i, i.e. "Score Function" = X^T * (y - p)        </span></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">           </span></span>
<span id="cb1-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - I: Second derivative of log-likelihood with respect to               </span></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">           each beta_i, i.e. "Information Matrix" = (X^T * W * X)      </span></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">                                                                           </span></span>
<span id="cb1-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - X^T*W*X results in a (p + 1)-by-(p + 1) matrix.                          </span></span>
<span id="cb1-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - X^T(y - p) results in a (p+1)-by-1 matrix.                            </span></span>
<span id="cb1-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">        - (X^T*W*X)^-1 * X^T(y - p) results in a (p + 1)-by-1 matrix.     </span></span>
<span id="cb1-27"></span>
<span id="cb1-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns</span></span>
<span id="cb1-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    -------</span></span>
<span id="cb1-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    dict of model results        </span></span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">   </span></span>
<span id="cb1-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-33">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> sigmoid(v): </span>
<span id="cb1-34">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.exp(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>v)))</span>
<span id="cb1-35">    </span>
<span id="cb1-36"></span>
<span id="cb1-37">    betas0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros(X.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]).reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-38">    p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigmoid(X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> betas0)</span>
<span id="cb1-39">    W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.diag((p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)).ravel())</span>
<span id="cb1-40">    I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X</span>
<span id="cb1-41">    U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> (y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)</span>
<span id="cb1-42"></span>
<span id="cb1-43">    n_iter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb1-44">    </span>
<span id="cb1-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>:</span>
<span id="cb1-46">        n_iter<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>        </span>
<span id="cb1-47">        betas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> betas0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> np.linalg.inv(I) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> U</span>
<span id="cb1-48">        betas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> betas.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-49"></span>
<span id="cb1-50">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">all</span>(np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(betas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> betas0) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> epsilon):</span>
<span id="cb1-51">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span></span>
<span id="cb1-52">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-53">            p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigmoid(X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> betas)</span>
<span id="cb1-54">            W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.diag((p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)).ravel())</span>
<span id="cb1-55">            I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> W <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X</span>
<span id="cb1-56">            U <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> (y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)</span>
<span id="cb1-57">            betas0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> betas</span>
<span id="cb1-58"></span>
<span id="cb1-59">    dresults <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb1-60">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"params"</span>: betas.ravel(),</span>
<span id="cb1-61">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ypred"</span>: sigmoid(X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> betas),</span>
<span id="cb1-62">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"V"</span>: np.linalg.inv(I),</span>
<span id="cb1-63">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n_iter"</span>: n_iter</span>
<span id="cb1-64">        }</span>
<span id="cb1-65"></span>
<span id="cb1-66">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span>(dresults)</span>
<span id="cb1-67"></span>
<span id="cb1-68"></span></code></pre></div>
</div>
<p>We read in the Challenger dataset, partition the data into the design matrix and response vector, which are then passed to <code>estimate_lr_params</code>:</p>
<div id="cell-4" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"></span>
<span id="cb2-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb2-3"></span>
<span id="cb2-4">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://gist.githubusercontent.com/jtrive84/835514a76f7afd552c999e4d9134baa8/raw/6dac51b80f892ef051174a46766eb53c7b609ebd/Challenger.csv"</span>)</span>
<span id="cb2-5"></span>
<span id="cb2-6">X0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TEMPERATURE"</span>]].values</span>
<span id="cb2-7">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.concatenate([np.ones(X0.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]).reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), X0], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-8">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"O_RING_FAILURE"</span>]].values</span>
<span id="cb2-9"></span>
<span id="cb2-10">dresults <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> estimate_lr_params(X, y)</span>
<span id="cb2-11"></span>
<span id="cb2-12">dresults</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>{'params': array([15.04290163, -0.23216274]),
 'ypred': array([[0.43049313],
        [0.22996826],
        [0.27362106],
        [0.32209405],
        [0.37472428],
        [0.1580491 ],
        [0.12954602],
        [0.22996826],
        [0.85931657],
        [0.60268105],
        [0.22996826],
        [0.04454055],
        [0.37472428],
        [0.93924781],
        [0.37472428],
        [0.08554356],
        [0.22996826],
        [0.02270329],
        [0.06904407],
        [0.03564141],
        [0.08554356],
        [0.06904407],
        [0.82884484]]),
 'V': array([[ 5.44406534e+01, -7.96333573e-01],
        [-7.96333573e-01,  1.17143602e-02]]),
 'n_iter': 5}</code></pre>
</div>
</div>
<p><code>estimate_lr_params</code> returns a dictionary consisting of the following keys:</p>
<ul>
<li><code>"params"</code>: Estimated parameters.</li>
<li><code>"ypred"</code>: Fitted values.<br>
</li>
<li><code>"V"</code>: Variance-covariance matrix of the parameter estimates.<br>
</li>
<li><code>"n_iter"</code>: Number of Fisher scoring iterations.</li>
</ul>
<p>For the Challenger dataset, our implementation of Fisher scoring results in a model with <img src="https://latex.codecogs.com/png.latex?%5Chat%20%5Cbeta_%7B0%7D%20=%2015.0429"> and <img src="https://latex.codecogs.com/png.latex?%5Chat%20%5Cbeta_%7B1%7D%20=%20-0.2322">. In order to predict new probabilities of O-Ring Failure based on temperature, we use:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Chat%7B%5Cpi%7D%20=%20%5Cfrac%20%7B1%7D%7B1%20+%20e%5E%7B-(15.0429%20-0.2322%20%5Ctimes%20%5Cmathrm%7BTEMPERATURE%7D)%7D%7D.%0A"></p>
<p>Negative coefficients correspond to features that are negatively associated with the probability of a positive outcome, with the reverse being true for positive coefficients.</p>
<p>Lets compare the results of our implementation against the estimates produced by statsmodels:</p>
<div id="cell-6" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"></span>
<span id="cb4-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> statsmodels.formula.api <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> smf</span>
<span id="cb4-3"></span>
<span id="cb4-4">mdl <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> smf.logit(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"O_RING_FAILURE ~ TEMPERATURE"</span>, data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>df).fit()</span>
<span id="cb4-5"></span>
<span id="cb4-6"></span>
<span id="cb4-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">mdl.params:</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mdl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>params<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"mdl.cov_params():</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mdl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>cov_params()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb4-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"mdl.predict(df):</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mdl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>predict(df)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.441635
         Iterations 7

mdl.params:
Intercept      15.042902
TEMPERATURE    -0.232163
dtype: float64

mdl.cov_params():
             Intercept  TEMPERATURE
Intercept    54.444275    -0.796387
TEMPERATURE  -0.796387     0.011715

mdl.predict(df):
0     0.430493
1     0.229968
2     0.273621
3     0.322094
4     0.374724
5     0.158049
6     0.129546
7     0.229968
8     0.859317
9     0.602681
10    0.229968
11    0.044541
12    0.374724
13    0.939248
14    0.374724
15    0.085544
16    0.229968
17    0.022703
18    0.069044
19    0.035641
20    0.085544
21    0.069044
22    0.828845
dtype: float64
</code></pre>
</div>
</div>
<p>The values produced using the statsmodels align closely with the results from <code>estimate_lr_params</code>.</p>
<p>A feature of logistic regression models is that the predictions preserve the data’s marginal probabilities. If you aggregate the fitted values from the model, the total will equal the number of positive outcomes in the original target vector:</p>
<div id="cell-8" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"></span>
<span id="cb6-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># estimate_lr_params.</span></span>
<span id="cb6-3">dresults[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ypred"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>7.000000000274647</code></pre>
</div>
</div>
<div id="cell-9" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"></span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># statsmodels.</span></span>
<span id="cb8-3">mdl.predict(df).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>7.0000000000000036</code></pre>
</div>
</div>
<p>We have 7 positive instances in our dataset, and the total probability aggregates to 7 in both sets of predictions.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/logistic-regression-python/logistic-regression-python.html</guid>
  <pubDate>Sat, 16 Mar 2024 05:00:00 GMT</pubDate>
</item>
<item>
  <title>Assessing Model Goodness-of-Fit in Python with Scipy</title>
  <link>https://www.jtrive.com/posts/gof-python-scipy/gof-python-scipy.html</link>
  <description><![CDATA[ 





<p>This article explores techniques that can be used to assess how well a model fits a dataset. Specifically, we’ll demonstrate how to produce the following visualizations:</p>
<ul>
<li>Q-Q Plot: Compares two probability distributions by plotting their quantiles against each other.<br>
</li>
<li>P-P Plot: Compares two cumulative distribution functions against each other.<br>
</li>
<li>Histogram: Plot density histogram with parametric distribution overlay.</li>
</ul>
<p>In addition, the following tests will be introduced:</p>
<ul>
<li>Kolmogorov-Smirnov: Test the equality of continuous, one-dimensional probability distributions.<br>
</li>
<li>Anderson-Darling: Test whether a given sample is drawn from a given probability distribution.<br>
</li>
<li>Shapiro-Wilk: Test the null hypothesis that the data is drawn from a normal distribution.</li>
</ul>
<p>The same dataset will be used throughout the post, provided below:</p>
<div id="cell-2" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mpl</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> stats</span>
<span id="cb1-6"></span>
<span id="cb1-7">np.set_printoptions(suppress<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, precision<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb1-8"></span>
<span id="cb1-9">dat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.asarray([</span>
<span id="cb1-10">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">62.55976</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.71019</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20.67025</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">35.43758</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">10.65457</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">21.55292</span>, </span>
<span id="cb1-11">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">41.26359</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.33537</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.43599</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40.66612</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.45701</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">40.39694</span>, </span>
<span id="cb1-12">     <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">55.1221</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">24.50901</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.61822</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">29.10305</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.21494</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15.25862</span>,  </span>
<span id="cb1-13">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">13.54446</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.48212</span>,  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.34573</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">21.47846</span>,   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.0777</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">26.48881</span>, </span>
<span id="cb1-14">    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.68764</span>,  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.49631</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">42.58039</span>,  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.59111</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">23.08169</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">19.09755</span>, </span>
<span id="cb1-15">   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">21.35046</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.24064</span>,  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.16365</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">37.43091</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">24.48556</span>,    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.6263</span>,  </span>
<span id="cb1-16">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.14471</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.75287</span>,  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">46.8529</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">14.26814</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.41045</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">18.11071</span>, </span>
<span id="cb1-17">   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">30.46438</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">12.22195</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.83203</span>,  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">8.09629</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">52.06456</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">24.30986</span>, </span>
<span id="cb1-18">   <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">25.62359</span>,   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.86882</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15.77073</span>,  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">31.17838</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">22.04998</span></span>
<span id="cb1-19">    ])</span></code></pre></div>
</div>
<p>The task is to assess how well our data fits a normal distribution parameterized with mean and variance computed using:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cbar%7Bx%7D%20&amp;=%20%5Cfrac%7B1%7D%7Bn%7D%5Csum_%7Bi=1%7D%5E%7Bn%7D%20x_%7Bi%7D%20%5C%5C%0As%5E%7B2%7D%20&amp;=%20%5Cfrac%7B1%7D%7Bn-1%7D%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(x_%7Bi%7D%20-%20%5Cbar%7Bx%7D)%5E2%0A%5Cend%7Balign*%7D%0A"></p>
<p>Keep in mind that although we’re testing how well othe data can be approximated by a normal distribution, many of the tests we highlight (with the exception of Shapiro-Wilk) can assess the quality of fit for many different parametric models.</p>
<p>We begin with visual assessments of goodness-of-fit.</p>
<section id="q-q-plot" class="level3">
<h3 class="anchored" data-anchor-id="q-q-plot">Q-Q Plot</h3>
<p>The Q-Q plot compares two probability distributions by plotting their quantiles against each other. We compare standard normal quantiles (x-axis) against the empirical quantiles from the dataset of interest (y-axis). If the two distributions are similar, the points in the Q-Q plot will approximately lie on a straight line. There isn’t a hard and fast rule to determine how much deviation from the straight line is too much, but if the distributions are very different, it will be readily apparent in the Q-Q plot. We can construct a Q-Q plot from scratch using matplotlib as follows:</p>
<div id="cell-4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Generate qq-plot comparing data against standard normal distribution.</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-4"></span>
<span id="cb2-5">line_color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E02C70"</span></span>
<span id="cb2-6">dat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(dat)</span>
<span id="cb2-7">cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dat.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dat.size</span>
<span id="cb2-8">ndist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-9">theo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ndist.ppf(cdf)</span>
<span id="cb2-10"></span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove observations containing Inf.</span></span>
<span id="cb2-13">x, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>[tt <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> tt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(theo, dat) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> np.Inf <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tt <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.Inf <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> tt])</span>
<span id="cb2-14"></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Obtain coefficients for best fit regression line.</span></span>
<span id="cb2-16">b1, b0, _, _, _ <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.linregress(x, y)</span>
<span id="cb2-17">yhat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [b1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b0 <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> x]</span>
<span id="cb2-18"></span>
<span id="cb2-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Determine upper and lower axis bounds.</span></span>
<span id="cb2-20">xmin, xmax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(x), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(x)</span>
<span id="cb2-21">ymin, ymax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(y) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(y) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-22"></span>
<span id="cb2-23">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-24">ax.set_title(</span>
<span id="cb2-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Q-Q Plot: Data vs. Standard Normal Distribution"</span>,</span>
<span id="cb2-26">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb2-27">    )</span>
<span id="cb2-28">ax.scatter(x, y, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.75</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb2-29">ax.plot(x, yhat, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>line_color, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>)</span>
<span id="cb2-30">ax.set_xlim(left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>xmin, right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>xmax)</span>
<span id="cb2-31">ax.set_ylim(bottom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ymin, top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ymax)</span>
<span id="cb2-32">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Empirical Quantiles"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>)</span>
<span id="cb2-33">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Standard Normal Quantiles"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>)</span>
<span id="cb2-34">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb2-35">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb2-36">ax.xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb2-37">ax.yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb2-38">ax.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb2-39">ax.set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb2-40">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gof-python-scipy/gof-python-scipy_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The points seem to mostly follow a straight line, but there are observations that deviate from strict linearity. However, there’s nothing here that disqualifies our dataset from being modeled with normal distribution.</p>
</section>
<section id="p-p-plot" class="level3">
<h3 class="anchored" data-anchor-id="p-p-plot">P-P Plot</h3>
<p>The P-P plot compares two cumulative distribution functions against each other. To produce a P-P plot, we plot the theoretical percentiles (x-axis) against empirical percentiles (y-axis), so that each axis ranges from 0-1. The line of comparison is the 45 degree line running from (0,0) to (1,1). The distributions are equal if and only if the plot falls on this line: any deviation indicates a difference between the distributions. The code to generate a P-P plot is provided below:</p>
<div id="cell-6" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Create P-P plot, which compares theoretical normal percentiles (x-axis) against </span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">empirical percentiles (y-axis).</span></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb3-5">dat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(dat)</span>
<span id="cb3-6">dat_mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dat.mean()</span>
<span id="cb3-7">dat_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dat.std(ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standardize dat.</span></span>
<span id="cb3-10">sdat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (dat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> dat_mean) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dat_std</span>
<span id="cb3-11">cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dat.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dat.size</span>
<span id="cb3-12">ndist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-13">theo <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ndist.cdf(sdat)</span>
<span id="cb3-14">x, y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> theo, cdf</span>
<span id="cb3-15"></span>
<span id="cb3-16">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb3-17">ax.set_title(</span>
<span id="cb3-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P-P Plot: Empricial CDF vs. Standard Normal CDF"</span>,</span>
<span id="cb3-19">    color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb3-20">    )</span>
<span id="cb3-21"></span>
<span id="cb3-22">ax.scatter(x, y, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.75</span>, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>)</span>
<span id="cb3-23">ax.plot([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>line_color, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>)</span>
<span id="cb3-24">ax.set_xlim(left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-25">ax.set_ylim(bottom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-26">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Empirical Cumulative Distribution"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>)</span>
<span id="cb3-27">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Standard Normal Distribution"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>)</span>
<span id="cb3-28">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb3-29">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb3-30">ax.xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb3-31">ax.yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb3-32">ax.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb3-33">ax.set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb3-34">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gof-python-scipy/gof-python-scipy_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Although the observations follow the linear trend in general, the data overall appear somewhat above the reference line <img src="https://latex.codecogs.com/png.latex?y=x">. This may be attributable to the mean of <code>dat</code> being greater than 0. However, this doesn’t eliminate the possibility of our data representing a sample from a normal population. We expect some deviation from the expected normal percentiles, which we see in the P-P plot.</p>
</section>
<section id="histogram-with-parametric-overlay" class="level3">
<h3 class="anchored" data-anchor-id="histogram-with-parametric-overlay">Histogram with Parametric Overlay</h3>
<p>For the next diagnostic we create a histogram which represents the density of the empirical data overlaid with a parameterized normal distribution.</p>
<div id="cell-8" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Plot histogram with best-fit normal distribution overlay.</span></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb4-4">dist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dat_mean, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dat_std)</span>
<span id="cb4-5">xdist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(dat.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(), dat.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(), <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.01</span>)</span>
<span id="cb4-6">ydist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dist.pdf(xdist)</span>
<span id="cb4-7"></span>
<span id="cb4-8">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-9">ax.set_title(</span>
<span id="cb4-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Empirical Data w/ Parametric Overlay"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>,</span>
<span id="cb4-11">    loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb4-12">    )</span>
<span id="cb4-13">ax.hist(</span>
<span id="cb4-14">    dat, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E02C70"</span>, </span>
<span id="cb4-15">    edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb4-16">    )</span>
<span id="cb4-17"></span>
<span id="cb4-18">ax.plot(xdist, ydist, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.75</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>)</span>
<span id="cb4-19">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb4-20">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb4-21">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb4-22">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb4-23">ax.xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb4-24">ax.yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb4-25">ax.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-26">ax.set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb4-27">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gof-python-scipy/gof-python-scipy_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The data appear to follow a pattern roughly the shape outlined by a best-fit normal density.</p>
</section>
<section id="kolmogorov-smirnov-test" class="level3">
<h3 class="anchored" data-anchor-id="kolmogorov-smirnov-test">Kolmogorov-Smirnov Test</h3>
<p>The Kolmogorov-Smirnov Test is different than the previous set of visualizations in that it produces a metric used to assess the level of agreement between target and reference distributions, but a visual diagnostic can be obtained as well.</p>
<p>Suppose that we have a set of empirical data that we assume originates from some distribution <img src="https://latex.codecogs.com/png.latex?F">. The Kolmogorov-Smirnov statistic is used to test:</p>
<blockquote class="blockquote">
<p><img src="https://latex.codecogs.com/png.latex?H_%7B0%7D"> : the samples come from <img src="https://latex.codecogs.com/png.latex?F"></p>
</blockquote>
<p>against:</p>
<blockquote class="blockquote">
<p><img src="https://latex.codecogs.com/png.latex?H_%7B1%7D"> : The samples do not come from <img src="https://latex.codecogs.com/png.latex?F"></p>
</blockquote>
<p>The test compares the empirical distribution function of the data, <img src="https://latex.codecogs.com/png.latex?F_%7Bobs%7D">, with the cumulative distribution function associated with the null hypothesis, <img src="https://latex.codecogs.com/png.latex?F_%7Bexp%7D"> (the expected CDF).</p>
<p>The Kolmogorov-Smirnov statistic is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AD_%7Bn%7D%20=%20max%7CF_%7Bexp%7D(x)%20-%20F_%7Bobs%7D(x)%7C.%0A"></p>
<p>Assuming the data are ordered such that <img src="https://latex.codecogs.com/png.latex?x_%7B1%7D"> represents the the minimum value in the dataset and <img src="https://latex.codecogs.com/png.latex?x_%7Bn%7D"> the maximum value, the empirical CDF can be represented as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AF_%7Bobs%7D(x_%7Bi%7D)%20=%20%5Cfrac%7Bi%7D%7Bn%7D,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?n"> is the number of observations in the dataset.</p>
<p>For each observation, compute the absolute differences between <img src="https://latex.codecogs.com/png.latex?F_%7Bexp%7D(x)"> and <img src="https://latex.codecogs.com/png.latex?F_%7Bobs%7D(x)">. The Kolmogorov-Smirnov statistic <img src="https://latex.codecogs.com/png.latex?D_%7Bn%7D"> is the maximum value from the vector of absolute differences. This value represents the maximum absolute distance between the expected and observed distribution functions. <img src="https://latex.codecogs.com/png.latex?D_%7Bn%7D"> is then compared to a table of critical values to assess whether to reject or fail to reject <img src="https://latex.codecogs.com/png.latex?H_%7B0%7D">.</p>
<p>Before computing the statistic, we first demonstrate how to generate the one-sample Kolmogorov-Smirnov comparison plot:</p>
<div id="cell-11" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Kolmogorov-Smirnov test visualization.</span></span>
<span id="cb5-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-4">dat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(dat)</span>
<span id="cb5-5">dat_mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dat.mean()</span>
<span id="cb5-6">dat_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dat.std(ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-7">sdat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (dat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> dat_mean) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dat_std</span>
<span id="cb5-8">cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dat.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dat.size</span>
<span id="cb5-9">dist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb5-10"></span>
<span id="cb5-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate Kolmogorov-Smirnov comparison plot.</span></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># y0 : Values from reference distribution.</span></span>
<span id="cb5-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># y1 : Values from empirical distribution.</span></span>
<span id="cb5-14">ecdfpairs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(sdat, cdf)</span>
<span id="cb5-15">ecdfpairs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [ii <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> ecdfpairs <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> np.Inf <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>np.Inf <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> ii]</span>
<span id="cb5-16">x, y1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>ecdfpairs)</span>
<span id="cb5-17">x <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.asarray(x, dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>)</span>
<span id="cb5-18">y0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dist.cdf(x)</span>
<span id="cb5-19">y1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.asarray(y1, dtype<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>)</span>
<span id="cb5-20"></span>
<span id="cb5-21">absdiffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(y1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> y0)</span>
<span id="cb5-22">indx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.argwhere(absdiffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> absdiffs.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()).ravel()[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb5-23">xann, y0ann, y1ann  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> x[indx], y0[indx], y1[indx]</span>
<span id="cb5-24">ypoint <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (y1ann <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> y0ann) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb5-25">xy, xyp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (xann, ypoint), (xann <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.3</span>, ypoint <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.1</span>)</span>
<span id="cb5-26"></span>
<span id="cb5-27">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-28">xmin, xmax, ymin, ymax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>(x), <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>(x), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-29">ax.set_title(</span>
<span id="cb5-30">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kolmogorov-Smirnov Illustration"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb5-31">    loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span></span>
<span id="cb5-32">    )</span>
<span id="cb5-33">ax.set_xlim(left<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>xmin, right<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>xmax)</span>
<span id="cb5-34">ax.set_ylim(bottom<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ymin, top<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>ymax)</span>
<span id="cb5-35">ax.plot(x, y0, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Reference CDF"</span>)</span>
<span id="cb5-36">ax.step(x, y1, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f33455"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, where<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pre"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Empirical CDF"</span>)</span>
<span id="cb5-37">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb5-38">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb5-39">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CDF"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb5-40">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"z"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb5-41">ax.xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb5-42">ax.yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb5-43">ax.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-44">ax.set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb5-45">plt.annotate(</span>
<span id="cb5-46">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Maximum Absolute Distance"</span>, xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>xy, xytext<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>xyp,</span>
<span id="cb5-47">    arrowprops<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>(facecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, shrink<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.025</span>, headwidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.5</span>)</span>
<span id="cb5-48">    )</span>
<span id="cb5-49">ax.legend(</span>
<span id="cb5-50">    frameon<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper left"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"medium"</span>, fancybox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-51">    )</span>
<span id="cb5-52">plt.show()</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gof-python-scipy/gof-python-scipy_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The Kolmogorov-Smirnov statistic is computed as the greatest absolute distance between the empirical and expected CDFs. Computing the statistic is straightforward:</p>
<div id="cell-13" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"></span>
<span id="cb6-2">dat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(dat)</span>
<span id="cb6-3">cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dat.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dat.size</span>
<span id="cb6-4">dat_mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dat.mean()</span>
<span id="cb6-5">dat_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dat.std(ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-6"></span>
<span id="cb6-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parameterized expected normal distribution.</span></span>
<span id="cb6-8">expnorm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dat_mean, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dat_std)</span>
<span id="cb6-9">expcdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expnorm.cdf(dat)</span>
<span id="cb6-10"></span>
<span id="cb6-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute difference between datcdf and expcdf.</span></span>
<span id="cb6-12">absdiffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> expcdf)</span>
<span id="cb6-13">D0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> absdiffs.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb6-14"></span>
<span id="cb6-15">D0</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0.07194182492411011</code></pre>
</div>
</div>
<p>We can compare our value of <img src="https://latex.codecogs.com/png.latex?D"> with the value obtained from <code>scipy.stats.kstest</code>, which takes as arguments the empirical dataset and a callable representing the CDF of the expected distribution, and returns the D-statistic as well as the p-value associated with the computed D-statistic (note that critical values depend on the number of observations). The manually computed result is given by <code>D0</code>, the result returned from <code>scipy.stats.kstest</code> by <code>D1</code>:</p>
<div id="cell-15" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"></span>
<span id="cb8-2">dat <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.sort(dat)</span>
<span id="cb8-3">cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.arange(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, dat.size <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> dat.size</span>
<span id="cb8-4">dat_mean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dat.mean()</span>
<span id="cb8-5">dat_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dat.std(ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Parameterized expected normal distribution.</span></span>
<span id="cb8-8">expnorm <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.norm(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dat_mean, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dat_std)</span>
<span id="cb8-9">expcdf  <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> expnorm.cdf(dat)</span>
<span id="cb8-10">absdiffs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">abs</span>(cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> expcdf)</span>
<span id="cb8-11">D0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> absdiffs.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>()</span>
<span id="cb8-12">D1, p1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.kstest(dat, expnorm.cdf)</span>
<span id="cb8-13"></span>
<span id="cb8-14"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Our D         : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>D0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.8}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Scipy kstest D: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>D1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.8}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"kstest p-value: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.8}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Our D         : 0.071941825
Scipy kstest D: 0.071941825
kstest p-value: 0.92828027</code></pre>
</div>
</div>
<p>The p-value (the second element of the 2-tuple returned by <code>scipy.stats.kstest</code>) is 0.9283. How should this result be interpreted?</p>
<p>For the one-sample Kolmogorov-Smirnov test, the null hypothesis is that the distributions are the same. Thus, the lower the p-value the greater the statistical evidence you have to reject the null hypothesis and conclude the distributions are different. <em>The test only lets you speak of your confidence that the distributions are different, not the same, since the test is designed to find the probability of Type I error</em>. Therefore, if <img src="https://latex.codecogs.com/png.latex?D"> is less than the critical value, we do not reject the null hypothesis (corresponds to a large p-value). If <img src="https://latex.codecogs.com/png.latex?D"> is greater than the critical value, we reject the null hypothesis (corresponds to a small p-value).</p>
<p>Given our p-value of 0.9326, we do not have sufficient evidence to reject the null hypothesis that the distributions are the same.</p>
</section>
<section id="the-anderson-darling-test" class="level3">
<h3 class="anchored" data-anchor-id="the-anderson-darling-test">The Anderson-Darling Test</h3>
<p>The Anderson-Darling test tests the null hypothesis that a sample is drawn from a population that follows a particular distribution. It makes use of the fact that when given a hypothesized underlying distribution and assuming the data is a sample from this distribution, the CDF of the data can be assumed to follow a uniform distribution. The statistic itself can be expressed as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AA%5E%7B2%7D%20&amp;=%20-n%20-%20S,%20%5Chspace%7B2mm%7D%20%5Ctext%7Bwhere%7D%20%5C%5C%0AS%20&amp;=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Cfrac%7B2i-1%7D%7Bn%7D%20%5CBig%5BLn(F(y_%7Bi%7D))%20+%20Ln(1%20-%20F(y_%7Bn+1-i%7D))%20%5CBig%5D%0A%5Cend%7Balign*%7D%0A"></p>
<p>The function <code>scipy.stats.anderson</code> takes as arguments the empirical dataset and a distribution to test against (one of “norm”, “expon”, “logistic”, “gumbel”, “gumbel_l” or “gumbel_rexponential”), and returns the Anderson-Darling test statistic, the critical values for the specified distribution and the significance levels associated with the critical values. For example, to test whether our dataset follows a normal distribution, we run the following:</p>
<div id="cell-17" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"></span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform Anderson-Darling test.</span></span>
<span id="cb10-3">A, crit, sig <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.anderson(dat, dist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"norm"</span>)</span>
<span id="cb10-4"></span>
<span id="cb10-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"A   : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>A<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"crit: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>crit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb10-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"sig : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sig<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A   : 0.22442637404651578
crit: [0.54  0.615 0.738 0.861 1.024]
sig : [15.  10.   5.   2.5  1. ]</code></pre>
</div>
</div>
<p>According to the <a href="https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.stats.anderson.html"><code>scipy.stats.anderson</code> documentation</a>, if the returned statistic is larger than the critical values, then for the corresponding significance level the null hypothesis (that the data come from the chosen distribution) can be rejected. Since our statistic 0.224426 is smaller than all critical values, we do not have sufficient evidence to reject the null hypothesis that the data come from a normal distribution.</p>
<p>A table of Anderson-Darling critical values can be found <a href="https://gist.github.com/jtrive84/8e856c402236e9b16f5bf5c165c7df7d/raw/a36497e47dba1f4bbeef95416524aa1efd033d58/AndersonDarling.pdf">here</a>.</p>
</section>
<section id="shapiro-wilk-test" class="level3">
<h3 class="anchored" data-anchor-id="shapiro-wilk-test">Shapiro-Wilk Test</h3>
<p>The Shapiro-Wilk test null hypothesis is that the sample is drawn from a normally distributed population. The function <code>scipy.stats.shapiro</code> takes the empirical dataset as it’s sole argument, and similar to <code>scipy.stats.kstest</code> returns a 2-tuple containing the test statistic and p-value.</p>
<div id="cell-19" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"></span>
<span id="cb12-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Perform Shapiro-Wilk test.</span></span>
<span id="cb12-3">W, p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.shapiro(dat)</span>
<span id="cb12-4"></span>
<span id="cb12-5"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"W: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>W<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb12-6"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>W: 0.9804516434669495
p: 0.5324737429618835</code></pre>
</div>
</div>
<p>If the p-value is less than the chosen alpha level, then the null hypothesis is rejected, and there is evidence that the data tested are not normally distributed. If the p-value is greater than the chosen alpha level, then the null hypothesis that the data came from a normally distributed population can not be rejected (e.g., for an alpha level of 0.05, a data set with a p-value of 0.05 rejects the null hypothesis that the data are from a normally distributed population). Our p-value is 0.532, so we cannot reject the null hypothesis.</p>
<p>A table of Shapiro-Wilk critical values can be downloaded <a href="https://gist.github.com/jtrive84/8e856c402236e9b16f5bf5c165c7df7d/raw/c403acff7af1837c03d9f16d0300b291546b7a3d/ShapiroWilk.pdf">here</a>.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/gof-python-scipy/gof-python-scipy.html</guid>
  <pubDate>Sat, 02 Mar 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Estimating Logistic Regression coefficients From Scratch in R</title>
  <link>https://www.jtrive.com/posts/logistic-from-scratch-r/logistic-from-scratch-r.html</link>
  <description><![CDATA[ 





<p>In this post, we highlight the parameter estimation routines called behind the scenes upon invocation of R’s glm function. Specifically, we’ll focus on how parameters of a logistic regression model are estimated when fit to data having a binary response.</p>
<p>R’s glm function is used to fit generalized linear models, specified by giving a symbolic description of the linear predictor and a description of the error distribution. This function conceals a good deal of the complexity behind a simple interface, making it easy to overlook the calculations that estimate a model’s coefficients. The goal of this post is to shed some light on the mechanics of those calculations.</p>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>In a generalized linear model the response may follow any distribution from the exponential family, and rather than assuming the mean is a linear function of the explanatory variables, we assume that a function of the mean (the link function) is a linear function of the explanatory variables.</p>
<p>Logistic regression is used for modeling data with a categorical response. Although it’s possible to model multinomial data using logistic regression, this article focuses only on fitting data having a dichotomous response (‘Yes/No’, ‘True/False’, ‘1/0’, ‘Good/Bad’).</p>
<p>The logistic regression model is a generalized linear model whose canonical link is the logit, or log-odds:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BLn%7D%20%5CBig(%5Cfrac%7B%5Cpi_%7Bi%7D%7D%7B1%20-%20%5Cpi_%7Bi%7D%7D%20%5CBig)%20=%20%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7D%7Bx%7D_%7Bi1%7D%20+%20%5Cdots%20+%20%5Cbeta_%7Bp%7D%7Bx%7D_%7Bip%7D,%20%5Cquad%20i%20=%20(1,%20%5Cdots%20,%20n).%0A"></p>
<p>Solving the logit for <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7Bi%7D">, which represents the predicted probability for a set of features <img src="https://latex.codecogs.com/png.latex?x_%7Bi%7D">, yields</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cpi_%7Bi%7D%20=%20%5Cfrac%20%7Be%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7D%7Bx%7D_%7Bi1%7D%20+%20%5Cdots%20+%20%5Cbeta_%7Bp%7D%7Bx%7D_%7Bip%7D%7D%7D%7B1%20+%20e%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7D%7Bx%7D_%7Bi1%7D%20+%20%5Cdots%20+%20%5Cbeta_%7Bp%7D%7Bx%7D_%7Bip%7D%7D%7D%20=%20%5Cfrac%20%7B1%7D%7B1%20+%20e%5E%7B-(%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7D%7Bx%7D_%7Bi1%7D%20+%20%5Cdots%20+%20%5Cbeta_%7Bp%7D%7Bx%7D_%7Bip%7D)%7D%7D,%0A"></p>
<p>Where <img src="https://latex.codecogs.com/png.latex?-%5Cinfty%20%3C%20x_%7Bi%7D%20%3C%20%5Cinfty"> and <img src="https://latex.codecogs.com/png.latex?0%3C%5Cpi_%7Bi%7D%3C1">.</p>
<p>In other words, the expression for <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7Bi%7D"> maps any real-valued <img src="https://latex.codecogs.com/png.latex?x_%7Bi%7D"> to a positive probability between 0 and 1.</p>
</section>
<section id="parameter-estimation" class="level3">
<h3 class="anchored" data-anchor-id="parameter-estimation">Parameter Estimation</h3>
<p>Maximum Likelihood Estimation can be used to determine the parameters of a Logistic Regression model, which entails finding the set of parameters for which the probability of the observed data is greatest. The objective is to estimate the <img src="https://latex.codecogs.com/png.latex?(p+1)"> unknown <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B0%7D,%20%5Cdots,%20%5Cbeta_%7Bp%7D">.</p>
<p>Let <img src="https://latex.codecogs.com/png.latex?Y_%7Bi%7D"> represent independent, dichotomous response values for each of <img src="https://latex.codecogs.com/png.latex?n"> observations, where <img src="https://latex.codecogs.com/png.latex?Y_%7Bi%7D=1"> denotes a success and <img src="https://latex.codecogs.com/png.latex?Y_%7Bi%7D=0"> denotes a failure. The density function of a single observation <img src="https://latex.codecogs.com/png.latex?Y_%7Bi%7D"> can be expressed as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap(y_%7Bi%7D)%20=%20%5Cpi_%7Bi%7D%5E%7By_%7Bi%7D%7D(1-%5Cpi_%7Bi%7D)%5E%7B1-y_%7Bi%7D%7D,%0A"></p>
<p>From which we obtain the likelihood function:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL(%5Cbeta)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20%5Cpi_%7Bi%7D%5E%7By_%7Bi%7D%7D(1-%5Cpi_%7Bi%7D)%5E%7B1-y_%7Bi%7D%7D.%0A"></p>
<p>Taking the natural log of the maximum likelihood estimate results in the log-likelihood function:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Al(%5Cbeta)%20&amp;=%20%5Cmathrm%7BLn%7D(L(%5Cbeta))%20=%20%5Cmathrm%7BLn%7D%20%5CBig(%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20%5Cpi_%7Bi%7D%5E%7By_%7Bi%7D%7D(1-%5Cpi_%7Bi%7D)%5E%7B1-y_%7Bi%7D%7D%20%5CBig)%20%5C%5C%0A&amp;=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_%7Bi%7D%20%5Cmathrm%7BLn%7D(%5Cpi_%7Bi%7D)%20+%20(1-y_%7Bi%7D)%5Cmathrm%7BLn%7D(1-%5Cpi_%7Bi%7D)%20%5C%5C%0A&amp;=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_%7Bi%7D(%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7D%7Bx%7D_%7Bi1%7D%20+%20%5Cdots%20+%20%5Cbeta_%7Bp%7D%7Bx%7D_%7Bip%7D)%20-%20%5Cmathrm%7BLn%7D(1%20+%20e%5E%7B%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7D%7Bx%7D_%7Bi1%7D%20+%20%5Cdots%20+%20%5Cbeta_%7Bp%7D%7Bx%7D_%7Bip%7D%7D)%0A%5Cend%7Balign*%7D%0A"></p>
<p>The first-order partial derivatives of the log-likelihood are calculated and set to zero for each <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7Bk%7D,%20k%20=%200,%201,%20%5Cdots,%20p">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%20%7B%5Cpartial%20l(%5Cbeta)%7D%7B%5Cpartial%20%5Cbeta_%7Bk%7D%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20y_%7Bi%7Dx_%7Bik%7D%20-%20%5Cpi_%7Bi%7Dx_%7Bik%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20x_%7Bik%7D(y_%7Bi%7D%20-%20%5Cpi_%7Bi%7D)%20=%200,%0A"></p>
<p>which can be represented in matrix form as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%20%7B%5Cpartial%20l(%5Cbeta)%7D%7B%5Cpartial%20%5Cbeta%7D%20=%20X%5E%7BT%7D(y%20-%20%5Cpi),%0A"></p>
<p>Where <img src="https://latex.codecogs.com/png.latex?X%5E%7BT%7D"> is a (p+1)xn matrix and <img src="https://latex.codecogs.com/png.latex?(y%20-%20%5Cpi)"> a nx1 vector.</p>
<p>The vector of first-order partial derivatives of the log-likelihood function is referred to as the score function, and is typically represented as <img src="https://latex.codecogs.com/png.latex?U">.</p>
<p>These <img src="https://latex.codecogs.com/png.latex?(p+1)"> equations are solved simultaneously to obtain the parameter estimates <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B0%7D,%20%5Cdots,%20%5Cbeta_%7Bp%7D">. Each solution specifies a critical-point which will be either a maximum or a minimum. The critical point will be a maximum if the matrix of second partial derivatives is negative definite (which means every element on the diagonal of the matrix is less than zero).</p>
<p>The matrix of second partial derivatives can be expressed as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta_%7Bk%7D%7D%7B%5Cpartial%20%5Cbeta_%7Bk%7D%7D%5E%7BT%7D%7D%20=%20-%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20x_%7Bik%7D%5Cpi_%7Bi%7D(1-%5Cpi_%7Bi%7D)%7Bx_%7Bik%7D%7D%5E%7BT%7D,%0A"></p>
<p>which can be represented as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20=%20-X%5E%7BT%7DWX,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?W"> is an nxn diagonal matrix of weights with each element equal to <img src="https://latex.codecogs.com/png.latex?%5Cpi_%7Bi%7D(1%20-%20%5Cpi_%7Bi%7D)"> for logistic regression models. In general, the weight matrix <img src="https://latex.codecogs.com/png.latex?W"> will have entries inversely proportional to the variance of the response.</p>
<p>Since no closed-form solution exists for determining logistic regression coefficients, iterative techniques must be employed.</p>
</section>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the Model</h3>
<p>Two distinct but related iterative methods can be utilized in determining model coefficients: the Newton-Raphson method and Fisher Scoring. The Newton-Raphson method relies on the matrix of second partial derivatives, also known as the Hessian. The Newton-Raphson update expression is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbeta%5E%7B(t+1)%7D%20=%20%5Cbeta%5E%7B(t)%7D%20-%20(H%5E%7B(t)%7D)%5E%7B-1%7DU%5E%7B(t)%7D,%0A"></p>
<p>where:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t+1)%7D"> = the vector of updated coefficient estimates.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t)%7D"> = the vector of coefficient estimates from the previous iteration.</li>
<li><img src="https://latex.codecogs.com/png.latex?(H%5E%7B(t)%7D)%5E%7B-1%7D"> = the inverse Hessian, <img src="https://latex.codecogs.com/png.latex?%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)%5E%7B-1%7D">.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?U%5E%7B(t)%7D"> = the vector of first-order partial derivatives of the log-likelihood function, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%20%7B%5Cpartial%20l(%5Cbeta)%7D%7B%5Cpartial%20%5Cbeta%7D%20=%20X%5E%7BT%7D(y%20-%20%5Cpi)">.</li>
</ul>
<p>The Newton-Raphson method starts with an initial guess for the solution, and obtains a second guess by approximating the function to be maximized in a neighborhood of the initial guess by a second-degree polynomial, and then finding the location of that polynomial’s maximum value. This process continues until it converges to the actual solution. The convergence of <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t)%7D"> to <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D"> is usually fast, with adequate convergence usually realized in fewer than 20 iterations.</p>
<p>Fisher Scoring utilizes the expected information, <img src="https://latex.codecogs.com/png.latex?-E%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)">. Let <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BI%7D"> serve as a stand-in for the expected value of the information:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathcal%7BI%7D%20=%20-E%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig).%0A"></p>
<p>The Fisher Scoring update step replaces <img src="https://latex.codecogs.com/png.latex?-H%5E%7B(t)%7D"> from Newton-Raphson with <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BI%7D%5E%7B(t)%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cbeta%5E%7B(t+1)%7D%20&amp;=%20%5Cbeta%5E%7B(t)%7D%20+%20(%5Cmathcal%7BI%7D%5E%7B(t)%7D)%5E%7B-1%7DU%5E%7B(t)%7D%20%5C%5C%0A&amp;=%20%5Cbeta%5E%7B(t)%7D%20+%20(X%5E%7BT%7DWX)%5E%7B-1%7DX%5E%7BT%7D(y%20-%20%5Cpi),%0A%5Cend%7Balign*%7D%0A"></p>
<p>where:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t+1)%7D"> = the vector of updated coefficient estimates.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(t)%7D"> = the vector of coefficient estimates from the previous iteration.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?(%5Cmathcal%7BI%7D%5E%7B(t)%7D)%5E%7B-1%7D"> = the inverse of the expected information matrix, <img src="https://latex.codecogs.com/png.latex?-E%20%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)%5E%7B-1%7D">.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?U%5E%7B(t)%7D"> = the vector of first-order partial derivatives of the log-likelihood function, <img src="https://latex.codecogs.com/png.latex?%5Cfrac%20%7B%5Cpartial%20l(%5Cbeta)%7D%7B%5Cpartial%20%5Cbeta%7D%20=%20X%5E%7BT%7D(y%20-%20%5Cpi)">.</li>
</ul>
<p>For GLM’s with a canonical link, the observed and expected information are the same. When the response follows an exponential family distribution and the canonical link function is employed, observed and expected Information coincide so that Fisher Scoring produces the same estimates as Newton-Raphson.</p>
<p>When the canonical link is used, the second partial derivatives of the log-likelihood do not depend on the observations <img src="https://latex.codecogs.com/png.latex?y_%7Bi%7D">, and therefore</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20=%20E%20%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20%5CBig).%0A"></p>
<p>Fisher scoring has the advantage that it produces the asymptotic covariance matrix as a by-product. To summarize:</p>
<ul>
<li>The Hessian is the matrix of second partial derivatives of the log-likelihood with respect to the parameters: <img src="https://latex.codecogs.com/png.latex?H%20=%20%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D">.<br>
</li>
<li>The observed information is <img src="https://latex.codecogs.com/png.latex?-%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D">.</li>
<li>The expected information is <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BI%7D%20=%20E%5CBig(-%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)">.<br>
</li>
<li>The asymptotic covariance matrix is <img src="https://latex.codecogs.com/png.latex?mathrm%7BVar%7D(%5Chat%7B%5Cbeta%7D)%20=%20E%5CBig(-%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)%5E%7B-1%7D%20=%20(X%5E%7BT%7DWX)%5E%7B-1%7D">.</li>
</ul>
<p>For models employing a canonical link function:</p>
<ul>
<li>The observed and expected information are the same: <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20=%20E%5CBig(%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)">.<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?H%20=%20-%5Cmathcal%7BI%7D">, or <img src="https://latex.codecogs.com/png.latex?%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%20=%20E%5CBig(-%5Cfrac%7B%5Cpartial%5E%7B2%7D%20l(%5Cbeta)%7D%7B%7B%5Cpartial%20%5Cbeta%7D%7B%5Cpartial%20%5Cbeta%7D%5E%7BT%7D%7D%5CBig)">.<br>
</li>
<li>The Newton-Raphson and Fisher Scoring algorithms yield identical results.</li>
</ul>
</section>
<section id="fisher-scoring-in-r" class="level3">
<h3 class="anchored" data-anchor-id="fisher-scoring-in-r">Fisher Scoring in R</h3>
<p>The data used for our sample calculation can be obtained <a href="https://gist.github.com/jtrive84/835514a76f7afd552c999e4d9134baa8">here</a>. This data represents O-ring failures in the 23 pre-Challenger space shuttle missions. In this dataset, TEMPERATURE serves as the single explanatory variable which will be used to predict “O_RING_FAILURE”, which is 1 if a failure occurred, 0 otherwise.</p>
<p>Once the parameters have been determined, the model estimate of the probability of success for a given observation can be calculated via:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Chat%5Cpi_%7Bi%7D%20=%20%5Cfrac%20%7Be%5E%7B%5Chat%5Cbeta_%7B0%7D%20+%20%5Chat%5Cbeta_%7B1%7D%7Bx%7D_%7Bi1%7D%20+%20%5Cdots%20+%20%5Chat%5Cbeta_%7Bp%7D%7Bx%7D_%7Bip%7D%7D%7D%7B1%20+%20e%5E%7B%5Chat%5Cbeta_%7B0%7D%20+%20%5Chat%5Cbeta_%7B1%7D%7Bx%7D_%7Bi1%7D%20+%20%5Cdots%20+%20%5Chat%5Cbeta_%7Bp%7D%7Bx%7D_%7Bip%7D%7D%7D%0A"></p>
<p><code>getCoefficients</code> returns the estimated model coefficients as a (p+1)x1 matrix. In addition, the function returns the number of scoring iterations, fitted values and resulting variance-covariance matrix.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"></span>
<span id="cb1-2">getCoefficients <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(design_matrix, response_vector, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0001</span>) {</span>
<span id="cb1-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># =========================================================================</span></span>
<span id="cb1-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># design_matrix      `X`     =&gt; n-by-(p+1)                                |</span></span>
<span id="cb1-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># response_vector    `y`     =&gt; n-by-1                                    |</span></span>
<span id="cb1-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># probability_vector `p`     =&gt; n-by-1                                    |</span></span>
<span id="cb1-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># weights_matrix     `W`     =&gt; n-by-n                                    |</span></span>
<span id="cb1-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># epsilon                    =&gt; threshold above which iteration continues |</span></span>
<span id="cb1-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># =========================================================================</span></span>
<span id="cb1-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># n                          =&gt; # of observations                         |</span></span>
<span id="cb1-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (p + 1)                    =&gt; # of parameters, +1 for intercept term    |</span></span>
<span id="cb1-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># =========================================================================</span></span>
<span id="cb1-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># U =&gt; First derivative of Log-Likelihood with respect to                 |</span></span>
<span id="cb1-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#      each beta_i, i.e. `Score Function`: X_transpose * (y - p)          |</span></span>
<span id="cb1-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                                                                         |</span></span>
<span id="cb1-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># I =&gt; Second derivative of Log-Likelihood with respect to                |</span></span>
<span id="cb1-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#      each beta_i. The `Information Matrix`: (X_transpose * W * X)       |</span></span>
<span id="cb1-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                                                                         |</span></span>
<span id="cb1-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># X^T*W*X results in a (p+1)-by-(p+1) matrix                              |</span></span>
<span id="cb1-20">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># X^T(y - p) results in a (p+1)-by-1 matrix                               |</span></span>
<span id="cb1-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (X^T*W*X)^-1 * X^T(y - p) results in a (p+1)-by-1 matrix                |</span></span>
<span id="cb1-22">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ========================================================================|</span></span>
<span id="cb1-23">    X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(design_matrix)</span>
<span id="cb1-24">    y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(response_vector)</span>
<span id="cb1-25"></span>
<span id="cb1-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize logistic function used for Scoring calculations.</span></span>
<span id="cb1-27">    pi_i <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(v) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(v) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(v)))</span>
<span id="cb1-28"></span>
<span id="cb1-29">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize beta_0, p_0, W_0, I_0 &amp; U_0.</span></span>
<span id="cb1-30">    beta_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(X)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ncol</span>(X), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byrow=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dimnames=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>)</span>
<span id="cb1-31">    p_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pi_i</span>(X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta_0)</span>
<span id="cb1-32">    W_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(p_0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p_0)))</span>
<span id="cb1-33">    I_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(X) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> W_0 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> X</span>
<span id="cb1-34">    U_0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(X) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p_0)</span>
<span id="cb1-35"></span>
<span id="cb1-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize variables for iteration.</span></span>
<span id="cb1-37">    beta_old <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> beta_0</span>
<span id="cb1-38">    iter_I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> I_0</span>
<span id="cb1-39">    iter_U <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> U_0</span>
<span id="cb1-40">    iter_p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> p_0</span>
<span id="cb1-41">    iter_W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> W_0</span>
<span id="cb1-42">    fisher_scoring_iterations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb1-43"></span>
<span id="cb1-44">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Iterate until difference between abs(beta_new - beta_old) &lt; epsilon.</span></span>
<span id="cb1-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) {</span>
<span id="cb1-46">        fisher_scoring_iterations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> fisher_scoring_iterations <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb1-47">        beta_new <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> beta_old <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(iter_I) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> iter_U</span>
<span id="cb1-48"></span>
<span id="cb1-49">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abs</span>(beta_new <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> beta_old) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> epsilon)) {</span>
<span id="cb1-50">            model_parameters <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> beta_new</span>
<span id="cb1-51">            fitted_values <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pi_i</span>(X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> model_parameters)</span>
<span id="cb1-52">            covariance_matrix <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">solve</span>(iter_I)</span>
<span id="cb1-53">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span></span>
<span id="cb1-54"></span>
<span id="cb1-55">        } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb1-56">            iter_p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pi_i</span>(X <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> beta_new)</span>
<span id="cb1-57">            iter_W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.vector</span>(iter_p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>iter_p)))</span>
<span id="cb1-58">            iter_I <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(X) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> iter_W <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> X</span>
<span id="cb1-59">            iter_U <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">t</span>(X) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%*%</span> (y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> iter_p)</span>
<span id="cb1-60">            beta_old <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> beta_new</span>
<span id="cb1-61">        }</span>
<span id="cb1-62">    }</span>
<span id="cb1-63"></span>
<span id="cb1-64">    results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-65">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'model_parameters'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>model_parameters, </span>
<span id="cb1-66">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'covariance_matrix'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>covariance_matrix,</span>
<span id="cb1-67">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'fitted_values'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>fitted_values,</span>
<span id="cb1-68">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'number_iterations'</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>fisher_scoring_iterations</span>
<span id="cb1-69">        )</span>
<span id="cb1-70"></span>
<span id="cb1-71">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(results)</span>
<span id="cb1-72">}</span></code></pre></div>
<p>A quick summary of R’s matrix operators:</p>
<ul>
<li><code>%*%</code> is a stand-in for matrix multiplication.<br>
</li>
<li><code>diag</code> returns a matrix with the provided vector as the diagonal and zero off-diagonal entries.</li>
<li><code>t</code> returns the transpose of the provided matrix.</li>
<li><code>solve</code> returns the inverse of the provided matrix (if it exists).</li>
</ul>
<p>Note that in our implementation, we solve the normal equations directly. You wouldn’t see this in practice or when using optimized numerical software packages. This is because since when confronted with solving ill-conditioned systems of equations, computing <img src="https://latex.codecogs.com/png.latex?(X%5E%7BT%7DWX)%5E%7B-1%7D"> effectively squares the condition number, which results in an answer with diminished accuracy. Optimized statistical computing packages instead leverage more stable methods such as the QR decomposition or SVD. But this suffices for our purposes.</p>
<p>We load the Challenger dataset and partition it into the design matrix and response, which will then be passed into <code>getCoefficients</code>:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(</span>
<span id="cb2-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Challenger.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, </span>
<span id="cb2-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringsAsFactors=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb2-4">    )</span>
<span id="cb2-5"></span>
<span id="cb2-6">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'TEMPERATURE'</span>]))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># design matrix</span></span>
<span id="cb2-7">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'O_RING_FAILURE'</span>])         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># response vector</span></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(X) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb2-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colnames</span>(y) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Call `getCoefficients`, keeping epsilon at .0001.</span></span>
<span id="cb2-13">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getCoefficients</span>(X, y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">epsilon=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0001</span>)</span></code></pre></div>
<p>Printing <code>results</code> displays the model’s estimated coefficients (<em>model_parameters</em>), the variance-covariance matrix of the coefficient estimates (<em>covariance_matrix</em>), fitted values (<em>fitted_values</em>) and the number of Fisher Scoring iterations (<em>number_iterations</em>):</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(results)</span>
<span id="cb3-2"></span>
<span id="cb3-3"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>model_parameters</span>
<span id="cb3-4">           [,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb3-5">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15.0429016</span></span>
<span id="cb3-6">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2321627</span></span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>covariance_matrix</span>
<span id="cb3-9">           [,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]        [,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb3-10">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.4442748</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.79638682</span></span>
<span id="cb3-11">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7963868</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01171514</span></span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted_values</span>
<span id="cb3-14">            [,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb3-15"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.43049313</span></span>
<span id="cb3-16"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22996826</span></span>
<span id="cb3-17"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.27362105</span></span>
<span id="cb3-18"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.32209405</span></span>
<span id="cb3-19"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.37472428</span></span>
<span id="cb3-20"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15804910</span></span>
<span id="cb3-21"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.12954602</span></span>
<span id="cb3-22"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22996826</span></span>
<span id="cb3-23"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85931657</span></span>
<span id="cb3-24">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.60268105</span></span>
<span id="cb3-25">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22996826</span></span>
<span id="cb3-26">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.04454055</span></span>
<span id="cb3-27">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.37472428</span></span>
<span id="cb3-28">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.93924781</span></span>
<span id="cb3-29">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.37472428</span></span>
<span id="cb3-30">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08554356</span></span>
<span id="cb3-31">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22996826</span></span>
<span id="cb3-32">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02270329</span></span>
<span id="cb3-33">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06904407</span></span>
<span id="cb3-34">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03564141</span></span>
<span id="cb3-35">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08554356</span></span>
<span id="cb3-36">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06904407</span></span>
<span id="cb3-37">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.82884484</span></span>
<span id="cb3-38"></span>
<span id="cb3-39"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>number_iterations</span>
<span id="cb3-40">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span></span></code></pre></div>
<p>For the Challenger dataset, our implementation of Fisher Scoring yields a <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B0%7D=15.0429016"> and <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1%7D=-0.2321627">. In order to predict new probabilities of O-ring failure based on temperature, our model relies on the following formula:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cpi%20=%20%5Cfrac%20%7Be%5E%7B15.0429016%20-0.2321627%20*%20%5Cmathrm%7BTemperature%7D%7D%7D%7B1%20+%20e%5E%7B15.0429016%20-0.2321627%20*%20%5Cmathrm%7BTemperature%7D%7D%7D%0A"></p>
<p>Negative coefficients correspond to variables that are negatively correlated with the probability of a positive outcome, the reverse being true for positive coefficients.</p>
<p>Lets compare the results of our implementation with the output of <code>glm</code> using the same dataset, and specifying family=“binomial” and link=“logit”:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read.table</span>(</span>
<span id="cb4-2">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Challenger.csv"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">header=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, </span>
<span id="cb4-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringsAsFactors=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb4-4">    )</span>
<span id="cb4-5"></span>
<span id="cb4-6">logistic.fit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(</span>
<span id="cb4-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula=</span>O_RING_FAILURE <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> TEMPERATURE,</span>
<span id="cb4-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">binomial</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">link=</span>logit), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>df</span>
<span id="cb4-9">    )</span></code></pre></div>
<p>From <code>logistic.fit</code>, we’ll extract <code>coefficients</code>, <code>fitted.values</code> and <code>iter</code>, and call <code>vcov(logistic.fit)</code> to obtain the variance-covariance matrix of the estimated coefficients:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> logistic.fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients</span>
<span id="cb5-2">(Intercept) TEMPERATURE </span>
<span id="cb5-3"> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15.0429016</span>  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2321627</span> </span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">matrix</span>(logistic.fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted.values)</span>
<span id="cb5-6">      [,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb5-7"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.43049313</span></span>
<span id="cb5-8"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22996826</span></span>
<span id="cb5-9"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.27362105</span></span>
<span id="cb5-10"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.32209405</span></span>
<span id="cb5-11"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.37472428</span></span>
<span id="cb5-12"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15804910</span></span>
<span id="cb5-13"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.12954602</span></span>
<span id="cb5-14"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22996826</span></span>
<span id="cb5-15"> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.85931657</span></span>
<span id="cb5-16">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.60268105</span></span>
<span id="cb5-17">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22996826</span></span>
<span id="cb5-18">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.04454055</span></span>
<span id="cb5-19">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.37472428</span></span>
<span id="cb5-20">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.93924781</span></span>
<span id="cb5-21">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.37472428</span></span>
<span id="cb5-22">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08554356</span></span>
<span id="cb5-23">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22996826</span></span>
<span id="cb5-24">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02270329</span></span>
<span id="cb5-25">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06904407</span></span>
<span id="cb5-26">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03564141</span></span>
<span id="cb5-27">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08554356</span></span>
<span id="cb5-28">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06904407</span></span>
<span id="cb5-29">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span>,] <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.82884484</span></span>
<span id="cb5-30"></span>
<span id="cb5-31"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> logistic.fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted.iter</span>
<span id="cb5-32"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb5-33"></span>
<span id="cb5-34"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vcov</span>(logistic.fit)</span>
<span id="cb5-35">             (Intercept) TEMPERATURE</span>
<span id="cb5-36">(Intercept)  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">54.4441826</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.79638547</span></span>
<span id="cb5-37">TEMPERATURE  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7963855</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01171512</span></span></code></pre></div>
<p>Our coefficients match exactly with those generated by glm, and as would be expected, the fitted values are also identical.</p>
<p>Notice there’s some discrepancy in the estimate of the variance-covariance matrix beginning with the 4th decimal (54.4442748 in our algorithm vrs. 54.4441826 for the variance of the Intercept term from glm). This may be due to rounding, or the loss of precision in floating point values when inverting matrices. Notice our implementation required one more Fisher Scoring iteration than glm (6 vrs. 5). Perhaps increasing the size of our epsilon will reduce the number of Fisher Scoring iterations, which in turn may lead to better agreement between the variance-covariance matrices.</p>
<p>Calling <code>summary(logistic.fit)</code> prints, among other things, the standard error of the coefficient estimates:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(logistic.fit)</span>
<span id="cb6-2">Coefficients<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb6-3">            Estimate Std. Error z value <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Pr</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">|</span>z<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>)  </span>
<span id="cb6-4">(Intercept)  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">15.0429</span>     <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.3786</span>   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.039</span>   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0415</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span>
<span id="cb6-5">TEMPERATURE  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2322</span>     <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1082</span>  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.145</span>   <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0320</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span></span></code></pre></div>
<p>The <em>Std. Error</em> values are the square root of the diagonal elements of the variance-covariance matrix, <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B54.4441826%7D%20=%207.3786"> and <img src="https://latex.codecogs.com/png.latex?%5Csqrt%7B0.01171512%7D%20=%200.1082">.</p>
<p><em>z value</em> is the estimated coefficient divided by <em>Std. Error</em>. In our example, <img src="https://latex.codecogs.com/png.latex?15.0429/7.3786=2.039"> and <img src="https://latex.codecogs.com/png.latex?-0.2322/0.1082%20=%20-2.145">. <em>Pr(&gt;|z|)</em> is the p-value, which tells us whether we should trust the estimated coefficient value. The standard rule of thumb is that coefficients with p-values less than 0.05 are reliable, although some tests require stricter thresholds.</p>
<p>A feature of Logistic Regression is that the training data’s marginal probabilities are preserved. If you aggregate fitted values from the training set, that quantity will equal the number of positive outcomes in the response vector (this is true for all exponential family GLMs employing a canonical link function):</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(y)</span>
<span id="cb7-2"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span></span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Checking sum for our algorithm.</span></span>
<span id="cb7-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(mySummary<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted_values)</span>
<span id="cb7-6"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span></span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#checking sum for glm.</span></span>
<span id="cb7-9"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(logistic.fit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>fitted.values)</span>
<span id="cb7-10"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span></span></code></pre></div>
</section>
<section id="using-the-model-to-calculate-probabilities" class="level2">
<h2 class="anchored" data-anchor-id="using-the-model-to-calculate-probabilities">Using The Model to Calculate Probabilities</h2>
<p>To apply the model generated by glm to a new set of explanatory variables, use the <code>predict</code> function. Pass a list or data.frame of explanatory variables to <code>predict</code>, and for logistic regression models, be sure to set <code>type="response"</code> to ensure probabilities are returned. For example:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># New inputs for Logistic Regression model.</span></span>
<span id="cb8-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> tempsDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">TEMPERATURE=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">46</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">47</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">61</span>))</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(logistic.fit, tempsDF, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>)</span>
<span id="cb8-5"></span>
<span id="cb8-6">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>         <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> </span>
<span id="cb8-7"><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9999230</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9960269</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9874253</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9841912</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7070241</span></span></code></pre></div>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>R</category>
  <guid>https://www.jtrive.com/posts/logistic-from-scratch-r/logistic-from-scratch-r.html</guid>
  <pubDate>Sat, 02 Mar 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Finding Roots of Equations in R with uniroot</title>
  <link>https://www.jtrive.com/posts/uniroot-r/uniroot-r.html</link>
  <description><![CDATA[ 





<p>Often times we encounter equations which cannot be solved using direct methods. Such systems of equations are commonly encountered within the context of maximum likelihood estimation, and in such cases, iterative methods can be used to obtain a solution.</p>
<p>Assume a set of observations representing ground-up property losses in dollars:</p>
<pre><code>19999  19974  5051  7179 34416  56840  4420  6558</code></pre>
<p>Our task is to fit a Weibull distribution to the loss data in order to produce a severity curve. The Weibull density is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(x;%5Clambda%20,k)%20=%20%5Cfrac%7Bk%7D%7B%5Clambda%7D%5CBig(%5Cfrac%7Bx%7D%7B%5Clambda%7D%5CBig)%5E%7Bk%20-%201%7D%5Cmathrm%7Bexp%7D%5Cbig%5B-(x/%5Clambda)%5Ek%5Cbig%5D,%0A"></p>
<p>where:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?k"> is the shape parameter, <img src="https://latex.codecogs.com/png.latex?k%20%5Cin%20(0,%20+%5Cinfty)."></li>
<li><img src="https://latex.codecogs.com/png.latex?%5Clambda"> is the scale parameter, <img src="https://latex.codecogs.com/png.latex?%5Clambda%20%5Cin%20(0,%20+%5Cinfty)">.</li>
<li><img src="https://latex.codecogs.com/png.latex?x%20%5Cin%20%5B0,%20+%5Cinfty%5D">.</li>
</ul>
<p>The expected value of the Weibull distribution is</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AE%5BX%5D%20=%20%5Clambda%5CGamma(1%20+%201/k),%0A"></p>
<p>and the median is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7Bmedian%7D%20=%20F(X%20%5Cleq%20.50)%20=%20%5Clambda(%5Cmathrm%7BLn%7D(2))%5E%7B1/k%7D.%0A"></p>
<p>The variance is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BVar%7D(X)%20=%20%5Clambda%5E2%5Cbig%5B%5CGamma%5Cbig(1%20+%202/k%5Cbig)%20-%20%5Cbig(%5CGamma(1%20+%201/k)%5Cbig)%5E2%5Cbig%5D.%0A"></p>
<p>In <img src="https://latex.codecogs.com/png.latex?E%5BX%5D">, <img src="https://latex.codecogs.com/png.latex?%5CGamma"> represents the gamma function, a generalization of the factorial expressed as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5CGamma%7B(z)%7D%20=%20%5Cint_%7B0%7D%5E%7B%5Cinfty%7D%20x%5E%7Bz-1%7De%5E%7B-x%7Ddx,%20%5Chspace%7B.50em%7D%20%5Cmathcal%7BR%7D(z)%20%3E%200.%0A"></p>
<p>The fitdistrplus library calculates parameter estimates given data and a hypothesized distribution. The <code>fitdist</code> function takes an optional <code>start</code> parameter, which represents initial parameter values associated with the hypothesized distribution. The Weibull distribution has two parameters that require estimation: <img src="https://latex.codecogs.com/png.latex?k">, the shape parameter and <img src="https://latex.codecogs.com/png.latex?%5Clambda">, the scale parameter. How can we come up with reasonable initial estimates of <img src="https://latex.codecogs.com/png.latex?k"> and <img src="https://latex.codecogs.com/png.latex?%5Clambda">?</p>
<p>First, notice that if the mean is divided by the median, <img src="https://latex.codecogs.com/png.latex?%5Clambda"> cancels, leaving a function of <img src="https://latex.codecogs.com/png.latex?k"> only. By setting what remains to the ratio of the empirical mean to median, the result will be an expression we can use to obtain an initial estimate of <img src="https://latex.codecogs.com/png.latex?k">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7BE%5BX%5D%7D%7B%5Cmathrm%7Bmedian%7D%7D%20=%201.421915%20=%20%5Cfrac%7B%5CGamma(1%20+%201/k)%7D%7B%5Cmathrm%7BLn%7D(2)%5E%7B1/k%7D%7D%0A"></p>
<p>As a consequence of the Gamma function in the right-hand-side numerator, we cannot solve for <img src="https://latex.codecogs.com/png.latex?k"> using direct methods. In R, we use <code>uniroot</code> to estimate roots of univariate functions numerically. In the code that follows, we implement a closure which returns a function which then can be evaluated and <code>k</code>, it’s sole argument, which <code>uniroot</code> will use to zero-in on a solution:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example solving for Weibull shape parameter using uniroot.</span></span>
<span id="cb2-2">lossData <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19999</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19974</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5051</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7179</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34416</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">56840</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4420</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6558</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calling shapeFunc returns a function, which can then be used by uniroot to find a solution.</span></span>
<span id="cb2-5">shapeFunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(v) {</span>
<span id="cb2-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute ratio of empirical mean to median.</span></span>
<span id="cb2-7">    ratio <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(v) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(v)</span>
<span id="cb2-8">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(k) {</span>
<span id="cb2-9">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gamma</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> k)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> k))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ratio)</span>
<span id="cb2-10">    }</span>
<span id="cb2-11">}</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Evaluate shapeFunc. ff is a function which takes a single argument `k`. </span></span>
<span id="cb2-14">ff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shapeFunc</span>(lossData)</span></code></pre></div>
<p>The body of <code>shapeFunc</code> is a straightforward implementation of our ratio expression above. The only difference is the expression is set to 0 by subtracting the ratio (1.421915) from both sides. We have our function <code>ff</code> and the interval over which to search for a solution <img src="https://latex.codecogs.com/png.latex?0%20%5Clt%20k%20%5Cleq%20%5Cmathrm%7Bmax%7D(%5Cmathrm%7BlossData%7D))">. The call to <code>uniroot</code> is made below:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">shape <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uniroot</span>(ff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.Machine<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>double.eps, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(lossData)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>root</span></code></pre></div>
<p>Since <img src="https://latex.codecogs.com/png.latex?k"> is strictly greater than 0, we set the search interval lower bound to <code>.Machine$double.eps</code>, which represents the smallest positive floating-point value <img src="https://latex.codecogs.com/png.latex?x"> such that <img src="https://latex.codecogs.com/png.latex?1%20+%20x%20!=%201">. Our initial estimate for the shape parameter given our data is <img src="https://latex.codecogs.com/png.latex?%5Chat%7Bk%7D%20=%201.018877">. To determine an initial estimate for the scale parameter, we can use the fact that</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Clambda%20=%20%5Cfrac%7BE%5BX%5D%7D%7B%5CGamma(1%20+%201%20/%20%5Chat%7Bk%7D)%7D,%0A"></p>
<p>resulting in <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Clambda%7D%20=%2019454.27">.</p>
<section id="obtaining-maximum-likelihood-estimates" class="level3">
<h3 class="anchored" data-anchor-id="obtaining-maximum-likelihood-estimates">Obtaining Maximum Likelihood Estimates</h3>
<p>With our hypothesized distribution and initial parameters, obtaining maximum likelihood estimates is straightforward. The initial parameter estimation code is included again for convenience:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Computing maximum likelihood estimates using fitdistrplus.</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fitdistplus"</span>)</span>
<span id="cb4-3"></span>
<span id="cb4-4">lossData <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19999</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19974</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5051</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7179</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34416</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">56840</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4420</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6558</span>)</span>
<span id="cb4-5"></span>
<span id="cb4-6">shapeFunc <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(v) {</span>
<span id="cb4-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute ratio of empirical mean to median.</span></span>
<span id="cb4-8">    ratio <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(v) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">median</span>(v)</span>
<span id="cb4-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(k) {</span>
<span id="cb4-10">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>((<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gamma</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> k)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> k))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> ratio)</span>
<span id="cb4-11">    }</span>
<span id="cb4-12">}</span>
<span id="cb4-13"></span>
<span id="cb4-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Evaluate shapeFunc. ff is a function which takes a single argument `k`. </span></span>
<span id="cb4-15">ff <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">shapeFunc</span>(lossData)</span>
<span id="cb4-16"></span>
<span id="cb4-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initial shape parameter estimate.</span></span>
<span id="cb4-18">shape0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uniroot</span>(ff, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">interval=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.Machine<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>double.eps, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(lossData)))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>root</span>
<span id="cb4-19"></span>
<span id="cb4-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initial scale parameter estimate.</span></span>
<span id="cb4-21">scale0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(lossData) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gamma</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> shape0))</span>
<span id="cb4-22"></span>
<span id="cb4-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Obtain mle parameter estimates.</span></span>
<span id="cb4-24">mleFit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> fitdistrplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitdist</span>(</span>
<span id="cb4-25">    lossData, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">distr=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weibull"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mle"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>shape0, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span>scale0)</span>
<span id="cb4-26">    )</span></code></pre></div>
<p>Accessing <code>mleFit</code>’s <code>estimate</code> attribute, parameter estimates are:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> mleFit<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>estimate</span>
<span id="cb5-2">        shape        scale </span>
<span id="cb5-3">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.177033</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">20525.761478</span> </span></code></pre></div>
<p>Which is close to our initial starting parameter estimates.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>R</category>
  <guid>https://www.jtrive.com/posts/uniroot-r/uniroot-r.html</guid>
  <pubDate>Sat, 24 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>LogLikelihood Estimation in R with optim</title>
  <link>https://www.jtrive.com/posts/lle-optim-r/lle-optim-r.html</link>
  <description><![CDATA[ 





<p>There are many R packages available to assist with finding maximum likelihood estimates based on a given set of data (for example, <a href="https://cran.r-project.org/web/packages/fitdistrplus/fitdistrplus.pdf">fitdistrplus</a>), but implementing a routine to find MLEs is a great way to learn how to use the <code>optim</code> subroutine. In the example that follows, I’ll demonstrate how to find the shape and scale parameters for a Gamma distribution using synthetically generated data via maximum likelihood.</p>
<p>The available parameters for <code>optim</code> are given below:</p>
<pre><code>optim(par, fn, gr=NULL, ...,
      method=c("Nelder-Mead", "BFGS", "CG", "L-BFGS-B", "SANN", "Brent"),
      lower=-Inf, upper=Inf,
      control=list(), hessian=FALSE)

par 
Initial values for the parameters to be optimized over.

fn  
A function to be minimized (or maximized), with first argument the vector of 
parameters over which minimization is to take place. It should return a scalar 
result.

gr  
A function to return the gradient for the "BFGS", "CG" and "L-BFGS-B" methods. 
If it is NULL, a finite-difference approximation will be used.

For the "SANN" method it specifies a function to generate a new candidate 
point. If it is NULL a default Gaussian Markov kernel is used.

... 
Further arguments to be passed to fn and gr.

method  
The method to be used. See 'Details'. Can be abbreviated.

lower, upper    
Bounds on the variables for the "L-BFGS-B" method, or bounds in which to search 
for method "Brent".

control 
a list of control parameters. See 'Details'.

hessian 
Logical. Should a numerically differentiated Hessian matrix be returned?
</code></pre>
<p><code>optim</code> is passed a function which takes a single vector argument representing the parameters we hope to find (<code>fn</code>) along with a starting point from which the selected optimization routine begins searching (<code>par</code>), with one starting value per parameter.</p>
<p>The gamma distribution can be parameterized in a number of ways, but for this demonstration, we use the shape-scale parameterization, with density given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(x%7C%5Ctheta,%20%5Calpha)%20=%20%5Cfrac%7Bx%5E%7B%5Calpha-1%7De%5E%7B-x/%5Ctheta%7D%7D%7B%5Ctheta%5E%7B%5Calpha%7D%20%5CGamma(%5Calpha)%7D,%0A%5Chspace%7B.50em%7D%20x%20%3E=%200;%20%5Chspace%7B.50em%7D%5Calpha,%20%5Ctheta%20%3E%200,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Calpha%7D"> represents the shape parameter and <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Ctheta%7D"> the scale parameter. The Gamma distribution has variance in proportion to the mean, which differs from the normal distribution which has constant variance across observations. Specifically, for gamma distributed random variable <img src="https://latex.codecogs.com/png.latex?X">, the mean and variance are:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AE%5BX%5D%20=%20%5Calpha%20%5Ctheta%20%5Chspace%7B1.0em%7D%20Var%5BX%5D%20=%20%20%5Calpha%20%5Ctheta%5E%7B2%7D%0A"></p>
<p>A useful feature of the gamma distribution is that it has a constant coefficient of variation:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BCV%7D%20=%20%5Csigma%20/%20%5Cmu%20=%20%5Csqrt%7B%5Cmathrm%7BVar%7D%5BX%5D%7D%20/%20%5Cmathrm%7BE%7D%5BX%5D%20=%20%5Csqrt%7B%5Calpha%20%5Ctheta%5E%7B2%7D%7D%20/%20%5Calpha%20%5Ctheta%20=%201%20/%20%5Csqrt%7B%5Calpha%7D.%0A"></p>
<p>Thus, for any values of <img src="https://latex.codecogs.com/png.latex?x"> fit to a gamma distribution with parameters <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> and <img src="https://latex.codecogs.com/png.latex?%5Calpha">, the ratio of the standard deviation to the mean will always equate to <img src="https://latex.codecogs.com/png.latex?1%20/%20%5Csqrt%7B%5Calpha%7D">.</p>
<section id="maximum-likelihood-estimation" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-estimation">Maximum Likelihood Estimation</h3>
<p>Maximum likelihood estimation (MLE) is a technique used to estimate parameters for a candidate model or distributional form. Essentially, MLE aims to identify which parameter(s) make the observed data most likely, given the specified model. In practice, we do not know the values of the proposed model parameters but we do know the data. We use the likelihood function to observe how the function changes for different parameter values while holding the data fixed. This can be used to judge which parameter values lead to greater likelihood of the sample occurring.</p>
<p>The joint density of <img src="https://latex.codecogs.com/png.latex?n"> independently distributed observations is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Cmathbf%7Bx%7D%7C%5Cboldsymbol%7B%5Cbeta%7D)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20f_%7Bi%7D(x_%7Bi%7D%7C%5Cbeta),%20%5Chspace%7B0.5em%7D%201%20%5Cleq%20i%20%5Cleq%20n.%0A"></p>
<p>When this expression is interpreted as a function of unknown <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7B%5Cbeta%7D"> given known data <img src="https://latex.codecogs.com/png.latex?x">, we obtain the likelihood function:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathcal%7BL%7D(%5Cmathbf%7B%5Cbeta%7D%7C%5Cmathbf%7Bx%7D)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20f_%7Bi%7D(x_%7Bi%7D%7C%5Cmathbf%7B%5Cbeta%7D).%0A"></p>
<p>Solving the likelihood equation can be difficult. This can be partially alleviated by logging the likelihood expression, which results in an expression for the loglikelihood. When solving the likelihood, it is often necessary to take the derivative of the expression to find the optimum (although not all optimizers are gradient based). It is much more computationally stable and conceptually straightforward to take the derivate of an additive function of independent observations (loglikelihood) as opposed to a multiplicative function of independent observations (likelihood). The loglikelihood is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathcal%7Bl%7D(%5Cmathbf%7B%5Cbeta%7D%7C%5Cmathbf%7Bx%7D)%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Cmathrm%7BLn%7D(f_%7Bi%7D(x_%7Bi%7D%7C%5Cmathbf%7B%5Cbeta%7D)),%20%5Chspace%7B0.5em%7D%201%20%5Cleq%20i%20%5Cleq%20n.%0A"></p>
<p>Referring back to the shape-scale parameterized gamma distribution, the joint density is represented as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(x%7C%5Ctheta,%20%5Calpha)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%5Cfrac%7Bx_%7Bi%7D%5E%7B%5Calpha-1%7De%5E%7B-x_%7Bi%7D/%5Ctheta%7D%7D%7B%5Ctheta%5E%7B%5Calpha%7D%20%5CGamma(%5Calpha)%7D,%0A%5Chspace%7B.50em%7D%20x_%7Bi%7D%20%3E=%200;%20%5Chspace%7B.50em%7D%5Calpha,%20%5Ctheta%20%3E%200,%0A"></p>
<p>Taking the natural log of the joint density results in the loglikelihood for our proposed distributional form:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathcal%7Bl%7D(%5Cmathbf%7B%5Ctheta,%20%5Calpha%7D%7C%5Cmathbf%7Bx%7D)%20=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%5Cmathrm%7BLn%7D%5CBig(%5Cfrac%7Bx_%7Bi%7D%5E%7B%5Calpha-1%7De%5E%7B-x_%7Bi%7D/%5Ctheta%7D%7D%7B%5Ctheta%5E%7B%5Calpha%7D%20%5CGamma(%5Calpha)%7D%5CBig)%0A"></p>
<p>Expanding the loglikelihood and focusing on a single observation <img src="https://latex.codecogs.com/png.latex?x_%7Bi%7D"> yields:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BLn%7D(x_%7Bi%7D%5E%7B%5Calpha%20-1%7D)%20+%20%5Cmathrm%7BLn%7D(e%5E%7B-x_%7Bi%7D%20/%20%5Ctheta%7D)%20-%20%5Cmathrm%7BLn%7D(%5Ctheta%5E%7B%5Calpha%7D)%20-%20%5Cmathrm%7BLn%7D(%5CGamma(%5Calpha)).%0A"></p>
<p>Now considering all observations, after a bit of rearranging and simplification we obtain</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathcal%7Bl%7D(%5Cmathbf%7B%5Ctheta,%20%5Calpha%7D%7C%5Cmathbf%7Bx%7D)%20=%20(%5Calpha%20-1)%5Csum_%7Bi=1%7D%5E%7Bn%7D%5Cmathrm%7BLn%7D(x_%7Bi%7D)%20-%20%5Ctheta%5E%7B-1%7D%5Csum_%7Bi=1%7D%5E%7Bn%7Dx_%7Bi%7D%20-%20n%20%5Calpha%20%5Cmathrm%7BLn%7D(%5Ctheta)%20-n%5Cmathrm%7BLn%7D(%5CGamma(%5Calpha)).%0A"></p>
<p>Next, the the partial derivatives w.r.t. <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> and <img src="https://latex.codecogs.com/png.latex?%5Calpha"> would be obtained and set equal to zero in order to find the solutions directly or in an iterative fashion. But when using <code>optim</code>, we only need to go as far as producing an expression for the joint loglikelihood over the set of observations.</p>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<p>The function eventually passed along to <code>optim</code> will be implemented as a closure. A closure is a function which returns another function. A trivial example would be one in which an outer function wraps and inner function that computes the product of two numbers, which is then raised to a power specified as an argument accepted by the outer function. You’d be correct to think this problem could just as easily be solved as a 3-parameter function. However, you’d be required to pass the 3rd argument representing the degree to which the product should be raised every time the function is called. An advantage of closures is that any parameters associated with the outer function are global variables from the perspective of the inner function, which is useful in many scenarios.</p>
<p>Next we implement a closure as described in the previous paragraph: The inner function takes two numeric values, <code>a</code> and <code>b</code>, and returns the product <code>a * b</code>. The outer function takes a single numeric argument, <code>pow</code>, which determines the degree to which the product should be raised. The final value returned by the function will be <code>(a * b)^pow</code>:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Closure in which a power is specified upon initialization. Then, for each subsequent</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># invocation, the product a * b is raised to pow. </span></span>
<span id="cb2-3">prodPow <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(pow) {</span>
<span id="cb2-4">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(a, b) {</span>
<span id="cb2-5">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>((a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> b)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>pow)</span>
<span id="cb2-6">    }</span>
<span id="cb2-7">}</span></code></pre></div>
<p>To initialize the closure, we call <code>prodPow</code>, but only pass the argument for <code>pow</code>. We will inspect the result and show that it is a function:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> func <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">proPow</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb3-2"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(func)</span>
<span id="cb3-3">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function"</span></span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">formals</span>(func))</span>
<span id="cb3-6">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span></span></code></pre></div>
<p>The object bound to <code>func</code> is a function with two arguments, <code>a</code> and <code>b</code>. If we invoke <code>func</code> by specifying arguments for <code>a</code> and <code>b</code>, we expect a numeric value to be returned representing the product raised to the 3rd power:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">func</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb4-2">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">512</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">func</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb4-5">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9261</span></span></code></pre></div>
</section>
<section id="gamma-loglikelihood" class="level3">
<h3 class="anchored" data-anchor-id="gamma-loglikelihood">Gamma LogLikelihood</h3>
<p>We next implement the gamma loglikelihood as a closure. The reason for doing this has to do with the way in which <code>optim</code> works. The arguments associated with the function passed to <code>optim</code> should consist of a vector of the parameters of interest, which in our case is a vector representing <img src="https://latex.codecogs.com/png.latex?(%5Calpha,%20%5Ctheta)">. By implementing the function as a closure, we can reference the set of observations (<code>vals</code>) from the scope of the inner function without having to pass the data as an argument for the function being optimized. This is very useful, since, if you recall from our final expression for the loglikelihood, it is necessary to compute <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bi=1%7D%5E%7Bn%7D%5Cmathrm%7BLn%7D(x_%7Bi%7D)"> and <img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bi=1%7D%5E%7Bn%7Dx_%7Bi%7D"> at each evaluation. It is far more efficient to compute these quantities once then reference them from the inner function as necessary without requiring recomputation.</p>
<p>The Gamma loglikelihood closure is provided below:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Loglikelihood for the Gamma distribution. The outer function accepts the set of observations.</span></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The inner function takes a vector of parameters (alpha, theta), and returns the loglikelihood. </span></span>
<span id="cb5-3">gammaLLOuter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(vals) {</span>
<span id="cb5-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -------------------------------------------------------------</span></span>
<span id="cb5-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return a function representing the the Gamma loglikelihood. |</span></span>
<span id="cb5-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `n` represents the number of observations in vals.          |</span></span>
<span id="cb5-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `s` represents the sum of vals with NAs removed.            |</span></span>
<span id="cb5-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `l` represents the sum of log(vals) with NAs removed.       |</span></span>
<span id="cb5-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -------------------------------------------------------------</span></span>
<span id="cb5-10">    n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(vals)</span>
<span id="cb5-11">    s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-12">    l <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(vals), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-13">    </span>
<span id="cb5-14">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(v) {</span>
<span id="cb5-15">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------------------------------</span></span>
<span id="cb5-16">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># v represents a length-2 vector of parameters alpha      |</span></span>
<span id="cb5-17">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (shape) and theta (scale).                              | </span></span>
<span id="cb5-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Returns the loglikelihood.                              |</span></span>
<span id="cb5-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------------------------------</span></span>
<span id="cb5-20">        a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> v[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb5-21">        theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> v[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb5-22">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>((a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> l  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (theta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> s  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(theta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gamma</span>(a)))</span>
<span id="cb5-23">    }</span>
<span id="cb5-24">}</span></code></pre></div>
<p>50 random observations from a gamma distribution with Gaussian noise are generated using <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%205"> and <img src="https://latex.codecogs.com/png.latex?%5Ctheta%20=%2010000">. We know beforehand the data originate from a gamma distribution with noise. We want to verify that the optimization routine can recover these parameters given only the data:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shape</span></span>
<span id="cb6-2">theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale</span></span>
<span id="cb6-3">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb6-4">vals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span>n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>a, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span>theta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span>n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span></code></pre></div>
<p>Referring back to the call signature for <code>optim</code>, we need to provide initial parameter values for the optimization routine (the <code>par</code> argument). Using 0 can sometimes suffice, but since <img src="https://latex.codecogs.com/png.latex?%5Calpha,%20%5Ctheta%20%3E%200">, different values must be provided. We can leverage the gamma distribution’s constant coefficient of variation to get an initial estimate of the shape parameter <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B0%7D">, then use <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B0%7D"> along with the empirical mean to back out an initial scale parameter estimate, <img src="https://latex.codecogs.com/png.latex?%5Ctheta_%7B0%7D%20=%20E%5BX%5D%20/%20%5Calpha_%7B0%7D">. In R, this is accomplished as follows:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get initial estimates for a, theta. </span></span>
<span id="cb7-2"> valsMean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empirical mean of vals.</span></span>
<span id="cb7-3"> valsStd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># empirical standard deviation of vals.</span></span>
<span id="cb7-4"> a0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> (valsMean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> valsStd)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>       <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial shape parameter estimate.</span></span>
<span id="cb7-5"> theta0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> valsMean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> a0            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># initial scale parameter estimate.</span></span></code></pre></div>
<p>We have everything we need to compute maximum likelihood estimates. Two final points: By default, <code>optim</code> minimizes the function passed into it. Since we’re looking to maximize the loglikelihood, we need to include an additional argument to the <code>control</code> parameter as <code>list(fnscale=-1)</code> to ensure <code>optim</code> returns the maximum. Second, there are a number of different optimizers from which to choose. A generally good choice is “BFGS”, which I use here.</p>
<p>We initialize <code>gammaLLOuter</code> with <code>vals</code>, then pass the initial parameter values along with <code>method="BFGS"</code> and <code>control=list(fnscale=-1)</code> into <code>optim</code>:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generating maximum likelihood estimates from data assumed to follow a gamma distribution. </span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scipen=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9999</span>)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb8-4"></span>
<span id="cb8-5"></span>
<span id="cb8-6">gammaLLOuter <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(vals) {</span>
<span id="cb8-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -------------------------------------------------------------</span></span>
<span id="cb8-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Return a function representing the the Gamma loglikelihood. |</span></span>
<span id="cb8-9">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `n` represents the number of observations in vals.          |</span></span>
<span id="cb8-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `s` represents the sum of vals with NAs removed.            |</span></span>
<span id="cb8-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `l` represents the sum of log(vals) with NAs removed.       |</span></span>
<span id="cb8-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -------------------------------------------------------------</span></span>
<span id="cb8-13">    n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(vals)</span>
<span id="cb8-14">    s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-15">    l <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(vals), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-16">    </span>
<span id="cb8-17">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(v) {</span>
<span id="cb8-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------------------------------</span></span>
<span id="cb8-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># `v` represents a length-2 vector of parameters alpha    |</span></span>
<span id="cb8-20">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># (shape) and theta (scale).                              | </span></span>
<span id="cb8-21">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Returns the loglikelihood.                              |</span></span>
<span id="cb8-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ---------------------------------------------------------</span></span>
<span id="cb8-23">        a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> v[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb8-24">        theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> v[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]</span>
<span id="cb8-25">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>((a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> l  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> (theta<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> s  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> a <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(theta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gamma</span>(a)))</span>
<span id="cb8-26">    }</span>
<span id="cb8-27">}</span>
<span id="cb8-28"></span>
<span id="cb8-29"></span>
<span id="cb8-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate 50 random Gamma observations with Gaussian noise. </span></span>
<span id="cb8-31">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>         <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># shape</span></span>
<span id="cb8-32">theta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># scale</span></span>
<span id="cb8-33">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb8-34">vals <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span>n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span>a, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale=</span>theta) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span>n, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, theta <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb8-35"></span>
<span id="cb8-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize gammaLL.</span></span>
<span id="cb8-37">gammaLL <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gammaLLOuter</span>(vals)</span>
<span id="cb8-38"></span>
<span id="cb8-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Determine initial estimates for shape and scale.</span></span>
<span id="cb8-40"> valsMean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-41"> valsStd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sd</span>(vals, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb8-42"> a0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> (valsMean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> valsStd)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> </span>
<span id="cb8-43"> theta0 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> valsMean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> a0</span>
<span id="cb8-44"> paramsInit <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(a0, theta0)</span>
<span id="cb8-45"></span>
<span id="cb8-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Dispatch arguments to optim.</span></span>
<span id="cb8-47">paramsMLE <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">optim</span>(</span>
<span id="cb8-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par=</span>paramsInit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fn=</span>gammaLL, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BFGS"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">control=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fnscale=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-49">    )</span></code></pre></div>
<p><code>optim</code> returns a list with a number of elements. We are concerned primarily with three elements:</p>
<ul>
<li><code>convergence</code>: Specifies whether the optimization converged to a solution. 0 means yes,<br>
any other number means it did not converge.</li>
<li><code>par</code>: A vector of parameter estimates.</li>
<li><code>value</code>: The maximized loglikelihood.</li>
</ul>
<p>If you plug in the values for <img src="https://latex.codecogs.com/png.latex?%5Calpha"> and <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> from <code>paramsMLE$par</code>, you would get a value equal to <code>paramsMLE$value.  Checking the values returned by the call to</code>optim` above, we have:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> paramsMLE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>convergence</span>
<span id="cb9-2">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb9-3"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> paramsMLE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>par</span>
<span id="cb9-4">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.234362</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9515.717485</span></span>
<span id="cb9-5"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> paramsMLE<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value</span>
<span id="cb9-6">[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">566.4171</span></span></code></pre></div>
<p>Let’s compare our estimates against estimates produced by <code>fitdistrplus</code>. We need to scale our data by 100, otherwise <code>fitdist</code> throws an error:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> fitdistrplus<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fitdist</span>(vals<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gamma"</span>)</span>
<span id="cb10-2">Fitting of the distribution <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">' gamma '</span> by maximum likelihood </span>
<span id="cb10-3">Parameters<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span></span>
<span id="cb10-4">        estimate  Std. Error</span>
<span id="cb10-5">shape <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.35617640</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.983440540</span></span>
<span id="cb10-6">rate  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.01077757</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.002056568</span></span></code></pre></div>
<p>If we reciprocate the estimate for “rate” and multiply by 100 (the amount we divided <code>vals</code> by in the call to <code>fitdist</code>), we get a scale estimate of 9278.53. Note that dividing by 100 works for the Gamma density, since it is an exponential scale family distribution, but this will not work for distributions generally. In summary:</p>
<pre><code>                          shape        scale
Our estimate         : 5.234362   9515.71748
fitdistrplus estimate: 5.356176   9278.52939
% difference         : 2.22743%     2.55631%</code></pre>
<p>We find the estimates for each parameter are within 3% of one another.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>R</category>
  <guid>https://www.jtrive.com/posts/lle-optim-r/lle-optim-r.html</guid>
  <pubDate>Wed, 21 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Online Mean and Variance Update without Full Recalculation</title>
  <link>https://www.jtrive.com/posts/online-updates/online-updates.html</link>
  <description><![CDATA[ 





<p>Imagine you are responsible for maintaining the mean and variance of a dataset that is frequently updated. For small-to-moderately sized datasets, much thought might not be given to the method used for recalculation. However, with datasets consisting of hundreds of billions or trillions of observations, full recomputation of the mean and variance at each refresh may require significant computational resources that may not be available.</p>
<p>Fortunately it isn’t necessary to perform a full recalculation of mean and variance when accounting for new observations. Recall that for a sequence of <img src="https://latex.codecogs.com/png.latex?n"> observations <img src="https://latex.codecogs.com/png.latex?x_%7B1%7D,%20%5Cdots%20x_%7Bn%7D"> the sample mean <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7Bn%7D"> and variance <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7Bn%7D%5E%7B2%7D"> are given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%20%20%20%20%20%20%20%5Cmu_%7Bn%7D%20&amp;=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20x_%7Bi%7D%20%5C%5C%0A%5Csigma_%7Bn%7D%5E%7B2%7D%20&amp;=%20%5Cfrac%7B1%7D%7Bn-1%7D%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(x_%7Bi%7D%20-%20%5Cmu_%7Bn%7D)%5E%7B2%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>A new observation <img src="https://latex.codecogs.com/png.latex?x_%7Bn+1%7D"> becomes available. To calculate the updated mean <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7Bn+1%7D"> and variance <img src="https://latex.codecogs.com/png.latex?%5Csigma_%7Bn+1%7D%5E%7B2%7D"> in light of this new observation without requiring full recalculation, we can use the following:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmu_%7Bn+1%7D%20&amp;=%20%5Cfrac%7B1%7D%7Bn+1%7D(n%5Cmu_%7Bn%7D%20+%20x_%7Bn+1%7D)%20%5C%5C%0A%5Csigma_%7Bn+1%7D%5E%7B2%7D%20&amp;=%20%5Cfrac%7Bn%7D%7Bn+1%7D%5Csigma_%7Bn%7D%5E%7B2%7D%20+%20%5Cfrac%7B1%7D%7Bn%7D(x_%7Bn+1%7D%20-%20%5Cmu_%7Bn+1%7D)%5E%7B2%7D%0A%5Cend%7Balign*%7D%0A"></p>
<section id="demonstration" class="level3">
<h3 class="anchored" data-anchor-id="demonstration">Demonstration</h3>
<p>Consider the following values:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A1154%5Chspace%7B2mm%7D717%5Chspace%7B2mm%7D958%5Chspace%7B2mm%7D1476%5Chspace%7B2mm%7D889%5Chspace%7B2mm%7D1414%5Chspace%7B2mm%7D1364%5Chspace%7B2mm%7D1047%0A"></p>
<p>The mean and variance for the observations:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%20%20%20%20%20%20%20%5Cmu_%7B8%7D%20&amp;%5Capprox%201127.38%20%5C%5C%0A%5Csigma_%7B8%7D%5E%7B2%7D%20&amp;%5Capprox%2065096.48%0A%5Cend%7Balign*%7D%0A"></p>
<p>A new value, <img src="https://latex.codecogs.com/png.latex?1251"> becomes available. Full recalculation of mean and variance yields:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%20%20%20%20%20%20%20%5Cmu_%7B8%7D%20&amp;%5Capprox%20%5Cmathbf%7B1141.11%7D%20%5C%5C%0A%5Csigma_%7B8%7D%5E%7B2%7D%20&amp;%5Capprox%20%5Cmathbf%7B59372.99%7D%0A%5Cend%7Balign*%7D%0A"></p>
<p>The mean and variance calculated using online update results in:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmu_%7B9%7D%20&amp;=%20%5Cfrac%7B1%7D%7B9%7D(8(1127.38)%20+%201251)%20%5Capprox%20%5Cmathbf%7B1141.11%7D%20%5C%5C%0A%5Csigma_%7B9%7D%5E%7B2%7D%20&amp;=%20%5Cfrac%7B8%7D%7B9%7D%20(65096.48)%20+%20%5Cfrac%7B1%7D%7B8%7D(1251%20-%201141.11)%5E%7B2%7D%20%5Capprox%20%5Cmathbf%7B59372.99%7D,%0A%5Cend%7Balign*%7D%0A"></p>
<p>confirming agreement between the two approaches.</p>
<p>Note that the variance returned using the online update formula is the population variance. In order to return the updated unbiased sample variance, we need to multiply the variance returned by the online update formula by <img src="https://latex.codecogs.com/png.latex?(n+1)/n">, where <img src="https://latex.codecogs.com/png.latex?n"> represents the length of the original array excluding the new observation. Thus, the updated sample variance after accounting for the new value is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0As_%7Bn+1%7D%5E%7B2%7D%20&amp;=%20%5Cfrac%7Bn+1%7D%7Bn%7D%5Cbig(%5Cfrac%7Bn%7D%7Bn+1%7D%5Csigma_%7Bn%7D%5E%7B2%7D%20+%20%5Cfrac%7B1%7D%7Bn%7D(x_%7Bn+1%7D%20-%20%5Cmu_%7Bn+1%7D)%5E%7B2%7D%5Cbig)%20%5C%5C%0As_%7B9%7D%5E%7B2%7D%20%20%20&amp;=%20%5Cfrac%7B9%7D%7B8%7D(59372.99)%20%5Capprox%2066794.61%0A%5Cend%7Balign*%7D%0A"></p>
</section>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<p>A straightforward implementation in Python to handle online mean and variance updates, incorporating Bessel’s correction to return the unbiased sample variance is provided below:</p>
<div id="cell-2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-2"></span>
<span id="cb1-3"></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> online_mean(mean_init, n, new_obs):</span>
<span id="cb1-6">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Return updated mean in light of new observation without</span></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    full recalculation.</span></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-10">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span>((n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> mean_init <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> new_obs) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb1-11"></span>
<span id="cb1-12"></span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> online_variance(var_init, mean_new, n, new_obs):</span>
<span id="cb1-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Return updated variance in light of new observation without</span></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    full recalculation. Includes Bessel's correction to return</span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    unbiased sample variance. </span></span>
<span id="cb1-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> ((n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (((n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> var_init) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (((new_obs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> mean_new)<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n))</span>
<span id="cb1-21"></span>
<span id="cb1-22"></span>
<span id="cb1-23"></span>
<span id="cb1-24"></span>
<span id="cb1-25">a0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1154</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">717</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">958</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1476</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">889</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1414</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1364</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1047</span>])</span>
<span id="cb1-26"></span>
<span id="cb1-27">a1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.array([<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1154</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">717</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">958</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1476</span>,  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">889</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1414</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1364</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1047</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1251</span>])</span>
<span id="cb1-28"></span>
<span id="cb1-29"></span>
<span id="cb1-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Original mean and variance.</span></span>
<span id="cb1-31">mean0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a0.mean()    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1127.38</span></span>
<span id="cb1-32">variance0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a0.var() <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 65096.48</span></span>
<span id="cb1-33"></span>
<span id="cb1-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Full recalculation mean and variance with new observation.</span></span>
<span id="cb1-35">mean1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a1.mean()    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1141.11</span></span>
<span id="cb1-36">variance1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a1.var(ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 59372.99</span></span>
<span id="cb1-37"></span>
<span id="cb1-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Online update of mean and variance with bias correction.</span></span>
<span id="cb1-39">mean2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> online_mean(mean0, a0.size, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1251</span>)                     <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1141.11</span></span>
<span id="cb1-40">variance2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> online_variance(variance0, mean2, a0.size, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1251</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 66794.61</span></span>
<span id="cb1-41"></span>
<span id="cb1-42"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Full recalculation mean    : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mean1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-43"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Full recalculation variance: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>variance1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-44"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Online calculation mean    : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mean2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-45"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Online calculation variance: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>variance2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Full recalculation mean    : 1,141.11111
Full recalculation variance: 66,794.61111
Online calculation mean    : 1,141.11111
Online calculation variance: 66,794.61111</code></pre>
</div>
</div>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/online-updates/online-updates.html</guid>
  <pubDate>Sun, 18 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Smoothing Data with Cubic Splines in R</title>
  <link>https://www.jtrive.com/posts/spline-smoothing-r/spline-smoothing-r.html</link>
  <description><![CDATA[ 





<p>In this article, three approaches to smooth data will be demonstrated:</p>
<ol type="1">
<li>standard polynomial regression</li>
<li>cubic B-spline regression</li>
<li>smoothing splines</li>
</ol>
<p>The data will a set of loss development factors (LDFs) associated with an unidentified line of business. Instead of smoothing LDFs patterns directly, we first compute the cumulative loss development factors (CLDFs), then take the reciprocal to obtain Percent of Ultimate factors. Doing so will generally (not always) result in a monotonically increasing factor as a function of time. The code that follows prepares our data:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data.table"</span>)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ggplot2"</span>)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">options</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scipen=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9999</span>)</span>
<span id="cb1-4"></span>
<span id="cb1-5">ldfs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb1-6">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.85637</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.58402</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.37531</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.3001</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.21469</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.28128</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.15415</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.09783</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.09302</span>, </span>
<span id="cb1-7">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.06395</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.04992</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.04659</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05164</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.03117</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0236</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.06338</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.03234</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0172</span>, </span>
<span id="cb1-8">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01795</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01813</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01413</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00863</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01346</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00372</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00423</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00683</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.04633</span>, </span>
<span id="cb1-9">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01796</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02279</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00629</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00205</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00316</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.007</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02828</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00117</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00303</span>, </span>
<span id="cb1-10">    <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00055</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02272</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00678</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00152</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00013</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01347</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00071</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00136</span></span>
<span id="cb1-11">    )</span>
<span id="cb1-12"></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute cumulative development factors.</span></span>
<span id="cb1-14">cldfs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumprod</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rev</span>(ldfs)))</span>
<span id="cb1-15"></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute percent-of-ultimate factors. </span></span>
<span id="cb1-17">pous <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> cldfs</span>
<span id="cb1-18"></span>
<span id="cb1-19">DF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.table</span>(</span>
<span id="cb1-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xinit=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(pous), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ldf0=</span>ldfs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cldf0=</span>cldfs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>pous, </span>
<span id="cb1-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stringsAsFactors=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb1-22">    )</span>
<span id="cb1-23"></span>
<span id="cb1-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rescale `dev` to fall between 0-1.</span></span>
<span id="cb1-25">DF[,x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(DF))]</span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setcolorder</span>(</span>
<span id="cb1-28">    DF, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xinit"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ldf0"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cldf0"</span>)</span>
<span id="cb1-29">    )</span></code></pre></div>
<p>Fields in <code>DF</code> are defined as follows:</p>
<ul>
<li><code>xinit</code>: Original development period. 1 &lt;= <code>xinit</code> &lt;= 45.</li>
<li><code>x</code>: <code>xinit</code> rescaled to [0,1].</li>
<li><code>y</code>: Percent-of-ultimate factors.</li>
<li><code>ldf0</code>: Original unsmoothed loss development factors.</li>
<li><code>cldf0</code>: Original unsmoothed cumulative loss development factors.</li>
</ul>
<p>Inspecting our data yields:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">     xinit          x          y    ldf0     cldf0</span>
<span id="cb2-2"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.00000000</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.03022475</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.85637</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">33.085464</span></span>
<span id="cb2-3"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.02272727</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.08633308</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.58402</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">11.583045</span></span>
<span id="cb2-4"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.04545455</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.13675333</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.37531</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.312436</span></span>
<span id="cb2-5"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.06818182</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.18807822</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.30010</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.316937</span></span>
<span id="cb2-6"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.09090909</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.24452049</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.21469</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.089637</span></span>
<span id="cb2-7"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.11363636</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.29701659</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.28128</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.366815</span></span>
<span id="cb2-8"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.13636364</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.38056142</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.15415</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.627697</span></span>
<span id="cb2-9"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.15909091</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.43922497</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.09783</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.276738</span></span>
<span id="cb2-10"> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>      <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.18181818</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.48219434</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.09302</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.073853</span></span>
<span id="cb2-11"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.20454545</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.52704806</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.06395</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.897360</span></span>
<span id="cb2-12"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.22727273</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.56075279</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.04992</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.783317</span></span>
<span id="cb2-13"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25000000</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.58874556</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.04659</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.698527</span></span>
<span id="cb2-14"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.27272727</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.61617522</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05164</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.622915</span></span>
<span id="cb2-15"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.29545455</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.64799451</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.03117</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.543223</span></span>
<span id="cb2-16"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.31818182</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.66819250</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02360</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.496575</span></span>
<span id="cb2-17"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.34090909</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.68396184</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.06338</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.462070</span></span>
<span id="cb2-18"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">17</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.36363636</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.72731134</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.03234</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.374927</span></span>
<span id="cb2-19"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.38636364</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75083259</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01720</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.331855</span></span>
<span id="cb2-20"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.40909091</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.76374691</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01795</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.309334</span></span>
<span id="cb2-21"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.43181818</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.77745617</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01813</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.286246</span></span>
<span id="cb2-22"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.45454545</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.79155145</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01413</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.263342</span></span>
<span id="cb2-23"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.47727273</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.80273607</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00863</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.245739</span></span>
<span id="cb2-24"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">23</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.50000000</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.80966368</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01346</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.235081</span></span>
<span id="cb2-25"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.52272727</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.82056176</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00372</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.218677</span></span>
<span id="cb2-26"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.54545455</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.82361425</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00423</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.214161</span></span>
<span id="cb2-27"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">26</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.56818182</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.82709813</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00683</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.209046</span></span>
<span id="cb2-28"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">27</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.59090909</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.83274721</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.04633</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.200845</span></span>
<span id="cb2-29"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">28</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.61363636</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.87132839</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01796</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.147673</span></span>
<span id="cb2-30"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">29</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.63636364</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.88697745</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02279</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.127424</span></span>
<span id="cb2-31"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.65909091</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90719167</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00629</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.102303</span></span>
<span id="cb2-32"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">31</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.68181818</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.91289790</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00205</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.095413</span></span>
<span id="cb2-33"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70454545</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.91476934</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00316</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.093172</span></span>
<span id="cb2-34"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">33</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.72727273</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.91766001</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00700</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.089728</span></span>
<span id="cb2-35"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">34</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.75000000</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.92408363</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02828</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.082153</span></span>
<span id="cb2-36"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.77272727</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95021672</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00117</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.052392</span></span>
<span id="cb2-37"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">36</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.79545455</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95132847</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00303</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.051162</span></span>
<span id="cb2-38"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">37</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">37</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.81818182</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95421100</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00055</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.047986</span></span>
<span id="cb2-39"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">38</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.84090909</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95473581</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.02272</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.047410</span></span>
<span id="cb2-40"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">39</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.86363636</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.97642741</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00678</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.024142</span></span>
<span id="cb2-41"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.88636364</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.98304759</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00152</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.017245</span></span>
<span id="cb2-42"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">41</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.90909091</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.98454182</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00013</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.015701</span></span>
<span id="cb2-43"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">42</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.93181818</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.98466981</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.01347</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.015569</span></span>
<span id="cb2-44"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">43</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">43</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95454545</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99793331</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00000</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.002071</span></span>
<span id="cb2-45"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">44</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.97727273</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99793331</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00071</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.002071</span></span>
<span id="cb2-46"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>     <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00000000</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.99864185</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.00136</span>  <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.001360</span></span>
<span id="cb2-47">     xinit          x          y    ldf0     cldf0</span></code></pre></div>
<section id="smoothing-via-polynomial-regression" class="level3">
<h3 class="anchored" data-anchor-id="smoothing-via-polynomial-regression">Smoothing via Polynomial Regression</h3>
<p>Polynomial regression is similar to standard linear regression, except the design matrix contains <code>x</code> raised to the desired power in each column. For example, assuming we have independent value <code>x</code> given by:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
<p>Instead of regressing a response <code>y</code> on <code>x</code> alone, polynomial regression fits <code>y</code> using the matrix <code>X</code>:</p>
<pre><code>     1  2   3
[1,] 2  4   8
[2,] 4 16  64
[3,] 7 49 343
[4,] 5 25 125
[5,] 2  4   8</code></pre>
<p>Notice each column represents <code>x</code> raised to the power in the column header. The first column is <img src="https://latex.codecogs.com/png.latex?x%5E%7B1%7D">, the second <img src="https://latex.codecogs.com/png.latex?x%5E%7B2%7D"> and the third <img src="https://latex.codecogs.com/png.latex?x%5E%7B3%7D">. Creating the design matrix in R can be accomplished using the <code>poly</code> function. Next we create the design matrix <code>X</code> and fit a polynomial regression model of degree 3 to our data:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">X <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">poly</span>(DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">degree=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">raw=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb5-2">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine design matrix with target response y (pous).</span></span>
<span id="cb5-5">DF1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDT</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind.data.frame</span>(X, y))</span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Call lm function. On RHS of formula, `.` specifies all columns in DF1 are to be used. </span></span>
<span id="cb5-8">mdl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>DF1)</span>
<span id="cb5-9"></span>
<span id="cb5-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind reference to fitted values as yhat1.</span></span>
<span id="cb5-11">DF[,yhat1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(mdl))]</span></code></pre></div>
<p>A visualization overlaying polynomial regression estimates with original percent-of-ultimate factors is presented below (this code will be reused for all exhibits that follow, with inputs updated as necessary):</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">exhibitTitle <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Polynomial Regression: Percent-of-Ultimate Modeled vs. Actual"</span>)</span>
<span id="cb6-2"></span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(DF) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xinit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual"</span>),  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xinit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>yhat1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_legend</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">override.aes=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#758585"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E02C70"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xinit), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xinit), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb6-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(exhibitTitle) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-10">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb6-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E02C70"</span>), </span>
<span id="cb6-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), </span>
<span id="cb6-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>),</span>
<span id="cb6-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb6-15">        )</span></code></pre></div>
<p><img src="https://www.jtrive.com/posts/spline-smoothing-r/Rsmooth1.png" class="img-fluid"></p>
<p>There is a generally good fit to actuals, but notice that for later development periods, estimates are increasing upward rather than leveling off asymptotically toward 1.0. This is one of the drawbacks of polynomial regression: The bases are non-local, meaning that the fitted value of <img src="https://latex.codecogs.com/png.latex?y"> at a given value <img src="https://latex.codecogs.com/png.latex?x=x_%7B0%7D"> depends strongly on data values for <img src="https://latex.codecogs.com/png.latex?x"> far from <img src="https://latex.codecogs.com/png.latex?x_%7B0%7D">. In modern statistical modeling applications, polynomial basis-functions are used along with new basis functions such as splines, introduced next.</p>
</section>
<section id="smoothing-via-b-spline-regression" class="level3">
<h3 class="anchored" data-anchor-id="smoothing-via-b-spline-regression">Smoothing via B-Spline Regression</h3>
<p>B-spline regression remedies the shortcomings of polynomial regression, namely the issue of non-locality. I’m going to demonstrate the usage of B-splines within the context of R rather than delve into the mathematical details. For an in-depth overview of B-splines, refer to <a href="https://web.stanford.edu/~hastie/Papers/ESLII.pdf"><em>Elements of Statistical Learning</em></a>, specifically chapter 5.</p>
<p>To perform B-spline regression in R, the <code>bs</code> function is used to generate the B-spline basis matrix for a polynomial spline. The number of spline knots to use is specified, along with the degree of polynomial to use (defaults to 3). We then generate the knot locations using the range of our independent value (<code>x</code>) and the number of knots using the <code>seq</code> function. Techniques can be used to minimize a cost function, such as LOOCV to minimize average MSE in order to determine the optimal number of knots, but we omit this step and instead arbitrarily choose 5 knots for the purposes of demonstration. As a rule-of-thumb, more knots leads to higher variance and lower bias.</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"splines"</span>)</span>
<span id="cb7-2"></span>
<span id="cb7-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y</span>
<span id="cb7-4">nbrSplineKnots <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb7-5"></span>
<span id="cb7-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Knot locations using data min/max and nbrSplineKnots. </span></span>
<span id="cb7-7">knotsSeq <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">length.out=</span>nbrSplineKnots)</span>
<span id="cb7-8"></span>
<span id="cb7-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create basis matrix using splines::bs. degree=3 represents cubic spline.</span></span>
<span id="cb7-10">Bbasis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bs</span>(DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">knots=</span>knotsSeq, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">degree=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb7-11"></span>
<span id="cb7-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Drop columns containing only a single value.</span></span>
<span id="cb7-13">Bbasis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.matrix</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Filter</span>(<span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(v) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uniqueN</span>(v)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.table</span>(Bbasis)))</span>
<span id="cb7-14"></span>
<span id="cb7-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine design matrix with target y (pous).</span></span>
<span id="cb7-16">DF2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDT</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind.data.frame</span>(Bbasis, y))</span>
<span id="cb7-17"></span>
<span id="cb7-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit B-spline regression model. </span></span>
<span id="cb7-19">mdl2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>DF2)</span>
<span id="cb7-20"></span>
<span id="cb7-21"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind reference to fitted values as yhat2.</span></span>
<span id="cb7-22">DF[,yhat2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(mdl2))]</span></code></pre></div>
<p>Running the same ggplot2 code from before, replacing <code>yhat1</code> with <code>yhat2</code>, we obtain:</p>
<p><img src="https://www.jtrive.com/posts/spline-smoothing-r/Rmooth2.png" class="img-fluid"></p>
<p>Polynomial regression and B-spline estimates are similar, but B-spline estimates exhibit better behavior in the later periods, with estimates far less influenced by erratic observations, while also approaching 1.0 on the right. The B-spline fit exhibits a good trade-off between bias and variance.</p>
</section>
<section id="smoothing-via-smooth.spline" class="level3">
<h3 class="anchored" data-anchor-id="smoothing-via-smooth.spline">Smoothing via <code>smooth.spline</code></h3>
<p><img src="https://latex.codecogs.com/png.latex?%5C%7Bx_%7Bi%7D,Y_%7Bi%7D:i=1,%5Cdots%20,n%5C%7D">, which we model by <img src="https://latex.codecogs.com/png.latex?Y_%7Bi%7D%20=%20f(x_%7Bi%7D)%20+%20%5Cepsilon_%7Bi%7D">, where <img src="https://latex.codecogs.com/png.latex?%5Cepsilon_%7Bi%7D"> are zero mean random errors. The cubic smoothing spline estimate <img src="https://latex.codecogs.com/png.latex?%5Chat%7Bf%7D"> of the function <img src="https://latex.codecogs.com/png.latex?f"> is defined to be the minimizer of:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csum%20_%7Bi=1%7D%5E%7Bn%7D%5BY_%7Bi%7D-%7B%5Chat%20%7Bf%7D%7D(x_%7Bi%7D)%5D%5E%7B2%7D+%5Clambda%20%5Cint%20%7B%5Chat%20%7Bf%7D%7D''(x)%5E%7B2%7Ddx,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Clambda%20%5Cgeq%200"> is a smoothing parameter wehich controls the bias variance trade-off. With respect to the <code>smooth.spline</code> function, <img src="https://latex.codecogs.com/png.latex?%5Clambda"> is identified as <code>spar</code>, where <code>0 &lt;= spar &lt;=1</code>. As <code>spar</code> approaches 1, the fit resembles linear regression (low variance / high bias). As <code>spar</code> approaches 0, the fit resembles interpolation (high variance / low bias). For the purposes of demonstration, we set <code>spar=.70</code> and <code>df</code> (degrees of freedom) to the number of records in the data:</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">smoothParam <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span></span>
<span id="cb8-2">yhat3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">smooth.spline</span>(DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>x, DF<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(DF), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">spar=</span>smoothParam)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y</span>
<span id="cb8-3">DF[,yhat3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span>yhat3]</span></code></pre></div>
<p><code>yhat3</code> vs.&nbsp;percent-of-ultimates:</p>
<p><img src="https://www.jtrive.com/posts/spline-smoothing-r/Rsmooth3.png" class="img-fluid"></p>
<p>It comes as no surprise that <code>smooth.spline</code> predictions are similar to B-spline estimates. To demonstrate how changing <code>spar</code> modifies the nature of the curve, we present the next code block, which fits the original percent-of-ultimate data using <code>smooth.spline</code> for 6 values of <code>spar</code>:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"foreach"</span>)</span>
<span id="cb9-2"></span>
<span id="cb9-3">targetSpar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span> , .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb9-4"></span>
<span id="cb9-5">DF3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">foreach</span>(</span>
<span id="cb9-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(targetSpar), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.inorder=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.errorhandling=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stop"</span>, </span>
<span id="cb9-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.final=</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(ll) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbindlist</span>(ll, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb9-8">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%do%</span> {</span>
<span id="cb9-9">    currSpar <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> targetSpar[[i]]</span>
<span id="cb9-10">    currDF <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> DF[,.(xinit, x, y)]</span>
<span id="cb9-11">    sparID <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"spar="</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(currSpar, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb9-12">    mdl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">smooth.spline</span>(currDF[,x], currDF[,y], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(currDF), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">spar=</span>currSpar)</span>
<span id="cb9-13">    currDF[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yhat=</span>mdl<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span>sparID, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">spar=</span>currSpar)]</span>
<span id="cb9-14">}</span>
<span id="cb9-15"></span>
<span id="cb9-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(DF3) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-17">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xinit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual"</span>),  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-18">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>xinit, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>yhat, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-19">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_manual</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actual"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#758585"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Predicted"</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E02C70"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-20">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(DF3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xinit), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(DF3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>xinit), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">facets=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(id), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nrow=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shrink=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"smooth.spline Regression: Percent-of-Ultimate Modeled vs. Actual"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-24">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb9-25">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#E02C70"</span>), </span>
<span id="cb9-26">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), </span>
<span id="cb9-27">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), </span>
<span id="cb9-28">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(), </span>
<span id="cb9-29">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb9-30">        )</span></code></pre></div>
<p><code>spar=1</code> is the lower-right facet (lowest variance/highest bias), and <code>spar=.01</code> the upper-left facet (highest variance/lowest bias):</p>
<p><img src="https://www.jtrive.com/posts/spline-smoothing-r/Rsmooth4.png" class="img-fluid"></p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>R</category>
  <guid>https://www.jtrive.com/posts/spline-smoothing-r/spline-smoothing-r.html</guid>
  <pubDate>Sat, 10 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>The Beta Function and its Variants</title>
  <link>https://www.jtrive.com/posts/beta-function/beta-function.html</link>
  <description><![CDATA[ 





<p>This post highlights variants of the beta function and includes an implementation that reproduces CDF output from <code>scipy.stats.nbinom</code> for a given parameterization.</p>
<p>No discussion of the beta function would be complete without first introducing the gamma function. The gamma function is an extension of the factorial function, with its argument shifted down by 1, to real and complex numbers:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5CGamma(x)%20=%20%5Cint_%7B0%7D%5E%7B%5Cinfty%7D%20t%5E%7Bx-1%7D%20e%5E%7B-t%7D%20dt%0A"></p>
<p>If <img src="https://latex.codecogs.com/png.latex?n"> is a positive integer, the gamma function reduces to:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5CGamma(n)%20=%20(n-1)!.%0A"></p>
<p>The beta function is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AB(a,%20b)%20=%20%5Cint_%7B0%7D%5E%7B1%7D%20t%5E%7Ba-1%7D%20(1-t)%5E%7Bb-1%7D%20dt,%20%5Cquad%20a,%20b%20%5Cin%20%5Cmathbb%7BR%7D%5E%7B%5Cgeq%7D.%0A"></p>
<p>The beta function can be represented in terms of the gamma function as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AB(a,%20b)%20=%20%5Cfrac%7B%5CGamma(a)%5CGamma(b)%7D%7B%5CGamma(a+b)%7D%0A"></p>
<p>When <img src="https://latex.codecogs.com/png.latex?a,%20b%20%5Cin%20%5Cmathbb%7BZ%7D%5E%7B%5Cgeq%7D">, the expression simplifies to:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AB(a,%20b)%20=%20%5Cfrac%7B(a-1)!(b-1)!%7D%7B(a+b-1)!%7D.%0A"></p>
<p>In the first beta function expression, the limits of integration were <img src="https://latex.codecogs.com/png.latex?(0,1)">. The <em>incomplete beta function</em> is a generalization of the beta function which allows the upper limit of integration to take on values within the range <img src="https://latex.codecogs.com/png.latex?%5B0,x%5D">. Symbolically, the incomplete beta function is represented as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AB(x;%20a,%20b)%20=%20%5Cint_%7B0%7D%5E%7Bx%7D%20t%5E%7Ba-1%7D%20(1-t)%5E%7Bb-1%7D%20dt.%0A"></p>
<p>When <img src="https://latex.codecogs.com/png.latex?x=1">, <em>the incomplete beta function and the beta function are equivalent</em>. Put another way, the beta function is the incomplete beta function evaluated at <img src="https://latex.codecogs.com/png.latex?x=1">. Having described the beta function and the incomplete beta function, the regularized incomplete beta function is introduced, which is also referred to as the <em>regularized beta function</em>. It is defined as the ratio of the incomplete beta function to the beta function, evaluated at <img src="https://latex.codecogs.com/png.latex?x">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AI_%7Bx%7D(a,b)%20=%20%5Cfrac%7BB(x;%20a,b)%7D%7BB(a,b)%7D%0A"></p>
<p>The regularized beta function is the cumulative distribution function for the beta distribution, which can be used to calculate the CDF for both the negative binomial and binomial distributions. For a binomial random variable <img src="https://latex.codecogs.com/png.latex?X">, to determine the probability of <img src="https://latex.codecogs.com/png.latex?k"> or fewer successes in <img src="https://latex.codecogs.com/png.latex?n"> independent trials, <img src="https://latex.codecogs.com/png.latex?k%20%5Cleq%20n">, the CDF can be expressed by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AF(x)%20=%20%5Csum_%7Bi=0%7D%5E%7Bn%7D%20%5Cbinom%7Bn%7D%7Bi%7D%20p%5E%7Bi%7D%20(1-p)%5E%7Bn-i%7D%20=%20I_%7B1-p%7D(n-k,1+k).%0A"></p>
<p>To demonstrate, assume <img src="https://latex.codecogs.com/png.latex?p=.25">, <img src="https://latex.codecogs.com/png.latex?n=5">. The probability of 3 or fewer successes is conventionally computed via binomial expansion as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AP%5BX%20%5Cleq%203%5D%20=%20%5Cbinom%7B5%7D%7B0%7D%20.25%5E%7B0%7D%20.75%5E%7B5%7D%20+%20%5Cbinom%7B5%7D%7B1%7D%20.25%5E%7B1%7D%20.75%5E%7B4%7D%20+%20%5Cbinom%7B5%7D%7B2%7D%20.25%5E%7B2%7D%20.75%5E%7B3%7D%20+%20%5Cbinom%7B5%7D%7B3%7D%20.25%5E%7B3%7D%20.75%5E%7B2%7D%20=%20%5Cmathbf%7B0.984375%7D.%0A"></p>
<p>Equivalently, leveraging the regularized incomplete beta function yields:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AP%5BX%20%5Cleq%203%5D%20=%20I_%7B.75%7D(2,%204)%20=%20%5Cmathbf%7B0.984375%7D.%0A"></p>
<p>For the negative binomial distribution, assuming the common <img src="https://latex.codecogs.com/png.latex?r,k"> parameterization in which the PDF is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AP(X=k)%20=%20%5Cbinom%7Bk+r-1%7D%7Bk%7D%20p%5E%7Bk%7D%20(1-p)%5E%7Br%7D%20%5Cquad%20%5Ctext%7Bfor%7D%20k%20=%200,%201,%202,%20%5Ccdots.%0A"></p>
<p>The negative binomial CDF can be computed using the regularized incomplete beta function:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AP(X%20%5Cleq%20k)%20=%201%20-%20I_%7Bp%7D(k+1,%20r).%0A"></p>
<section id="implementation" class="level3">
<h3 class="anchored" data-anchor-id="implementation">Implementation</h3>
<p>In what follows, a function to compute the CDF of the negative binomial distribution using functions available in <code>scipy.special</code> is demonstrated. Results will be compared to <code>scipy.stats.nbinom.cdf</code> for a set of inputs to assess the correctness of the implementation.</p>
<div id="cell-2" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Calculation of negative binomial CDF using regularized incomplete </span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">beta function. Note that the call signature for nbinom.cdf is:</span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    nbinom.cdf(&lt;nbr_failures&gt;, &lt;nbr_successes&gt;, &lt;prob_success&gt;)</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.special <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> betainc</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> nbinom</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Vectorization of nbinom.pmf.</span></span>
<span id="cb1-12">nb_pdfs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.vectorize(nbinom.pmf)</span>
<span id="cb1-13"></span>
<span id="cb1-14"></span>
<span id="cb1-15"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> nb_cdf(k, n,  p):</span>
<span id="cb1-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Negative binomial CDF using the regularized incomplete beta function.</span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-19">    I <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> betainc(n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, k, p)</span>
<span id="cb1-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> I)</span>
<span id="cb1-21"></span></code></pre></div>
</div>
<p>We test the implementation against the actual negative binomial CDF:</p>
<div id="cell-4" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"></span>
<span id="cb2-2">nbr_successes, nbr_failures, prob_success <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span></span>
<span id="cb2-3">sum_pdfs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nb_pdfs(np.arange(nbr_failures <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), nbr_successes, prob_success).<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>()</span>
<span id="cb2-4">actual_cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nbinom.cdf(nbr_failures, nbr_successes, prob_success)</span>
<span id="cb2-5">new_cdf <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nb_cdf(nbr_failures, nbr_successes, prob_success)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"sum_pdfs: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>sum_pdfs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-8"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"actual_cdf: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>actual_cdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-9"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"new_cdf: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>new_cdf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.6f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sum_pdfs: 0.588099
actual_cdf: 0.588099
new_cdf: 0.588099</code></pre>
</div>
</div>
<p>As expected, all three approaches arrive at the same value for the negative binomial CDF.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <guid>https://www.jtrive.com/posts/beta-function/beta-function.html</guid>
  <pubDate>Fri, 09 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Using Dijkstra’s Algorithm to Find All Shortest Paths in a Graph</title>
  <link>https://www.jtrive.com/posts/dijkstras-shortest-paths/dijkstras-shortest-paths.html</link>
  <description><![CDATA[ 





<p>I always had trouble spelling <em>Dijkstra</em> correctly until someone pointed out “It’s just D, followed by <em>i-j-k</em>, then stra”. Once it was pointed out that <em>i-j-k</em> is represented sequentially in alphabetical order, spelling <em>Dijkstra</em> becomes trival - almost fun!</p>
<p><em>Dijkstra’s algorithm</em> is one of the most well-known and studied graph algorithms for finding the shortest path between a set of vertices. For a specified starting node, the algorithm finds the shortest path between the source vertex and all other vertices in the graph. Dijkstra’s cannot handle graphs with negative edge weights: For graphs with negative weight edges, Floyd-Warshall or Bellman Ford can be used. But for graphs with positive edge weights, Dijkstra’s has better worst case performance than more general alternatives (O((n + m)log(n)) for Dijkstra vs.&nbsp;O(mn) for Bellman-Ford and O(n^3) for Floyd-Warshall).</p>
<p>However, Dijkstra’s only returns a single shortest path. In many cases a single shortest path is enough. But there are plenty of applications in which knowledge of alternate minimum weight paths can be useful. If a graph has multiple shortest paths, it is necessary to add supplementary logic to identify and return all such paths. The modified routine to return all shortest paths from graph G is described below:</p>
<ol type="1">
<li><p>Run Dijkstra’s starting from start node <strong>a</strong>. Returns shortest path and distance to every node from vertex <strong>a</strong>.</p></li>
<li><p>Run Dijkstra’s starting from end node <strong>f</strong>. Returns shortest path and distance to every node from vertex <strong>f</strong>.</p></li>
<li><p>Let <code>dist_a2f</code> = A shortest path from vertex <strong>a</strong> to vertex <strong>f</strong>.</p></li>
<li><p>For (u, v) in G.edges:</p>
<p>Let <code>w_uv</code> = Weight of edge (u, v).</p>
<p>Let <code>dist_a2u</code> = Distance from start vertex <strong>a</strong> to vertex u.</p>
<p>Let <code>dist_f2v</code> = Distance from end vertex <strong>f</strong> to vertex v.</p>
<p>If <code>dist_a2u</code> + <code>w_uv</code> + <code>dist_f2v</code> == <code>dist_a2f</code>:</p>
<p>Then edge (u, v) is on some minimal weight path.</p></li>
</ol>
<p>Lets use networkx to create a graph with multiple shortest paths:</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create network with multiple minimal weight paths.</span></span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> networkx <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> nx</span>
<span id="cb1-5"></span>
<span id="cb1-6">seed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">518</span></span>
<span id="cb1-7">G <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nx.Graph()</span>
<span id="cb1-8"></span>
<span id="cb1-9">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb1-10">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"b"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-11">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb1-12">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-13">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb1-14">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"e"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb1-15">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"c"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb1-16">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb1-17">G.add_edge(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19">edges <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(u, v) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (u, v, d) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> G.edges(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)]</span>
<span id="cb1-20"></span>
<span id="cb1-21">color_map <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb1-22"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> g <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> G:</span>
<span id="cb1-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>:</span>
<span id="cb1-24">        color_map.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)</span>
<span id="cb1-25">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> g<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>:</span>
<span id="cb1-26">        color_map.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)</span>
<span id="cb1-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-28">        color_map.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)</span>
<span id="cb1-29"></span>
<span id="cb1-30"></span>
<span id="cb1-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># edge weight labels.</span></span>
<span id="cb1-32">edge_labels <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nx.get_edge_attributes(G, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>)</span>
<span id="cb1-33"></span>
<span id="cb1-34"></span>
<span id="cb1-35">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-36">pos <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nx.spring_layout(G, seed<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>seed)</span>
<span id="cb1-37">nx.draw_networkx_nodes(G, pos, node_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">800</span>, node_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>color_map)</span>
<span id="cb1-38">nx.draw_networkx_edges(G, pos, edgelist<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>edges, width<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, edge_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>, style<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"solid"</span>)</span>
<span id="cb1-39">nx.draw_networkx_labels(G, pos, font_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>, font_color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"white"</span>, font_weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, font_family<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sans-serif"</span>)</span>
<span id="cb1-40">nx.draw_networkx_edge_labels(G, pos, edge_labels, font_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb1-41">plt.axis(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"off"</span>)</span>
<span id="cb1-42">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/dijkstras-shortest-paths/dijkstras-shortest-paths_files/figure-html/cell-2-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>G has three shortest paths of weight/distance 12:</p>
<ul>
<li><code>a - c - f</code></li>
<li><code>a - b - c - f</code></li>
<li><code>a - c - d - e - f</code></li>
</ul>
<p>Running <code>single_source_dijkstra</code> from networkx returns the distance to each vertex in a graph from a specified starting vertex (in our example, vertex a). <code>single_source_dijkstra</code> returns two dictionaries: The first stores distances to each vertex; the second stores the shortest path from the start node to all other vertices (<code>d2v0</code> and <code>p2v0</code> in the code below):</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"></span>
<span id="cb2-2">d2v0, p2v0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nx.single_source_dijkstra(G, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>)</span>
<span id="cb2-3"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"d2v0: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>d2v0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb2-4"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"p2v0: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>p2v0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>d2v0: {'a': 0, 'b': 4, 'c': 6, 'd': 7, 'e': 10, 'f': 12}
p2v0: {'a': ['a'], 'b': ['a', 'b'], 'c': ['a', 'c'], 'd': ['a', 'c', 'd'], 'f': ['a', 'c', 'f'], 'e': ['a', 'c', 'd', 'e']}</code></pre>
</div>
</div>
<p><code>single_source_dijkstra</code> only returns <code>a - c - f</code>. To also identify <code>a - b - c - f</code> and <code>a - c - d - e - f</code>, we implement the steps from our pseudocode:</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Idenitfy all shortests paths in graph G.</span></span>
<span id="cb4-3">all_shortest_paths <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>()</span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># d2v: Distance to vertex (from start node a).</span></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># p2v: Shortest path to vertext (from start node a).</span></span>
<span id="cb4-7">d2v0, p2v0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nx.single_source_dijkstra(G, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>)</span>
<span id="cb4-8">d2v1, p2v1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nx.single_source_dijkstra(G, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>)</span>
<span id="cb4-9">all_shortest_paths.add(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>(p2v0[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>]))</span>
<span id="cb4-10"></span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Iterate through all edges. Check for additional shortest paths. </span></span>
<span id="cb4-12"></span>
<span id="cb4-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Distance of a shortest path from a to f. </span></span>
<span id="cb4-14">dist_a2f <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d2v0[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"f"</span>]</span>
<span id="cb4-15"></span>
<span id="cb4-16"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> u, v, dw <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> G.edges(data<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>):</span>
<span id="cb4-17">    </span>
<span id="cb4-18">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get weight of current edge spanning (u, v)</span></span>
<span id="cb4-19">    w_uv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dw[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>]</span>
<span id="cb4-20">    </span>
<span id="cb4-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get distance from start vertex to u.</span></span>
<span id="cb4-22">    dist_a2u <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d2v0[u]</span>
<span id="cb4-23">    </span>
<span id="cb4-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get distance from end vertex to v.</span></span>
<span id="cb4-25">    dist_f2v <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> d2v1[v]</span>
<span id="cb4-26">    </span>
<span id="cb4-27">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> dist_a2u <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> w_uv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> dist_f2v <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> dist_a2f:</span>
<span id="cb4-28">        </span>
<span id="cb4-29">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Edge uv is on some minimal weight path. Append to all_shortest_paths.</span></span>
<span id="cb4-30">        pp <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>(p2v0[u] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> p2v1[v][::<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb4-31">        all_shortest_paths.add(pp)</span></code></pre></div>
</div>
<p>Shortest paths are stored in a set of ordered tuples, with each tuple representing the vertices of some path of minimum weight. Printing the contents of all_shortest_paths yields:</p>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">all_shortest_paths</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>{('a', 'b', 'c', 'f'), ('a', 'c', 'd', 'e', 'f'), ('a', 'c', 'f')}</code></pre>
</div>
</div>
<p>The time complexity for two separate invocations of Dijkstra’s is 2 * O((n + m)log(n)), and O(m + n) to iterate through the adjacency list checking for intermediate edges falling on a path of minimum weight.</p>



 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/dijkstras-shortest-paths/dijkstras-shortest-paths.html</guid>
  <pubDate>Mon, 05 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Bayesian Linear Regression via Gibbs Sampling</title>
  <link>https://www.jtrive.com/posts/gibbs-sampling-linear-regression/gibbs-sampling-linear-regression.html</link>
  <description><![CDATA[ 





<p>Markov Chain Monte Carlo (MCMC) methods can be used to estimate the parameters of linear regression models. In this post, the distributional forms and algorithms associated with two Gibbs sampling approaches are outlined: the full conditionals approach and the composition method.</p>
<p>The dataset used in what follows is available <a href="https://gist.github.com/jtrive84/96757393423b2599c7d5da361fdf024b/raw/82000835b7c3b70dcf21a9ab43c59db700b78136/Refrigerator.csv">here</a> and represents refrigerator price as a function of a number of features. The objective is to estimate PRICE as a function of ECOST, FSIZE, SHELVES and FEATURES, where:</p>
<ul>
<li><strong>PRICE</strong>: Response, cost of refrigerator.<br>
</li>
<li><strong>FSIZE</strong>: Size of freezer compartment.<br>
</li>
<li><strong>ECOST</strong>: Annual energy cost to operate refrigerator.<br>
</li>
<li><strong>SHELVES</strong>: Number of shelves.</li>
<li><strong>FEATURES</strong>: Number of features.</li>
</ul>
<section id="i.-the-full-conditionals-method" class="level3">
<h3 class="anchored" data-anchor-id="i.-the-full-conditionals-method">I. The Full Conditionals Method</h3>
<p>First determine the joint kernel, which is the product of the likelihood and all prior distributions. The joint kernel will be proportional to the posterior distribution:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0Af(%5Cbeta,%20%5Csigma%5E%7B2%7D%7CX,%20y)%20&amp;%5Cpropto%20f(y%7CX,%20%5Cbeta,%20%5Csigma%5E%7B2%7D)%20%5Ctimes%20f(%5Cbeta)%20%5Ctimes%20f(%5Csigma%5E%7B2%7D).%0A%5Cend%7Balign%7D%0A"></p>
<p><br></p>
<p>The likelihood, <img src="https://latex.codecogs.com/png.latex?f(y%7CX,%20%5Cbeta,%20%5Csigma%5E%7B2%7D)">, is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0Ay%7CX,%20%5Cbeta,%20%5Csigma%5E%7B2%7D%20&amp;%5Csim%20%5Cmathcal%7BN%7D(X%5Cbeta,%20%5Csigma%5E%7B2%7DI)%5C%5C%0A&amp;=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20f(y_%7Bi%7D%7Cx_%7Bi%7D,%20%5Cbeta,%20%5Csigma%5E%7B2%7D)%20%5C%5C%0A&amp;=%20(2%5Cpi%5Csigma%5E%7B2%7D)%5E%7B-n/2%7D%20%5Cmathrm%7Bexp%7D%5CBig%5C%7B%5Cfrac%7B1%7D%7B2%5Csigma%5E%7B2%7D%7D%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(y_%7Bi%7D%20-%20%5Cbeta%5E%7BT%7Dx_%7Bi%7D)%5E%7B2%7D%5CBig%5C%7D%5C%5C%0A&amp;=%20(2%5Cpi%5Csigma%5E%7B2%7D)%5E%7B-n/2%7D%5Cmathrm%7Bexp%7D%5CBig%5C%7B-%5Cfrac%7B1%7D%7B2%5Csigma%5E%7B2%7D%7D(y-X%5Cbeta)%5E%7BT%7D(y-X%5Cbeta)%5CBig%5C%7D%0A%5Cend%7Balign%7D%0A"> <br></p>
<p>For the parameter vector <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> we assume an improper uniform prior over the real line. For the variance, we assume a uniform prior over the real line for <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Blog%7D(%5Csigma%5E%7B2%7D)">. If we transform the uniform prior on <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Blog%7D(%5Csigma%5E%7B2%7D)"> into a density for <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">, we obtain <img src="https://latex.codecogs.com/png.latex?f(%5Csigma%5E%7B2%7D)%20%5Cpropto%201/%5Csigma%5E%7B2%7D">. This is a common reference prior for the variance used within the context of Bayesian linear regression.</p>
<p>Since the prior distribution for the parameter vector <img src="https://latex.codecogs.com/png.latex?f(%5Cbeta)"> can be treated as a multiplicative constant which can be ignored, the expression for the posterior reduces to:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign%7D%0Af(%5Cbeta,%20%5Csigma%5E%7B2%7D%7CX,%20y)%20&amp;%5Cpropto%20%5Cfrac%7B1%7D%7B%5Csigma%5E%7B2%7D%7D%20%5Ctimes%20(2%5Cpi%5Csigma%5E%7B2%7D)%5E%7B-n/2%7D%5Cmathrm%7Bexp%7D%5CBig%5C%7B-%5Cfrac%7B1%7D%7B2%5Csigma%5E%7B2%7D%7D(y-X%5Cbeta)%5E%7BT%7D(y-X%5Cbeta)%5CBig%5C%7D%5C%5C%0A&amp;%5Cpropto%20(%5Csigma%5E%7B2%7D)%5E%7B-(n/2%20+%201)%7D%5Cmathrm%7Bexp%7D%5CBig%5C%7B-%5Cfrac%7B1%7D%7B2%5Csigma%5E%7B2%7D%7D(y-X%5Cbeta)%5E%7BT%7D(y-X%5Cbeta)%5CBig%5C%7D.%5C%5C%0A%5Cend%7Balign%7D%0A"></p>
<p>Note that posterior distribution is asymptotically equivalent to the expression for the model likelihood.</p>
<p>Gibbs sampling requires identifying the full conditional distribution for each parameter, holding all other parameters constant. To find the full conditional distribution for <img src="https://latex.codecogs.com/png.latex?%5Cbeta">, select only the terms from the joint kernel that include <img src="https://latex.codecogs.com/png.latex?%5Cbeta">. Doing so results in:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Cbeta%7CX,%20y,%20%5Csigma%5E%7B2%7D)%20%5Cpropto%20%5Cmathrm%7Bexp%7D%5CBig%5C%7B-%5Cfrac%7B1%7D%7B2%5Csigma%5E%7B2%7D%7D(y-X%5Cbeta)%5E%7BT%7D(y-X%5Cbeta)%5CBig%5C%7D%0A"> <br></p>
<p>After distributing the transpose, removing multiplicative constants and performing a bit of reorganization, we arrive at:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Cbeta%7CX,%20y,%20%5Csigma%5E%7B2%7D)%20%5Cpropto%20%5Cmathrm%7Bexp%7D%5CBig%5C%7B-%5Cfrac%7B1%7D%7B2%5Csigma%5E%7B2%7D%7D%5B%5Cbeta%5E%7BT%7DX%5E%7BT%7DX%5Cbeta%20-%202%5Cbeta%5E%7BT%7DX%5E%7BT%7Dy%5D%5CBig%5C%7D.%5C%5C%0A"></p>
<p>Upon completing the square, we find the distribution for <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> to be normal with mean <img src="https://latex.codecogs.com/png.latex?(X%5E%7BT%7DX)%5E%7B-1%7DX%5E%7BT%7Dy%5Chspace%7B.25em%7D"> and variance <img src="https://latex.codecogs.com/png.latex?%5Chspace%7B.25em%7D%5Csigma%5E%7B2%7D(X%5E%7BT%7DX)%5E%7B-1%7D">.</p>
<p>For <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">, with <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> assumed fixed, we obtain:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Csigma%5E%7B2%7D%7CX,%20y,%20%5Cbeta)%20%5Cpropto%20(%5Csigma%5E%7B2%7D)%5E%7B-(n/2%20+%201)%7D%5Cmathrm%7Bexp%7D%5CBig%5C%7B-%5Cfrac%7B%5Cmathrm%7BSSR%7D%7D%7B2%5Csigma%5E%7B2%7D%7D%5CBig%5C%7D,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BSSR%7D"> represents the sum of squared residuals under the specified value of <img src="https://latex.codecogs.com/png.latex?%5Cbeta">. This is proportional to an inverse gamma distribution with <img src="https://latex.codecogs.com/png.latex?a%20=%20n/2"> and <img src="https://latex.codecogs.com/png.latex?b%20=%20%5Cmathrm%7BSSR%7D/2">.</p>
<section id="full-conditionals-approach-for-sampling-from-the-posterior-distribution" class="level4">
<h4 class="anchored" data-anchor-id="full-conditionals-approach-for-sampling-from-the-posterior-distribution">Full Conditionals Approach for Sampling from the Posterior Distribution:</h4>
<ol type="1">
<li><p>Establish starting values for <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7Bp%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">. We use <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(0)%7D%20=%20%5Chat%5Cbeta_%7Bols%7D"> and <img src="https://latex.codecogs.com/png.latex?%5Chat%20%5Csigma_%7B0%7D%5E%7B2%7D%20=%20%5Cmathrm%7BSSR%7D%20/%20(n%20-%20p)"></p></li>
<li><p>Sample <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7Bp%7D"> from multivariate normal distribution with <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D"> fixed.</p></li>
<li><p>Sample <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D"> from inverse gamma distribution with <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7Bp%7D"> fixed.</p></li>
</ol>
<p>In the code below, we run the sampler for 10,000 iterations, discarding the first 1,000 samples.</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">The full conditionals Gibbs sampling method. </span></span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    PRICE ~ "ECOST" + "FSIZE" + "SHELVES" + "FEATURES"</span></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> math <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> sqrt</span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mpl</span>
<span id="cb1-8"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-9"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np </span>
<span id="cb1-10"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> stats</span>
<span id="cb1-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.linalg <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> cholesky</span>
<span id="cb1-13"></span>
<span id="cb1-14">pd.options.mode.chained_assignment <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-15">pd.set_option(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'display.max_columns'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb1-16">pd.set_option(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'display.width'</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span>)</span>
<span id="cb1-17">np.set_printoptions(suppress<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-18"></span>
<span id="cb1-19"></span>
<span id="cb1-20">data_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://gist.github.com/jtrive84/96757393423b2599c7d5da361fdf024b/raw/82000835b7c3b70dcf21a9ab43c59db700b78136/Refrigerator.csv"</span></span>
<span id="cb1-21"></span>
<span id="cb1-22">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(data_url)</span>
<span id="cb1-23"></span>
<span id="cb1-24">variates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ECOST"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FSIZE"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SHELVES"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FEATURES"</span>]</span>
<span id="cb1-25">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[variates].values</span>
<span id="cb1-26">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PRICE"</span>].values.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-27">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.concatenate([np.ones(y.size).reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), X], axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-28"></span>
<span id="cb1-29">n, p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.shape</span>
<span id="cb1-30">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb1-31">burnin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb1-32">prng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.RandomState(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb1-33"></span>
<span id="cb1-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize arrays to hold posterior samples.</span></span>
<span id="cb1-35">betas, sigma2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros([M, p]), np.ones(M)</span>
<span id="cb1-36"></span>
<span id="cb1-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize parameter arrays and compute covariance matrix.</span></span>
<span id="cb1-38">b_ols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.inv(X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> y</span>
<span id="cb1-39">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.inv(X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X)</span>
<span id="cb1-40">sigma2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ((y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> b_ols).T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> (y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> b_ols) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)).item()</span>
<span id="cb1-41">betas[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, :] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b_ols.T</span>
<span id="cb1-42"></span>
<span id="cb1-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gibbs sampling from full conditionals. At each iteration, p independent </span></span>
<span id="cb1-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># standard normal random variates are sampled, which are transformed into </span></span>
<span id="cb1-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># a draw from a multivariate normal density with mean betas[i, :] and </span></span>
<span id="cb1-46"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># covariance V. </span></span>
<span id="cb1-47"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, M):</span>
<span id="cb1-48">    </span>
<span id="cb1-49">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample from full conditional distribution for betas.</span></span>
<span id="cb1-50">    betas[ii,:] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b_ols.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> prng.randn(p).reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> cholesky(sigma2[ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> V)</span>
<span id="cb1-51">    </span>
<span id="cb1-52">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample from full conditional distribution for variance. </span></span>
<span id="cb1-53">    sigma2[ii] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.invgamma.rvs(</span>
<span id="cb1-54">        a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.50</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> n, </span>
<span id="cb1-55">        scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.50</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> betas[ii,:].reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)).T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> (y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> betas[ii,:].reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))).item(),</span>
<span id="cb1-56">        random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>prng</span>
<span id="cb1-57">        )</span>
<span id="cb1-58"></span>
<span id="cb1-59"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove burnin samples.</span></span>
<span id="cb1-60">betas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> betas[burnin:,:]</span>
<span id="cb1-61">sigma2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> sigma2[burnin:]</span></code></pre></div>
</div>
<p>Traceplots can be produced to visualize sampling variability across iterations:</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine beta and sigma2 arrays to create traceplots. </span></span>
<span id="cb2-2">varnames <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intercept"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> variates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma2"</span>]</span>
<span id="cb2-3">Xall1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.hstack([betas, sigma2.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)])</span>
<span id="cb2-4"></span>
<span id="cb2-5">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb2-6"></span>
<span id="cb2-7">indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)]</span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> indx, (varname, (ii, jj)) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(varnames, indices)):</span>
<span id="cb2-10">    </span>
<span id="cb2-11">    ax[ii, jj].set_title(varname, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb2-12">    ax[ii, jj].plot(Xall1[:,indx], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>)</span>
<span id="cb2-13">    ax[ii, jj].xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb2-14">    ax[ii, jj].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb2-15">    ax[ii, jj].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb2-16">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb2-17">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb2-18">    ax[ii, jj].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb2-19">    ax[ii, jj].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb2-20">    ax[ii, jj].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb2-21">    ax[ii, jj].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb2-22"></span>
<span id="cb2-23">plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Traceplots: Full Conditionals Approach"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb2-24">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gibbs-sampling-linear-regression/gibbs-sampling-linear-regression_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img" alt="Traceplot for each feature in model using full conditionals approach"></p>
<figcaption>Traceplot for each feature in model using full conditionals approach</figcaption>
</figure>
</div>
</div>
</div>
<p>Histograms for each parameter can be generated from the posterior samples:</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create histograms from posterior samples with overlaid ols estimates.</span></span>
<span id="cb3-2">hist_color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7595"</span></span>
<span id="cb3-3">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb3-4"></span>
<span id="cb3-5">plt_ols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.append(b_ols.ravel(), sigma2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb3-6"></span>
<span id="cb3-7">indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)]</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> indx, (varname, (ii, jj)) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(varnames, indices)):</span>
<span id="cb3-10">    </span>
<span id="cb3-11">    ax[ii, jj].set_title(varname, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb3-12">    ax[ii, jj].hist(</span>
<span id="cb3-13">        Xall1[:,indx], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>hist_color, </span>
<span id="cb3-14">        edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb3-15">        )</span>
<span id="cb3-16">    label0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \sigma_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{0}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">^</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> indx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \beta_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{OLS}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> </span>
<span id="cb3-17">    label1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \sigma_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{MCMC}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">^</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> indx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \beta_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{MCMC}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> </span>
<span id="cb3-18">    ax[ii,jj].axvline(plt_ols[indx], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>label0)</span>
<span id="cb3-19">    ax[ii,jj].axvline(Xall1[:,indx].mean(), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>label1)</span>
<span id="cb3-20">    ax[ii, jj].xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb3-21">    ax[ii,jj].set_yticklabels([])</span>
<span id="cb3-22">    ax[ii, jj].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb3-23">    ax[ii, jj].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb3-24">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb3-25">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb3-26">    ax[ii, jj].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb3-27">    ax[ii, jj].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb3-28">    ax[ii, jj].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb3-29">    ax[ii, jj].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb3-30">    ax[ii,jj].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper right"</span>, fancybox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x-small"</span>)</span>
<span id="cb3-31"></span>
<span id="cb3-32">plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histograms: Full Conditionals Approach"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb3-33">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gibbs-sampling-linear-regression/gibbs-sampling-linear-regression_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img" alt="Histogram for each feature using full conditionals approach"></p>
<figcaption>Histogram for each feature using full conditionals approach</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="ii.-composition-method" class="level3">
<h3 class="anchored" data-anchor-id="ii.-composition-method">II. Composition Method</h3>
<p>The composition method can also be used to generate posterior samples for <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">. Using this approach, the posterior distribution is decomposed into 1) the conditional distribution for <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> given <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D"> and 2) the marginal distribution for <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(%5Cbeta,%20%5Csigma%5E%7B2%7D%7C%20X,%20y)%20%5Cpropto%20f(%5Cbeta%7C%5Csigma%5E%7B2%7D,%20X,%20y)%20%5Ctimes%20f(%5Csigma%5E%7B2%7D%7CX,%20y)%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?f(%5Csigma%5E%7B2%7D%7CX,%20y)"> is an inverse gamma distribution with <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%20(n%20-%20p)%20/%202"> and <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20=%20(n%20-%20p)%20%5Ctimes%20%5Cmathrm%7BSSR%7D%20/%202">, where <img src="https://latex.codecogs.com/png.latex?n"> is the number of observations in the dataset and <img src="https://latex.codecogs.com/png.latex?p"> the number of predictors in <img src="https://latex.codecogs.com/png.latex?X">. <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BSSR%7D"> represents the sum of squared residuals obtained from the OLS estimate.</p>
<p>As before, the conditional distribution for <img src="https://latex.codecogs.com/png.latex?%5Cbeta">, <img src="https://latex.codecogs.com/png.latex?f(%5Cbeta%7C%5Csigma%5E%7B2%7D,%20X,%20y)">, is multivariate normal with mean <img src="https://latex.codecogs.com/png.latex?(X%5E%7BT%7DX)%5E%7B-1%7DX%5E%7BT%7Dy"> and variance <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D(X%5E%7BT%7DX)%5E%7B-1%7D">.</p>
<p>The composition method is faster than the full conditionals method since we can draw all samples from <img src="https://latex.codecogs.com/png.latex?f(%5Csigma%5E%7B2%7D%7CX,%20y)"> upfront.</p>
<section id="composition-method-approach-for-sampling-from-the-posterior-distribution" class="level4">
<h4 class="anchored" data-anchor-id="composition-method-approach-for-sampling-from-the-posterior-distribution">Composition Method Approach for Sampling from the Posterior Distribution:</h4>
<ol type="1">
<li><p>Compute <img src="https://latex.codecogs.com/png.latex?%5Chat%20%5Cbeta"> via OLS and <img src="https://latex.codecogs.com/png.latex?V%20=%20(X%5E%7BT%7DX)%5E%7B-1%7D">.</p></li>
<li><p>Compute <img src="https://latex.codecogs.com/png.latex?SSR%20=%20%5Cfrac%7B1%7D%7Bn%20-%20p%7D(y%20-%20X%5Chat%20%5Cbeta)%5E%7BT%7D(y%20-%20X%5Chat%20%5Cbeta)">.</p></li>
<li><p>Draw <img src="https://latex.codecogs.com/png.latex?m"> samples from <img src="https://latex.codecogs.com/png.latex?IG%5Cbig(%5Cfrac%7Bn%20-%20p%7D%7B2%7D,%20%5Cfrac%7B(n%20-%20p)%20%5Ctimes%20%5Cmathrm%7BSSR%7D%7D%7B2%7D%5Cbig)">.</p></li>
<li><p>For <img src="https://latex.codecogs.com/png.latex?i%20=%201,%20%5Ccdots,%20m">: Draw <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(i)%7D"> from <img src="https://latex.codecogs.com/png.latex?f(%5Cbeta%7C%5Csigma%5E%7B2(i)%7D,%20X,%20y)">: <img src="https://latex.codecogs.com/png.latex?%5Cbeta%5E%7B(i)%7D%20%5Csim%20%5Cmathcal%7BN%7D(%5Chat%20%5Cbeta,%20%5Csigma%5E%7B2(i)%7DV)">.</p></li>
</ol>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb4-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Drawing posterior samples using the composition method.</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    PRICE ~ "ECOST" + "FSIZE" + "SHELVES" + "FEATURES"</span></span>
<span id="cb4-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb4-6"></span>
<span id="cb4-7">n, p <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> X.shape</span>
<span id="cb4-8">M <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb4-9">burnin <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb4-10">prng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.RandomState(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb4-11"></span>
<span id="cb4-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize betas to hold posterior samples.</span></span>
<span id="cb4-13">betas <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.zeros([M, p])</span>
<span id="cb4-14"></span>
<span id="cb4-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute OLS estimate, V and SSR. </span></span>
<span id="cb4-16">b_ols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.inv(X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> y</span>
<span id="cb4-17">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.inv(X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X)</span>
<span id="cb4-18">SSR <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> b_ols).T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> (y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> b_ols) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)</span>
<span id="cb4-19"></span>
<span id="cb4-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Draw M samples from marginal distribution for sigma2.</span></span>
<span id="cb4-21">sigma2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> stats.invgamma.rvs(a<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.50</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p), scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.50</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> SSR, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>M, random_state<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>prng)</span>
<span id="cb4-22"></span>
<span id="cb4-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulate sequence of beta draws for each value in sigma2.</span></span>
<span id="cb4-24"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(M):</span>
<span id="cb4-25">    betas[ii,:] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> b_ols.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> prng.randn(p).reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> cholesky(sigma2[ii] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> V)</span>
<span id="cb4-26"></span></code></pre></div>
</div>
<p>As before, we produce traceplots for each variable and <img src="https://latex.codecogs.com/png.latex?sigma%5E2">:</p>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">varnames <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"intercept"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> variates <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sigma2"</span>]</span>
<span id="cb5-2">Xall2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.hstack([betas, sigma2.reshape(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)])</span>
<span id="cb5-3"></span>
<span id="cb5-4">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb5-5"></span>
<span id="cb5-6">indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)]</span>
<span id="cb5-7"></span>
<span id="cb5-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> indx, (varname, (ii, jj)) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(varnames, indices)):</span>
<span id="cb5-9">    </span>
<span id="cb5-10">    ax[ii, jj].set_title(varname, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb5-11">    ax[ii, jj].plot(Xall2[:,indx], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>)</span>
<span id="cb5-12">    ax[ii, jj].xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb5-13">    ax[ii, jj].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb5-14">    ax[ii, jj].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb5-15">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb5-16">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb5-17">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb5-18">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb5-19">    ax[ii, jj].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb5-20">    ax[ii, jj].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb5-21">    ax[ii, jj].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb5-22">    ax[ii, jj].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb5-23"></span>
<span id="cb5-24">plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Traceplots: Composition Method"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb5-25">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gibbs-sampling-linear-regression/gibbs-sampling-linear-regression_files/figure-html/cell-6-output-1.png" class="img-fluid figure-img" alt="Traceplot for each feature in model using composition method"></p>
<figcaption>Traceplot for each feature in model using composition method</figcaption>
</figure>
</div>
</div>
</div>
<p>As well as histograms:</p>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">hist_color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7595"</span></span>
<span id="cb6-2">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb6-3"></span>
<span id="cb6-4">plt_ols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.append(b_ols.ravel(), sigma2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>])</span>
<span id="cb6-5"></span>
<span id="cb6-6">indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)]</span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> indx, (varname, (ii, jj)) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(varnames, indices)):</span>
<span id="cb6-9">    </span>
<span id="cb6-10">    ax[ii, jj].set_title(varname, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb6-11">    ax[ii, jj].hist(</span>
<span id="cb6-12">        Xall2[:,indx], <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>hist_color, </span>
<span id="cb6-13">        edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb6-14">        )</span>
<span id="cb6-15">    label0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \sigma_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{0}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">^</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> indx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \beta_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{OLS}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> </span>
<span id="cb6-16">    label1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \sigma_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{MCMC}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">^</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{2}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> indx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \beta_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{MCMC}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> </span>
<span id="cb6-17">    ax[ii,jj].axvline(plt_ols[indx], color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>label0)</span>
<span id="cb6-18">    ax[ii,jj].axvline(Xall2[:,indx].mean(), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>label1)</span>
<span id="cb6-19">    ax[ii, jj].xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb6-20">    ax[ii,jj].set_yticklabels([])</span>
<span id="cb6-21">    ax[ii, jj].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb6-22">    ax[ii, jj].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb6-23">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb6-24">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb6-25">    ax[ii, jj].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb6-26">    ax[ii, jj].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb6-27">    ax[ii, jj].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb6-28">    ax[ii, jj].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb6-29">    ax[ii,jj].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper right"</span>, fancybox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x-small"</span>)</span>
<span id="cb6-30"></span>
<span id="cb6-31">plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Histograms: Composition Method"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb6-32">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gibbs-sampling-linear-regression/gibbs-sampling-linear-regression_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img" alt="Histogram for each feature using composition method"></p>
<figcaption>Histogram for each feature using composition method</figcaption>
</figure>
</div>
</div>
</div>
<p>Posterior percentiles from the full conditionals approach and composition method can be compared:</p>
<div id="cell-14" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb7-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Comparing posterior percentiles for full conditionals and composition approaches.</span></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb7-4"></span>
<span id="cb7-5">peval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span>]</span>
<span id="cb7-6">pcols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ii<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> peval]</span>
<span id="cb7-7"></span>
<span id="cb7-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> indx, varname <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(varnames):</span>
<span id="cb7-9">    </span>
<span id="cb7-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Determine percentiles generated via full-conditionals.</span></span>
<span id="cb7-11">    df1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(</span>
<span id="cb7-12">        np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(np.percentile(Xall1[:, indx], q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>peval), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>).reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb7-13">        columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pcols,index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>varname<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: conditionals"</span>]</span>
<span id="cb7-14">        )</span>
<span id="cb7-15">    </span>
<span id="cb7-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Determine percentiles generated via composition method.</span></span>
<span id="cb7-17">    df2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(</span>
<span id="cb7-18">        np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(np.percentile(Xall2[:, indx], q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>peval), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>).reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb7-19">        columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pcols, index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>varname<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: composition"</span>]</span>
<span id="cb7-20">        )</span>
<span id="cb7-21">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.concat([df1, df2])</span>
<span id="cb7-22">    display(df)</span></code></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">intercept: conditionals</td>
<td>-25.01</td>
<td>51.28</td>
<td>150.96</td>
<td>221.28</td>
<td>289.90</td>
<td>386.74</td>
<td>464.17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">intercept: composition</td>
<td>-21.44</td>
<td>50.76</td>
<td>152.43</td>
<td>221.71</td>
<td>288.77</td>
<td>387.09</td>
<td>461.41</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">ECOST: conditionals</td>
<td>-10.34</td>
<td>-8.41</td>
<td>-5.77</td>
<td>-4.0</td>
<td>-2.20</td>
<td>0.39</td>
<td>2.62</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ECOST: composition</td>
<td>-10.20</td>
<td>-8.34</td>
<td>-5.76</td>
<td>-4.0</td>
<td>-2.21</td>
<td>0.38</td>
<td>2.28</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FSIZE: conditionals</td>
<td>38.83</td>
<td>58.12</td>
<td>85.95</td>
<td>103.97</td>
<td>121.74</td>
<td>148.78</td>
<td>169.22</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FSIZE: composition</td>
<td>39.05</td>
<td>57.93</td>
<td>85.41</td>
<td>103.99</td>
<td>122.53</td>
<td>148.96</td>
<td>168.51</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SHELVES: conditionals</td>
<td>-2.56</td>
<td>5.70</td>
<td>17.33</td>
<td>25.19</td>
<td>32.86</td>
<td>44.09</td>
<td>52.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SHELVES: composition</td>
<td>-2.71</td>
<td>5.68</td>
<td>17.42</td>
<td>24.81</td>
<td>32.72</td>
<td>44.32</td>
<td>52.66</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">FEATURES: conditionals</td>
<td>11.87</td>
<td>15.60</td>
<td>21.25</td>
<td>24.87</td>
<td>28.68</td>
<td>34.11</td>
<td>38.15</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">FEATURES: composition</td>
<td>11.79</td>
<td>15.68</td>
<td>21.13</td>
<td>24.86</td>
<td>28.46</td>
<td>33.87</td>
<td>37.89</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">sigma2: conditionals</td>
<td>3209.36</td>
<td>3706.92</td>
<td>4620.93</td>
<td>5465.36</td>
<td>6527.58</td>
<td>8570.83</td>
<td>10609.79</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">sigma2: composition</td>
<td>3194.00</td>
<td>3691.71</td>
<td>4649.74</td>
<td>5467.54</td>
<td>6490.48</td>
<td>8482.73</td>
<td>10295.27</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="posterior-predictive-samples" class="level3">
<h3 class="anchored" data-anchor-id="posterior-predictive-samples">Posterior Predictive Samples</h3>
<p>For a new set of predictors <img src="https://latex.codecogs.com/png.latex?%5Ctilde%7BX%7D">, we may be interested in quantifying the variability in the price estimate given our model. This can be accomplished by sampling from the posterior predictive distribution, <img src="https://latex.codecogs.com/png.latex?f(%5Ctilde%7By%7D%7Cy)">. If <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D"> were known exactly, the distribution for <img src="https://latex.codecogs.com/png.latex?%5Ctilde%7By%7D"> would be completely specified as <img src="https://latex.codecogs.com/png.latex?%5Cmathcal%7BN%7D(%5Ctilde%7BX%7D%5Cbeta,%20%5Csigma%5E%7B2%7DI)">. But since we have only estimates of <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> and <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">, we need to sample from the posterior predictive distribution <img src="https://latex.codecogs.com/png.latex?f(%5Ctilde%7By%7D%7Cy)"> as follows:</p>
<ol type="1">
<li>For <img src="https://latex.codecogs.com/png.latex?i%20=%201,%20%5Ccdots,%20n">: Draw <img src="https://latex.codecogs.com/png.latex?(%5Cbeta%5E%7B(i)%7D,%20%5Csigma%5E%7B2(i)%7D)"> from posterior samples.</li>
<li>Draw <img src="https://latex.codecogs.com/png.latex?%5Ctilde%7By%7D%5E%7B(i)%7D%20%5Csim%20%5Cmathcal%7BN%7D(%5Ctilde%7BX%7D%5Cbeta%5E%7B(i)%7D,%20%5Csigma%5E%7B2%7B(i)%7D%7DI)">.</li>
</ol>
<p>The code that follows generates 5000 posterior predictive samples for a new set of predictors.</p>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"></span>
<span id="cb8-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generating posterior predictive samples for a new set of predictors.</span></span>
<span id="cb8-3"></span>
<span id="cb8-4">n <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5000</span></span>
<span id="cb8-5">Xnew <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">82</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>]</span>
<span id="cb8-6"></span>
<span id="cb8-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Determine which 5000 parameter sets to use for sampling.</span></span>
<span id="cb8-8">indices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prng.choice(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(Xall2.shape[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]), size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>n, replace<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb8-9">params <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Xall2[indices,:]</span>
<span id="cb8-10">samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb8-11"></span>
<span id="cb8-12"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(n):</span>
<span id="cb8-13">    beta, v <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> params[ii, :<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], params[ii, <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb8-14">    mu <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.dot(beta, Xnew)</span>
<span id="cb8-15">    y_ii <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> prng.normal(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>mu, scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>sqrt(v))</span>
<span id="cb8-16">    samples.append(y_ii)</span>
<span id="cb8-17"></span>
<span id="cb8-18">samples <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.asarray(samples)</span></code></pre></div>
</div>
<p>Viewing the histogram of posterior predictive samples:</p>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1">hist_color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7595"</span></span>
<span id="cb9-2">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb9-3">ax.set_title(</span>
<span id="cb9-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior predictive samples for new predictors"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb9-5">    )</span>
<span id="cb9-6">ax.hist(</span>
<span id="cb9-7">    samples, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>hist_color, </span>
<span id="cb9-8">    edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb9-9">    )</span>
<span id="cb9-10">label0, label1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{y}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{OLS}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span>, <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat y_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{MCMC}</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">$"</span> </span>
<span id="cb9-11">ax.axvline(np.dot(b_ols.T, Xnew), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>label0)</span>
<span id="cb9-12">ax.axvline(samples.mean(), color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>label1)</span>
<span id="cb9-13">ax.xaxis.set_major_formatter(mpl.ticker.StrMethodFormatter(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{x:,.0f}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>))</span>
<span id="cb9-14">ax.set_yticklabels([])</span>
<span id="cb9-15">ax.set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb9-16">ax.set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb9-17">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb9-18">ax.tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb9-19">ax.xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb9-20">ax.yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb9-21">ax.grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb9-22">ax.set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb9-23">ax.legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper right"</span>, fancybox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"small"</span>)</span>
<span id="cb9-24">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/gibbs-sampling-linear-regression/gibbs-sampling-linear-regression_files/figure-html/cell-10-output-1.png" class="img-fluid figure-img" alt="Histogram of posterior predictive samples"></p>
<figcaption>Histogram of posterior predictive samples</figcaption>
</figure>
</div>
</div>
</div>
<p>Finally, percentiles of the posterior predictive samples:</p>
<div id="cell-20" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"></span>
<span id="cb10-2">peval <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">99</span>]</span>
<span id="cb10-3">pcols <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ii<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">%"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> peval]</span>
<span id="cb10-4"></span>
<span id="cb10-5">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(</span>
<span id="cb10-6">    np.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">round</span>(np.percentile(samples, q<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>peval), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>).reshape(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), </span>
<span id="cb10-7">    columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pcols,index<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"posterior predictive samples"</span>]</span>
<span id="cb10-8">    )</span>
<span id="cb10-9">df.head(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">1%</th>
<th data-quarto-table-cell-role="th">5%</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">95%</th>
<th data-quarto-table-cell-role="th">99%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">posterior predictive samples</td>
<td>464.64</td>
<td>530.08</td>
<td>613.37</td>
<td>673.32</td>
<td>731.45</td>
<td>813.15</td>
<td>883.41</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/gibbs-sampling-linear-regression/gibbs-sampling-linear-regression.html</guid>
  <pubDate>Mon, 05 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Bessel’s Correction</title>
  <link>https://www.jtrive.com/posts/bessels-correction/bessels-correction.html</link>
  <description><![CDATA[ 





<p>Bessel’s correction is the use of <img src="https://latex.codecogs.com/png.latex?n-1"> instead of <img src="https://latex.codecogs.com/png.latex?n"> in the sample variance formula where <img src="https://latex.codecogs.com/png.latex?n"> is the number of observations in a sample. This method corrects the bias in the estimation of the population variance.</p>
<p>Recall that <em>bias</em> is defined as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BBias%7D(%5Ctheta)%20=%20E%5B%5Chat%7B%5Ctheta%7D%5D%20-%20%5Ctheta,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Ctheta"> represents the actual parameter value, and <img src="https://latex.codecogs.com/png.latex?E%5B%5Chat%7B%5Ctheta%7D%5D"> is an estimator of the parameter <img src="https://latex.codecogs.com/png.latex?%5Ctheta">. A desirable property of an estimator is that its expected value equals the parameter being estimated, or <img src="https://latex.codecogs.com/png.latex?E%5B%5Chat%7B%5Ctheta%7D%5D%20=%20%5Ctheta">. When this occurs, the estimator is said to be <em>unbiased</em>. Let <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D"> represent the population variance, given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Chat%7B%5Csigma%7D%5E%7B2%7D%20=%20%5Cfrac%7B1%7D%7Bn%7D%5Csum_%7Bi=1%7D%5E%7Bn%7D(Y_%7Bi%7D%20-%20%5Cbar%7BY%7D)%5E%7B2%7D.%0A"></p>
<p>To show that <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Csigma%7D%5E%7B2%7D"> is a biased estimator for <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">, let <img src="https://latex.codecogs.com/png.latex?Y_%7B1%7D,%20Y_%7B2%7D,%20%5Ccdots,%20Y_%7Bn%7D"> be a random sample with <img src="https://latex.codecogs.com/png.latex?E%5BY_%7Bi%7D%5D%20=%20%5Cmu"> and <img src="https://latex.codecogs.com/png.latex?Var%5BY_%7Bi%7D%5D%20=%20%5Csigma%5E%7B2%7D">. First, note that</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csum_%7Bi=1%7D%5E%7Bn%7D(Y_%7Bi%7D%20-%20%5Cbar%7BY%7D)%5E%7B2%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7DY_%7Bi%7D%5E%7B2%7D%20-%20n%5Cbar%7BY%7D%5E%7B2%7D,%0A"></p>
<p>and as a result</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AE%5CBig%5B%5Csum_%7Bi=1%7D%5E%7Bn%7D(Y_%7Bi%7D%20-%20%5Cbar%7BY%7D)%5E%7B2%7D%5CBig%5D%20=%20E%5CBig(%5Csum_%7Bi=1%7D%5E%7Bn%7DY_%7Bi%7D%5E%7B2%7D%5CBig)%20-%20nE(%5Cbar%7BY%7D%5E%7B2%7D)%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7DE(Y_%7Bi%7D%5E%7B2%7D)%20-%20nE(%5Cbar%7BY%7D%5E%7B2%7D).%0A"></p>
<p>Rearranging the familiar expression for variance yields</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AE%5BY%5E%7B2%7D%5D%20=%20Var%5BY%5D%20+%20E%5BY%5D%5E%7B2%7D%20=%20%5Csigma%5E%7B2%7D%20+%20%5Cmu%5E%7B2%7D,%0A"></p>
<p>and similarly,</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AVar%5B%5Cbar%7BY%7D%5D%20+%20E%5B%5Cbar%7BY%7D%5D%5E%7B2%7D%20=%20%5Csigma%5E%7B2%7D/n%20+%20%5Cmu%5E%7B2%7D.%0A"></p>
<p>Therefore</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AE%5CBig%5B%5Csum_%7Bi=1%7D%5E%7Bn%7D(Y_%7Bi%7D-%5Cbar%7BY%7D)%5E%7B2%7D%5CBig%5D%20&amp;=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%5Csigma%5E%7B2%7D+%5Cmu%5E%7B2%7D-n%5CBig(%5Cfrac%7B%5Csigma%5E%7B2%7D%7D%7Bn%7D%20+%20%5Cmu%5E%7B2%7D%5CBig)%20%5C%5C%0A&amp;=n(%5Csigma%5E%7B2%7D%20+%20%5Cmu%5E%7B2%7D)%20-%20n%5CBig(%5Cfrac%7B%5Csigma%5E%7B2%7D%7D%7Bn%7D%20+%20%5Cmu%5E%7B2%7D%5CBig)%20%5C%5C%0A&amp;=n%5Csigma%5E%7B2%7D%20-%20%5Csigma%5E%7B2%7D%20=%20(n-1)%5Csigma%5E%7B2%7D.%0A%5Cend%7Balign*%7D%0A"></p>
<p>Thus,</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AE%5B%5Chat%7B%5Csigma%7D%5E%7B2%7D%5D%20=%20%5Cfrac%7B1%7D%7Bn%7DE%5CBig%5B%5Csum_%7Bi=1%7D%5E%7Bn%7D(Y_%7Bi%7D%20-%20%5Cbar%7BY%7D)%5E%7B2%7D%5CBig%5D%20=%20%5Cfrac%7B1%7D%7Bn%7D(n-1)%5Csigma%5E%7B2%7D%20=%20%5CBig(%5Cfrac%7Bn-1%7D%7Bn%7D%5CBig)%5Csigma%5E%7B2%7D,%0A"></p>
<p>and we conclude that <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D"> is biased since <img src="https://latex.codecogs.com/png.latex?E%5B%5Chat%7B%5Csigma%7D%5E%7B2%7D%5D%20%5Cne%20%5Csigma%5E%7B2%7D">. We now consider the sample variance <img src="https://latex.codecogs.com/png.latex?S%5E%7B2%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AE%5BS%5E%7B2%7D%5D%20=%20%5Cfrac%7B1%7D%7Bn-1%7DE%5CBig%5B%5Csum_%7Bi=1%7D%5E%7Bn%7D(Y_%7Bi%7D%20-%20%5Cbar%7BY%7D)%5E%7B2%7D%5CBig%5D%20=%20%5Cfrac%7B1%7D%7Bn-1%7D(n-1)%5Csigma%5E%7B2%7D%20=%20%5Csigma%5E%7B2%7D,%0A"></p>
<p>and since <img src="https://latex.codecogs.com/png.latex?E%5BS%5E%7B2%7D%5D%20=%20%5Csigma%5E%7B2%7D">, we conclude that <img src="https://latex.codecogs.com/png.latex?S%5E%7B2%7D"> is an unbiased estimator for <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">.</p>
<section id="demonstration" class="level3">
<h3 class="anchored" data-anchor-id="demonstration">Demonstration</h3>
<p>An important property of an unbiased estimator of a population parameter is that if the sample statistic is evaluated for every possible sample and the average computed, the mean over all samples will exactly equal the population parameter. For a given population with mean <img src="https://latex.codecogs.com/png.latex?%5Cmu"> and variance <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">, if the sample variance (division by <img src="https://latex.codecogs.com/png.latex?(n%E2%88%921)">) is computed for all possible permutations of the dataset, the average of the sample variances will exactly equal <img src="https://latex.codecogs.com/png.latex?%5Csigma%5E%7B2%7D">. This also demonstrates (indirectly) that division by <img src="https://latex.codecogs.com/png.latex?n"> would consistently underestimate the population variance.</p>
<p>We now attempt to verify this property on the following dataset:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A7,%209,%2010,%2012,%2015%0A"></p>
<p>The Python itertools module exposes a collection of efficient iterators that stream values on-demand based on various starting and/or stopping conditions. For example, the <code>permutations</code> implementation takes as arguments an iterable and the length of the permutation <code>r</code>. It returns all <code>r</code>-length permutations of elements from the iterable (itertools also exposes a <code>combinations</code> function that does the same for all r-length combinations). The <code>product</code> function generates the cartesian product of the specified iterables, and takes an optional <code>repeat</code> argument. From the <a href="https://docs.python.org/3/library/itertools.html#itertools.product">documentation</a>:</p>
<blockquote class="blockquote">
<p>To compute the product of an iterable with itself, specify the number of repetitions with the optional repeat keyword argument. For example, <code>product(A, repeat=4)</code> means the same as product(A, A, A, A).</p>
</blockquote>
<p><code>product</code> is used to compute the average sample variance for all 2, 3 and 4-element permutations from <img src="https://latex.codecogs.com/png.latex?%5B7,%209,%2010,%2012,%2015%5D">, and the result is compared to the population variance. Before we begin, lets calculate the population mean and variance:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cbar%7BY%7D%20&amp;=%2010.6%20%5C%5C%0A%5Csigma%5E%7B2%7D%20&amp;=%20%5Csum_%7Bi=1%7D%5E%7B5%7D%5Cfrac%7BY_%7Bi%7D%5E%7B2%7D%7D%7Bn%7D%20-%20%5Cbar%7BY%7D%5E%7B2%7D%20%5C%5C%0A&amp;=%20119.8%20-%2010.6%5E%7B2%7D%20%5C%5C%0A&amp;=%207.44%0A%5Cend%7Balign*%7D%0A"></p>
<p>We now compute the average of the sample variance for all <img src="https://latex.codecogs.com/png.latex?k">-element permutations from <img src="https://latex.codecogs.com/png.latex?%5B7,%209,%2010,%2012,%2015%5D"> for <img src="https://latex.codecogs.com/png.latex?2%20%5Cle%20k%20%5Cle%205">:</p>
<div id="cell-2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Demonstrating that the sample variance is an unbiased estimator </span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">of the population variance. </span></span>
<span id="cb1-4"></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Generate all possible 2, 3, 4 and 5-element permutations from </span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[7, 9, 10, 12, 15], and determine the sample variance of each </span></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">sample. The average of the sample variances will exactly equate </span></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">to the population variance if the sample variance is an unbiased </span></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">estimator of the population variance.</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-11"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> itertools</span>
<span id="cb1-12"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-13"></span>
<span id="cb1-14">v <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>]</span>
<span id="cb1-15"></span>
<span id="cb1-16"></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify that the average of the sample variance</span></span>
<span id="cb1-18"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for all 2-element samples equates to 7.44.</span></span>
<span id="cb1-19">s2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(itertools.product(v, repeat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb1-20">result2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean([np.var(ii, ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> s2])</span>
<span id="cb1-21"></span>
<span id="cb1-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify that the average of the sample variance</span></span>
<span id="cb1-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for all 3-element samples equates to 7.44.</span></span>
<span id="cb1-24">s3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(itertools.product(v, repeat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb1-25">result3 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean([np.var(ii, ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> s3])</span>
<span id="cb1-26"></span>
<span id="cb1-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify that the average of the sample variance</span></span>
<span id="cb1-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for all 4-element samples equates to 7.44.</span></span>
<span id="cb1-29">s4 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(itertools.product(v, repeat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb1-30">result4 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean([np.var(ii, ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> s4])</span>
<span id="cb1-31"></span>
<span id="cb1-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify that the average of the sample variance</span></span>
<span id="cb1-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># for all 5-element samples equates to 7.44.</span></span>
<span id="cb1-34">s5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(itertools.product(v, repeat<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb1-35">result5 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.mean([np.var(ii, ddof<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> s5])</span>
<span id="cb1-36"></span>
<span id="cb1-37"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"result2: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-38"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"result3: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result3<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-39"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"result4: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result4<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-40"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"result5: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>result5<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>result2: 7.44
result3: 7.4399999999999995
result4: 7.44
result5: 7.44</code></pre>
</div>
</div>
<p>Since the sample variance is an unbiased estimator of the population variance, these results should come as no surprise, but it is an interesting demonstration nonetheless.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/bessels-correction/bessels-correction.html</guid>
  <pubDate>Thu, 01 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Generating Correlated Random Samples in Python</title>
  <link>https://www.jtrive.com/posts/correlated-samples/correlated-samples.html</link>
  <description><![CDATA[ 





<p>An analysis may require the ability to generate correlated random samples. For example, imagine we have monthly returns for three financial indicators over a 20 year period. We are interested in modeling these returns using parametric distributions for some downstream analysis, perhaps to estimate tail behavior over a large number of samples. In this post, I’ll demonstrate that assuming independence of truly correlated random variables falls short, and how to correctly model the correlation for sample generation. The financial indicator data is available <a href="https://gist.githubusercontent.com/jtrive84/9955433e344ec773e5766657f961fde5/raw/b2e2c99db1e05aeb69186550b9c78cc9412df911/sample_returns.csv">here</a>.</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"></span>
<span id="cb1-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> mpl</span>
<span id="cb1-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> plt</span>
<span id="cb1-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-5"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> stats</span>
<span id="cb1-6"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> pandas <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> pd</span>
<span id="cb1-7"></span>
<span id="cb1-8">indicator_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://gist.githubusercontent.com/jtrive84/9955433e344ec773e5766657f961fde5/raw/b2e2c99db1e05aeb69186550b9c78cc9412df911/sample_returns.csv"</span></span>
<span id="cb1-9"></span>
<span id="cb1-10">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(indicator_url)</span>
<span id="cb1-11"></span>
<span id="cb1-12">df.head()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">us_credit</th>
<th data-quarto-table-cell-role="th">us_market</th>
<th data-quarto-table-cell-role="th">global_market</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1/31/2001</td>
<td>0.035525</td>
<td>0.0301</td>
<td>0.022123</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2/28/2001</td>
<td>-0.001583</td>
<td>-0.0950</td>
<td>-0.091336</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3/31/2001</td>
<td>0.002638</td>
<td>-0.0675</td>
<td>-0.075002</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>4/30/2001</td>
<td>0.010607</td>
<td>0.0738</td>
<td>0.075063</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5/31/2001</td>
<td>0.010448</td>
<td>0.0035</td>
<td>-0.010473</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The table contains monthly returns for us_credit, us_market and global_market from 2001-01-31 up to 2023-06-30, but our approach can be extended to any number of financial indicators. Our goal is to find an appropriate parametric distribution for each indicator to use for sample generation. We start by plotting histograms of each indicator to get an idea of the distributional form (symmetric, skewed, etc.). This will dictate which distribution we use to find the best fitting parameters via maximum likelihood. Since there are positive and negative values for each indicator, using a normal distribution is probably a safe bet. If values of the indicators were strictly positive, we would use a distribution with support on <img src="https://latex.codecogs.com/png.latex?(0,%20%5Cinfty)"> such as gamma, lognormal or weibull.</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot histogram for each indicator.</span></span>
<span id="cb2-2">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.drop(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date"</span>, axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4">indicators <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.columns</span>
<span id="cb2-5"></span>
<span id="cb2-6">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii, ind_name <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(indicators):</span>
<span id="cb2-9">    </span>
<span id="cb2-10">    ind_mean, ind_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[ind_name].mean(), df[ind_name].std()</span>
<span id="cb2-11">    label0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\bar x = $"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ind_mean<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-12">    label1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$s = $"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>ind_std<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-13">    ax[ii].set_title(ind_name, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb2-14">    ax[ii].hist(</span>
<span id="cb2-15">        df[ind_name].values, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7595"</span>, </span>
<span id="cb2-16">        edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb2-17">        )</span>
<span id="cb2-18">    </span>
<span id="cb2-19">    ax[ii].axvline(ind_mean, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.25</span>, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>, label<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \mu$"</span>)</span>
<span id="cb2-20">    ax[ii].set_yticklabels([])</span>
<span id="cb2-21">    ax[ii].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb2-22">    ax[ii].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb2-23">    ax[ii].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb2-24">    ax[ii].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb2-25">    ax[ii].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb2-26">    ax[ii].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb2-27">    ax[ii].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb2-28">    ax[ii].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb2-29">    ax[ii].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb2-30">    ax[ii].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb2-31">    </span>
<span id="cb2-32">    ax[ii].annotate(</span>
<span id="cb2-33">        label0, xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.90</span>), xycoords<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"axes fraction"</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, </span>
<span id="cb2-34">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span></span>
<span id="cb2-35">        ) </span>
<span id="cb2-36">    ax[ii].annotate(</span>
<span id="cb2-37">        label1, xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.85</span>), xycoords<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"axes fraction"</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, </span>
<span id="cb2-38">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span></span>
<span id="cb2-39">        ) </span>
<span id="cb2-40">    ax[ii].legend(loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"upper right"</span>, fancybox<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, framealpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x-small"</span>)</span>
<span id="cb2-41">    </span>
<span id="cb2-42">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/correlated-samples/correlated-samples_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img" alt="Histograms for us_credit, us_market and global_market."></p>
<figcaption>Distribution of returns for each indicator</figcaption>
</figure>
</div>
</div>
</div>
<p>The distribution of each indicator appears relatively normal. Given that the parametric form has been identified, we can use Scipy to determine the optimal parameters to fit three separate normal distributions (one per indicator) via maximum likelihood.</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"></span>
<span id="cb3-2"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.stats <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> norm</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get normal parameter estimates (mean &amp; standard deviation) via maximum likelihood.</span></span>
<span id="cb3-5">mu0, std0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm.fit(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>], method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MLE"</span>)</span>
<span id="cb3-6">mu1, std1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm.fit(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>], method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MLE"</span>)</span>
<span id="cb3-7">mu2, std2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm.fit(df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>], method<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MLE"</span>)</span>
<span id="cb3-8"></span>
<span id="cb3-9">dparams <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb3-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>: mu0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>: std0},</span>
<span id="cb3-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>: mu1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>: std1},</span>
<span id="cb3-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>: mu2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>: std2},</span>
<span id="cb3-13">    }</span>
<span id="cb3-14"></span>
<span id="cb3-15"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">- us_credit    : mean=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> std==</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>std0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- us_market    : mean=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> std==</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>std1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"- global_market: mean=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mu2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> std==</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>std2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.5f}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
- us_credit    : mean=0.00015 std==0.02138
- us_market    : mean=0.00595 std==0.04442
- global_market: mean=0.00517 std==0.04605
</code></pre>
</div>
</div>
<p>The parameter estimates match very closely with the empirical mean and standard deviation overlaid on each histogram. This is because the MLE estimates for the normal distribution are equal to the sample mean and the unadjusted sample variance. Next we overlay the best fitting parametric distribution with each indicator histogram in order to assess the quality of fit.</p>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot histogram for each indicator along with parameterized normal distribution.</span></span>
<span id="cb5-2">hist_color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#ff7595"</span></span>
<span id="cb5-3">dist_color <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#0000FF"</span></span>
<span id="cb5-4"></span>
<span id="cb5-5">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">9.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">3.5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb5-6"></span>
<span id="cb5-7"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> ii, ind_name <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(indicators):</span>
<span id="cb5-8"></span>
<span id="cb5-9">    vals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[ind_name]</span>
<span id="cb5-10">    mle_mean, mle_std <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dparams[ind_name][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>], dparams[ind_name][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>]</span>
<span id="cb5-11"></span>
<span id="cb5-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get PDF values associated with distribution.</span></span>
<span id="cb5-13">    ndist <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm(mle_mean, mle_std)</span>
<span id="cb5-14">    xvals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linspace(vals.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.90</span>, vals.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>)</span>
<span id="cb5-15">    yvals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> ndist.pdf(xvals)</span>
<span id="cb5-16"></span>
<span id="cb5-17">    label0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \mu = $"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mle_mean<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb5-18">    label1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"$\hat \sigma = $"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>mle_std<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:,.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb5-19">    </span>
<span id="cb5-20">    ax[ii].set_title(ind_name, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span>
<span id="cb5-21">    ax[ii].hist(</span>
<span id="cb5-22">        df[ind_name].values, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span>, density<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>hist_color, </span>
<span id="cb5-23">        edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb5-24">        )</span>
<span id="cb5-25"></span>
<span id="cb5-26">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot normal distribution.</span></span>
<span id="cb5-27">    ax[ii].plot(xvals, yvals, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dist_color, linestyle<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--"</span>)</span>
<span id="cb5-28">    ax[ii].set_yticklabels([])</span>
<span id="cb5-29">    ax[ii].set_xlabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb5-30">    ax[ii].set_ylabel(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb5-31">    ax[ii].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb5-32">    ax[ii].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb5-33">    ax[ii].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb5-34">    ax[ii].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb5-35">    ax[ii].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb5-36">    ax[ii].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb5-37">    ax[ii].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb5-38">    ax[ii].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb5-39">    </span>
<span id="cb5-40">    ax[ii].annotate(</span>
<span id="cb5-41">        label0, xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.90</span>), xycoords<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"axes fraction"</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, </span>
<span id="cb5-42">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span></span>
<span id="cb5-43">        ) </span>
<span id="cb5-44">    ax[ii].annotate(</span>
<span id="cb5-45">        label1, xy<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.05</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.85</span>), xycoords<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"axes fraction"</span>, ha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>, va<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, </span>
<span id="cb5-46">        fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>, rotation<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"normal"</span>, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span></span>
<span id="cb5-47">        ) </span>
<span id="cb5-48">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#ax[ii].legend(loc="upper right", fancybox=True, framealpha=1, fontsize="x-small")</span></span>
<span id="cb5-49">plt.suptitle(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Indicator histograms w/ parametric overlay"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb5-50">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span>
<span id="cb5-51"></span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/correlated-samples/correlated-samples_files/figure-html/cell-5-output-1.png" class="img-fluid figure-img" alt="Histograms for us_credit, us_market and global_market with normal density overlay"></p>
<figcaption>Indicator histograms with parametric overlay</figcaption>
</figure>
</div>
</div>
</div>
<p>The distributions in each case enclose the original histograms pretty well, with decent tail coverage in each instance. To demonstrate the approach, we next generate independent random samples from each indicator.</p>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"></span>
<span id="cb6-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Specify number of samples to generate.</span></span>
<span id="cb6-3">nbr_sims <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Copying dparams from previous cell.</span></span>
<span id="cb6-6">dparams <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb6-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>: mu0, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>: std0},</span>
<span id="cb6-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>: mu1, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>: std1},</span>
<span id="cb6-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>: {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>: mu2, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>: std2},</span>
<span id="cb6-10">    }</span>
<span id="cb6-11"></span>
<span id="cb6-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># us_credit.</span></span>
<span id="cb6-13">mean0, std0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dparams[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>], dparams[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>]</span>
<span id="cb6-14">rv0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm(mean0, std0)</span>
<span id="cb6-15"></span>
<span id="cb6-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># us_market.</span></span>
<span id="cb6-17">mean1, std1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dparams[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>], dparams[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>]</span>
<span id="cb6-18">rv1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm(mean1, std1)</span>
<span id="cb6-19"></span>
<span id="cb6-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># global_market.</span></span>
<span id="cb6-21">mean2, std2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dparams[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>], dparams[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"std"</span>]</span>
<span id="cb6-22">rv2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> norm(mean2, std2)</span>
<span id="cb6-23"></span>
<span id="cb6-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create DataFrame to hold simulated indicators. </span></span>
<span id="cb6-25">dfsims1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(</span>
<span id="cb6-26">    np.vstack([rv0.rvs(nbr_sims), rv1.rvs(nbr_sims), rv2.rvs(nbr_sims)]).T,</span>
<span id="cb6-27">    columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>indicators</span>
<span id="cb6-28">    )</span>
<span id="cb6-29"></span>
<span id="cb6-30">dfsims1.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">us_credit</th>
<th data-quarto-table-cell-role="th">us_market</th>
<th data-quarto-table-cell-role="th">global_market</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>500.000000</td>
<td>500.000000</td>
<td>500.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.000558</td>
<td>0.012024</td>
<td>0.006257</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.022043</td>
<td>0.042455</td>
<td>0.045772</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-0.072494</td>
<td>-0.115241</td>
<td>-0.148560</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-0.014534</td>
<td>-0.017264</td>
<td>-0.024564</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>-0.000501</td>
<td>0.014443</td>
<td>0.007020</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.014217</td>
<td>0.042519</td>
<td>0.038046</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>0.069504</td>
<td>0.149524</td>
<td>0.132896</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Here we assume the value that an indicator takes on is independent of all other indicators. This is almost surely not the case. Let’s check how correlated the 3 selected indicators are within the original sample:</p>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"></span>
<span id="cb7-2">df.corr()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">us_credit</th>
<th data-quarto-table-cell-role="th">us_market</th>
<th data-quarto-table-cell-role="th">global_market</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">us_credit</td>
<td>1.000000</td>
<td>-0.099877</td>
<td>-0.037652</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">us_market</td>
<td>-0.099877</td>
<td>1.000000</td>
<td>0.955514</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">global_market</td>
<td>-0.037652</td>
<td>0.955514</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Do the independent samples exhibit the same correlation?</p>
<div id="cell-14" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"></span>
<span id="cb8-2">dfsims1.corr()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">us_credit</th>
<th data-quarto-table-cell-role="th">us_market</th>
<th data-quarto-table-cell-role="th">global_market</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">us_credit</td>
<td>1.000000</td>
<td>-0.072533</td>
<td>-0.066023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">us_market</td>
<td>-0.072533</td>
<td>1.000000</td>
<td>-0.044359</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">global_market</td>
<td>-0.066023</td>
<td>-0.044359</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Not surprisingly, us_market and global_market are over 95% correlated in the original data. This is not exhibited within the set of non-correlated samples. With such high correlation, it is not reasonable to assume independence across indicators. We need instead to find a way to generate correlated random samples. This can be accomplished using Numpy’s multivariate normal distribution.</p>
<p>As a brief aside, the significance of a correlation between two random variables depends on the sample size. To test if the correlation between two variables demonstrates a linear relationship at the 5% significance level, we compute:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%7C%5Crho%7C%20%5Cgt%202%20/%20%5Csqrt%7Bn%7D,%0A"></p>
<p>In our case, there are 270 samples, therefore <img src="https://latex.codecogs.com/png.latex?n%20=%20%5Csqrt%7B270%7D%20%5Capprox%2016.4">. Thus, in order for the correlation between two indicators to be significant at the 5% level, it needs to be greater than <img src="https://latex.codecogs.com/png.latex?2%20/%2016.4%20%5Capprox%20.12">, which is clearly the case for global_market-us_market.</p>
<div id="cell-16" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"></span>
<span id="cb9-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate correlated random samples.</span></span>
<span id="cb9-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Specify number of simulations to generate.</span></span>
<span id="cb9-4">nbr_sims <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb9-5"></span>
<span id="cb9-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create vector of means.</span></span>
<span id="cb9-7">means <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [mean0, mean1, mean2]</span>
<span id="cb9-8"></span>
<span id="cb9-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Bind reference to covariance matrix.</span></span>
<span id="cb9-10">V <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.cov().values</span>
<span id="cb9-11"></span>
<span id="cb9-12">dfsims2 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(</span>
<span id="cb9-13">    np.random.multivariate_normal(means, V, nbr_sims),</span>
<span id="cb9-14">    columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>indicators</span>
<span id="cb9-15">    )</span>
<span id="cb9-16"></span>
<span id="cb9-17">dfsims2.describe()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">us_credit</th>
<th data-quarto-table-cell-role="th">us_market</th>
<th data-quarto-table-cell-role="th">global_market</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>500.000000</td>
<td>500.000000</td>
<td>500.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.000547</td>
<td>0.005966</td>
<td>0.005387</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.021886</td>
<td>0.042421</td>
<td>0.044833</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>-0.062250</td>
<td>-0.097373</td>
<td>-0.137454</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>-0.013780</td>
<td>-0.024495</td>
<td>-0.027463</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.000788</td>
<td>0.007268</td>
<td>0.006098</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>0.015203</td>
<td>0.033833</td>
<td>0.035412</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>0.067324</td>
<td>0.136830</td>
<td>0.148773</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The min and max values for each indicator seem to align with what was observed in the original data. Let’s verify that the samples in <code>dfsims2</code> are correlated.</p>
<div id="cell-18" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"></span>
<span id="cb10-2">dfsims2.corr()</span></code></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">us_credit</th>
<th data-quarto-table-cell-role="th">us_market</th>
<th data-quarto-table-cell-role="th">global_market</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">us_credit</td>
<td>1.000000</td>
<td>-0.084854</td>
<td>-0.038219</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">us_market</td>
<td>-0.084854</td>
<td>1.000000</td>
<td>0.944791</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">global_market</td>
<td>-0.038219</td>
<td>0.944791</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>This matches closely with the original correlation profile. Let’s visualize the correlation in the generated random samples by comparing indicator samples from the independent simulated dataset vs.&nbsp;the dependent simulated dataset.</p>
<div id="cell-20" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate pair-wise scatter plots for each indicator for independent and dependent draws. </span></span>
<span id="cb11-2"></span>
<span id="cb11-3">dindices <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb11-4">    (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>): {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"independent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>},</span>
<span id="cb11-5">    (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>): {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"independent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>},</span>
<span id="cb11-6">    (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>): {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"independent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>},</span>
<span id="cb11-7">    (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>): {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dependent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>},</span>
<span id="cb11-8">    (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>): {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dependent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_credit"</span>},</span>
<span id="cb11-9">    (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>): {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dependent"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"us_market"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"global_market"</span>},</span>
<span id="cb11-10">    }</span>
<span id="cb11-11"></span>
<span id="cb11-12"></span>
<span id="cb11-13">fig, ax <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> plt.subplots(nrows<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, ncols<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, figsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">6.5</span>), tight_layout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb11-14"></span>
<span id="cb11-15"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> kk, vv <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> dindices.items():</span>
<span id="cb11-16">    </span>
<span id="cb11-17">    ii, jj <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> kk</span>
<span id="cb11-18">    data_desc, x_desc, y_desc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> vv[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>], vv[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>], vv[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>]</span>
<span id="cb11-19"></span>
<span id="cb11-20">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> data_desc <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"independent"</span>:</span>
<span id="cb11-21">        xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dfsims1[x_desc].values</span>
<span id="cb11-22">        yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dfsims1[y_desc].values</span>
<span id="cb11-23">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb11-24">        xx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dfsims2[x_desc].values</span>
<span id="cb11-25">        yy <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dfsims2[y_desc].values</span>
<span id="cb11-26">        </span>
<span id="cb11-27">    titlestr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>data_desc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>x_desc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> vs. </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>y_desc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb11-28">    ax[ii, jj].set_title(titlestr, color<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, loc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, weight<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb11-29">    ax[ii, jj].scatter(</span>
<span id="cb11-30">        xx, yy, s<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, c<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FFFFFF"</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.85</span>, edgecolor<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#000000"</span>, linewidth<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">.75</span>)</span>
<span id="cb11-31"></span>
<span id="cb11-32">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ax[ii].set_yticklabels([])</span></span>
<span id="cb11-33">    ax[ii, jj].set_xlabel(x_desc, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb11-34">    ax[ii, jj].set_ylabel(y_desc, fontsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>)</span>
<span id="cb11-35">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb11-36">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb11-37">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"major"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb11-38">    ax[ii, jj].tick_params(axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"y"</span>, which<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minor"</span>, direction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'in'</span>, labelsize<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>)</span>
<span id="cb11-39">    ax[ii, jj].xaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb11-40">    ax[ii, jj].yaxis.set_ticks_position(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb11-41">    ax[ii, jj].grid(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)   </span>
<span id="cb11-42">    ax[ii, jj].set_axisbelow(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>) </span>
<span id="cb11-43"></span>
<span id="cb11-44">plt.show()<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span></span></code></pre></div>
<div class="cell-output cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.jtrive.com/posts/correlated-samples/correlated-samples_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img" alt="Scatterplots by indicator pair for correlated and uncorrelated samples."></p>
<figcaption>Scatterplots by indicator pair for correlated and uncorrelated samples.</figcaption>
</figure>
</div>
</div>
</div>
<p>In the case of global_market-us_market (bottom right), the dependent plot captures the correlation inherent in the original data.</p>



 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/correlated-samples/correlated-samples.html</guid>
  <pubDate>Thu, 01 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Derivation of the Normal Equations</title>
  <link>https://www.jtrive.com/posts/deriv-normal-equations/deriv-normal-equations.html</link>
  <description><![CDATA[ 





<p>The Normal Equations, represented in matrix form as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A(X%5E%7BT%7DX)%5Chat%7B%5Cbeta%7D%20=%20X%5E%7BT%7Dy%0A"></p>
<p>are utilized in determining coefficient estimates associated with regression models. The matrix form is a compact representation of the model specification commonly represented as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ay%20=%20%5Cbeta_%7B0%7D%20+%20%5Cbeta_%7B1%7Dx_%7B1%7D%20+%20%5Cbeta_%7B2%7Dx_%7B2%7D%20+%20%5Ccdots%20+%20%5Cbeta_%7Bk%7Dx_%7Bk%7D%20+%20%5Cvarepsilon%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cepsilon"> represents the error term, and</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Cvarepsilon_%7Bi%7D%20=%200.%0A"></p>
<p>For a dataset with <img src="https://latex.codecogs.com/png.latex?n"> records by <img src="https://latex.codecogs.com/png.latex?k"> explanatory variables per record, the components of the Normal Equations are:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D%20=%20(%5Chat%7B%5Cbeta%7D_%7B0%7D,%5Chat%7B%5Cbeta%7D_%7B1%7D,%5Ccdots,%5Chat%7B%5Cbeta%7D_%7Bk%7D)%5E%7BT%7D">, a vector of <img src="https://latex.codecogs.com/png.latex?(k+1)"> coefficents (one for each of the k explanatory variables plus one for the intercept term)<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?X"> , an <img src="https://latex.codecogs.com/png.latex?n"> by <img src="https://latex.codecogs.com/png.latex?(k+1)">-dimensional matrix of explanatory variables, with the first column consisting entirely of 1’s<br>
</li>
<li><img src="https://latex.codecogs.com/png.latex?%7By%7D%20=%20(y_%7B1%7D,%20y_%7B2%7D,...,y_%7Bn%7D)">, the response</li>
</ul>
<p>The task is to solve for the <img src="https://latex.codecogs.com/png.latex?(k+1)"> <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7Bj%7D">’s such that <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D_%7B0%7D,%20%5Chat%7B%5Cbeta%7D_%7B1%7D,...,%5Chat%7B%5Cbeta%7D_%7Bk%7D"> minimize</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Chat%7B%5Cvarepsilon%7D%5E%7B2%7D_%7Bi%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(y_%7Bi%7D%20-%20%5Chat%7B%5Cbeta%7D_%7B0%7D%20-%20%5Chat%7B%5Cbeta%7D_%7B1%7Dx_%7Bi1%7D%20-%20%5Chat%7B%5Cbeta%7D_%7B2%7Dx_%7Bi2%7D%20-%20%5Ccdots%20-%20%5Chat%7B%5Cbeta%7D_%7Bk%7Dx_%7Bik%7D)%5E2.%0A"></p>
<p>The Normal Equations can be derived using Least-Squares and Maximum likelihood Estimation.</p>
<section id="least-squares-derivation" class="level3">
<h3 class="anchored" data-anchor-id="least-squares-derivation">Least-Squares Derivation</h3>
<p>Unlike Maximum Likelihood derivation, the Least-Squares approach requires no distributional assumption. For <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D_%7B0%7D,%20%5Chat%7B%5Cbeta%7D_%7B1%7D,%20%5Ccdots%20,%5Chat%7B%5Cbeta%7D_%7Bk%7D">, we seek estimators that minimize the sum of squared deviations between the <img src="https://latex.codecogs.com/png.latex?n"> response values and the predicted values, <img src="https://latex.codecogs.com/png.latex?%5Chat%7By%7D">. The objective is to minimize</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Csum_%7Bi=1%7D%5E%7Bn%7D%20%5Chat%7B%5Cvarepsilon%7D%5E%7B2%7D_%7Bi%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(y_%7Bi%7D%20-%20%5Chat%7B%5Cbeta%7D_%7B0%7D%20-%20%5Chat%7B%5Cbeta%7D_%7B1%7Dx_%7Bi1%7D%20-%20%5Chat%7B%5Cbeta%7D_%7B2%7Dx_%7Bi2%7D%20-%20%5Ccdots%20-%20%5Chat%7B%5Cbeta%7D_%7Bk%7Dx_%7Bik%7D)%5E2.%0A"></p>
<p>Using matrix notation, our model can be represented as <img src="https://latex.codecogs.com/png.latex?y%20=%20X%5E%7BT%7D%5Cbeta%20+%20%5Cvarepsilon">. Isolating and squaring the error term yields</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Chat%20%5Cvarepsilon%5ET%20%5Chat%20%5Cvarepsilon%20=%20%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(y%20-%20X%5Chat%7B%5Cbeta%7D)%5E%7BT%7D(y%20-%20X%5Chat%7B%5Cbeta%7D).%0A"></p>
<p>Expanding the right-hand side and combining terms results in</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Chat%20%5Cvarepsilon%5ET%20%5Chat%20%5Cvarepsilon%20=%20y%5E%7BT%7Dy%20-%202y%5E%7BT%7DX%5Chat%7B%5Cbeta%7D%20+%20%5Chat%7B%5Cbeta%7DX%5E%7BT%7DX%5Chat%7B%5Cbeta%7D%0A"></p>
<p>To find the value of <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D"> that minimizes <img src="https://latex.codecogs.com/png.latex?%5Chat%20%5Cvarepsilon%5ET%20%5Chat%20%5Cvarepsilon">, we differentiate <img src="https://latex.codecogs.com/png.latex?%5Chat%20%5Cvarepsilon%5ET%20%5Chat%20%5Cvarepsilon"> with respect to <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D">, and set the result to zero:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%20%5Chat%7B%5Cvarepsilon%7D%5E%7BT%7D%5Chat%7B%5Cvarepsilon%7D%7D%7B%5Cpartial%20%5Chat%7B%5Cbeta%7D%7D%20=%20-2X%5E%7BT%7Dy%20+%202X%5E%7BT%7DX%5Chat%7B%5Cbeta%7D%20=%200%0A"></p>
<p>Which can then be solved for <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Chat%7B%5Cbeta%7D%20=%20%7B(X%5E%7BT%7DX)%7D%5E%7B-1%7D%7BX%7D%5E%7BT%7Dy%0A"></p>
<p>Since <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D"> minimizes the sum of squares, <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D"> is called the <em>Least-Squares Estimator</em>.</p>
</section>
<section id="maximum-likelihood-derivation" class="level3">
<h3 class="anchored" data-anchor-id="maximum-likelihood-derivation">Maximum Likelihood Derivation</h3>
<p>For the Maximum Likelihood derivation, <img src="https://latex.codecogs.com/png.latex?X">, <img src="https://latex.codecogs.com/png.latex?y"> and <img src="https://latex.codecogs.com/png.latex?%5Chat%7B%5Cbeta%7D"> are the same as described in the Least-Squares derivation, and the model still follows the form</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ay%20=%20X%5E%7BT%7D%5Cbeta%20+%20%5Cvarepsilon%0A"></p>
<p>but now we assume the <img src="https://latex.codecogs.com/png.latex?%5Cvarepsilon_%7Bi%7D"> are <img src="https://latex.codecogs.com/png.latex?iid"> and follow a zero-mean normal distribution:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AN(%5Cvarepsilon_%7Bi%7D;%200,%20%5Csigma%5E%7B2%7D)%20=%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%5Csigma%5E%7B2%7D%7D%7D%20e%5E%7B-%20%5Cfrac%7B(y_%7Bi%7D-X%5E%7BT%7D%5Chat%7B%5Cbeta%7D)%5E%7B2%7D%7D%7B2%5Csigma%5E%7B2%7D%7D%7D.%0A"></p>
<p>In addition, the responses, <img src="https://latex.codecogs.com/png.latex?y_%7Bi%7D">, are each assumed to follow a normal distribution. For <img src="https://latex.codecogs.com/png.latex?n"> observations, the likelihood function is</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AL(%5Cbeta)%20=%20%5CBig(%5Cfrac%7B1%7D%7B%5Csqrt%7B2%5Cpi%5Csigma%5E%7B2%7D%7D%7D%5CBig)%5E%7Bn%7D%20e%5E%7B-(y-X%5Cbeta)%5E%7BT%7D(y-X%5Cbeta)/2%5Csigma%5E%7B2%7D%7D.%0A"></p>
<p>The Log-Likelihood is then</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7BLn%7D(L(%5Cbeta))%20=%20-%5Cfrac%7Bn%7D%7B2%7D%5Cmathrm%7BLn%7D(2%5Cpi)%20-%5Cfrac%7Bn%7D%7B2%7D%5Cmathrm%7BLn%7D(%5Csigma%5E%7B2%7D)-%5Cfrac%7B1%7D%7B2%5Csigma%5E%7B2%7D%7D(y-X%5Cbeta)%5E%7BT%7D(y-X%5Cbeta).%0A"></p>
<p>Taking derivatives with respect to <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> and setting the result equal to zero yields</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7B%5Cpartial%20%5Cmathrm%7BLn%7D(L(%5Cbeta))%7D%7B%5Cpartial%20%5Cbeta%7D%20=%20-2X%5E%7BT%7Dy%20-2X%5E%7BT%7DX%5Cbeta%20=%200.%0A"></p>
<p>Rearranging and solving for <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> we obtain</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Chat%7B%5Cbeta%7D%20=%20%7B(X%5E%7BT%7DX)%7D%5E%7B-1%7D%7BX%7D%5E%7BT%7Dy,%0A"></p>
<p>which is the same result obtained via Least Squares.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <guid>https://www.jtrive.com/posts/deriv-normal-equations/deriv-normal-equations.html</guid>
  <pubDate>Thu, 01 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>A Matrix Factorization Approach to Linear Regression</title>
  <link>https://www.jtrive.com/posts/mat-fact-lin-reg/mat-fact-lin-reg.html</link>
  <description><![CDATA[ 





<p>This post is intended to shed light on why the closed form solution to linear regression estimates is avoided in statistical software packages. But we start by first by deriving the solution to the normal equations within the standard multivariate regression setting.</p>
<p>The normal linear regression model specifies that the sampling variability around the mean is i.i.d. from a normal distribution:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cepsilon_%7B1%7D,%20%5Ccdots,%20%5Cepsilon_%7Bn%7D%20%5Csim%20%5Cmathrm%7Bi.i.d.%7D%5Chspace%7B.25em%7D%5Cmathrm%7Bnormal%7D(0,%20%5Csigma%5E%7B2%7D)%5C%5C%0Ay_%7Bi%7D%20=%20%5Cbeta%5E%7BT%7Dx_%7Bi%7D%20+%20%5Cepsilon_%7Bi%7D.%0A"></p>
<p>Therefore the specification for the joint PDF of observed data conditional upon and values is given by:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Af(y_%7B1%7D,%20%5Ccdots,%20y_%7Bn%7D%7Cx_%7B1%7D,%20%5Ccdots,%20x_%7Bn%7D,%20%5Cbeta,%20%5Csigma%5E%7B2%7D)%20&amp;=%20%5Cprod_%7Bi=1%7D%5E%7Bn%7D%20f(y_%7Bi%7D%7Cx_%7Bi%7D,%20%5Cbeta,%20%5Csigma%5E%7B2%7D)%5C%5C%0A&amp;=%20(2%5Cpi%20%5Csigma%5E%7B2%7D)%5E%7B-n/2%7D%20%5Cmathrm%7Bexp%7D%5Cbig(-%5Cfrac%7B1%7D%7B2%5Csigma%5E%7B2%7D%7D%20%5Csum_%7Bi=1%7D%5E%7Bn%7D(y_%7Bi%7D%20-%20%5Cbeta%5E%7BT%7Dx_%7Bi%7D)%5E%7B2%7D%5Cbig).%0A%5Cend%7Balign*%7D%0A"></p>
<p>Alternatively, the joint PDF can be represented in terms of the multivariate normal distribution. Let <img src="https://latex.codecogs.com/png.latex?y"> be the n-dimensional response vector, and <img src="https://latex.codecogs.com/png.latex?X"> the <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20p"> design matrix whose <img src="https://latex.codecogs.com/png.latex?i%5E%7Bth%7D"> row is <img src="https://latex.codecogs.com/png.latex?x_%7Bi%7D">. We have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ay%7CX,%5Cbeta,%20%5Csigma%5E%7B2%7D%20%5Csim%20%5Cmathrm%7BMVN%7D(X%5Cbeta,%20%5Csigma%5E%7B2%7D%20%5Cmathrm%7BI%7D)%0A"></p>
<p>Where <img src="https://latex.codecogs.com/png.latex?I"> represents the <img src="https://latex.codecogs.com/png.latex?p%20%5Ctimes%20p"> identity matrix.</p>
<p>The density depends on <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> through the residuals. Given the observed data, the term in the exponent <img src="https://latex.codecogs.com/png.latex?(y_%7Bi%7D%20-%20%5Cbeta%5E%7BT%7Dx_%7Bi%7D)"> is maximized when the sum of squared residuals, <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7BSSR%7D%20=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(y_%7Bi%7D%20-%20%5Cbeta%5E%7BT%7Dx_%7Bi%7D)"> is minimized. To find the optimal <img src="https://latex.codecogs.com/png.latex?%5Cbeta">, we expand the expression for the residual sum of squares:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0A%5Cmathrm%7BSSR%7D%20&amp;=%20%5Csum_%7Bi=1%7D%5E%7Bn%7D%20(y_%7Bi%7D%20-%20%5Cbeta%5E%7BT%7Dx_%7Bi%7D)%5C%5C%0A&amp;=(y%20-%20X%5Cbeta)%5E%7BT%7D(y%20-%20X%5Cbeta)%5C%5C%0A&amp;=y%5E%7BT%7Dy%20-%202%5Cbeta%5E%7BT%7DX%5E%7BT%7Dy%20+%20%5Cbeta%5E%7BT%7DX%5E%7BT%7DX%5Cbeta.%0A%5Cend%7Balign*%7D%0A"></p>
<p>Computing the first derivative of the last expression above w.r.t. <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> and setting equal to 0 yields <img src="https://latex.codecogs.com/png.latex?-2X%5E%7BT%7Dy%20+%202X%7BT%7DX%5Cbeta%20=%200">, which can be rearranged to obtain the familiar expression for the ordinary least squares solution:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbeta%20=%20(X%5E%7BT%7DX)%5E%7B-1%7DX%5E%7BT%7Dy.%0A"></p>
<p>Why isn’t this expression implemented in linear model solvers directly?</p>
<p>The condition number of a matrix is the ratio of maximum-to-minimum singular values (which, for a normal matrix, is the ratio of the maximum-to-minimum absolute value of eigenvalues). Essentially, the condition number tells you how much solving a linear system will magnify any noise in your data. It can be thought of as a measure of amplification. The smaller the condition number, the better (the best value being 1).</p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Demonstrating the equivalence of computing the condition</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">number as the ratio of maximum-to-minimum singular values</span></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">and using np.linalg.cond, as well as a comparison of the </span></span>
<span id="cb1-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">condition numbers for X vs. X^T*X. </span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-7"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb1-8">rng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.default_rng(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.normal(size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>))</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SVD for X. </span></span>
<span id="cb1-13">U0, S0, Vt0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.svd(X, full_matrices<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-14">c0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.cond(X, p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb1-15"></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SVD for X^T*X. </span></span>
<span id="cb1-17">U1, S1, Vt1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.svd(X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X, full_matrices<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-18">c1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.cond(X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X, p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>)</span>
<span id="cb1-19"></span>
<span id="cb1-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S0 and S1 represent the singular values of X and X^T*X.</span></span>
<span id="cb1-21"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"S0.max() / S0.min()       : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>S0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> S0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.8f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb1-22"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Condition number of X     : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>c0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.8f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb1-23"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"S1.max() / S1.min()       : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>S1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">max</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> S1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">min</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.8f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb1-24"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Condition number of X^T*X : </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>c1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.8f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">."</span>)</span>
<span id="cb1-25"></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>S0.max() / S0.min()       : 2.44498390.
Condition number of X     : 2.44498390.
S1.max() / S1.min()       : 5.97794628.
Condition number of X^T*X : 5.97794628.</code></pre>
</div>
</div>
<p>In terms of numerical precision, computing <img src="https://latex.codecogs.com/png.latex?X%5E%7BT%7DX"> roughly squares the condition number. As an approximation, <img src="https://latex.codecogs.com/png.latex?%5Cmathrm%7Blog%7D_%7B10%7D(%5Cmathrm%7Bcondition%7D)"> represents the number of digits lost in a given matrix computation. So by merely forming the Gram matrix, we’ve doubled the loss of precision in our final result, since</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmathrm%7Blog%7D_%7B10%7D(%5Cmathrm%7Bcondition%7D(X%5E%7BT%7DX))%20%5Capprox%202%20%5Ctimes%20%5Cmathrm%7Blog%7D_%7B10%7D(%5Cmathrm%7Bcondition%7D(X)).%0A"></p>
<p>If the condition number of <img src="https://latex.codecogs.com/png.latex?X"> is small, forming the Gram matrix and solving the system via <img src="https://latex.codecogs.com/png.latex?%5Cbeta%20=%20(X%5E%7BT%7DX)%5E%7B-1%7DX%5E%7BT%7Dy"> should be fine. But as the condition number grows, solving the normal equations becomes increasingly unstable, ultimately resulting in a solution devoid of accuracy. Since statistical software packages need to handle an incredible variety of potential design matrices with a wide range of condition numbers, the normal equations approach cannot be relied upon.</p>
<section id="the-qr-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="the-qr-decomposition">The QR Decomposition</h3>
<p>The QR Decomposition factors a matrix <img src="https://latex.codecogs.com/png.latex?X"> into the product of an orthonormal matrix <img src="https://latex.codecogs.com/png.latex?Q"> and an upper triangular matrix <img src="https://latex.codecogs.com/png.latex?R">, <img src="https://latex.codecogs.com/png.latex?X%20=%20QR">. Because <img src="https://latex.codecogs.com/png.latex?Q"> is orthonormal, <img src="https://latex.codecogs.com/png.latex?Q%5E%7BT%7D%20=%20Q%5E%7B-1%7D">. Beginning with a version of the normal equations solution, substitute <img src="https://latex.codecogs.com/png.latex?QR"> for <img src="https://latex.codecogs.com/png.latex?X">, rearrange and arrive at:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AX%5E%7BT%7DX%20%5Cbeta%20&amp;=%20X%5E%7BT%7Dy%5C%5C%0A(QR)%5E%7BT%7D(QR)%20%5Cbeta%20&amp;=%20(QR)%5E%7BT%7Dy%5C%5C%0AR%5E%7BT%7D(Q%5E%7BT%7DQ)R%20%5Cbeta%20&amp;=%20R%5E%7BT%7D%20Q%5E%7BT%7D%20y%5C%5C%0AR%5E%7BT%7DR%20%5Cbeta%20&amp;=%20R%5E%7BT%7D%20Q%5E%7BT%7D%20y%5C%5C%0A(R%5E%7BT%7D)%5E%7B-1%7D%20R%5E%7BT%7D%20R%20%5Cbeta%20&amp;=%20(R%5E%7BT%7D)%5E%7B-1%7D%20R%5E%7BT%7D%20Q%5E%7BT%7D%20y%5C%5C%0AR%20%5Cbeta%20&amp;=%20Q%5E%7BT%7D%20y,%0A%5Cend%7Balign*%7D%0A"></p>
<p>where we’ve taken advantage of how transpose distributes over matrix products (i.e.&nbsp;<img src="https://latex.codecogs.com/png.latex?(AB)%5E%7BT%7D%20=%20B%5E%7BT%7DA%5E%7BT%7D">), and the fact that since <img src="https://latex.codecogs.com/png.latex?Q"> is orthonormal, <img src="https://latex.codecogs.com/png.latex?Q%5E%7BT%7DQ%20=%20I">.</p>
<p>Because <img src="https://latex.codecogs.com/png.latex?R"> is upper triangular, <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> can be solved for using back substitution. A quick demonstration of how this can be accomplished with Scipy:</p>
<div id="cell-4" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Solving for regression coefficients using normal equations and QR decomposition. </span></span>
<span id="cb3-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb3-4"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> scipy.linalg <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> solve_triangular</span>
<span id="cb3-5">rng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.default_rng(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb3-6"></span>
<span id="cb3-7">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.normal(size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb3-8">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.normal(scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normal equations solution.</span></span>
<span id="cb3-11">B0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.inv(X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> y</span>
<span id="cb3-12"></span>
<span id="cb3-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># QR Decomposition solution.</span></span>
<span id="cb3-14">Q, R <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.qr(X, mode<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"reduced"</span>)</span>
<span id="cb3-15">B1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> solve_triangular(R, Q.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> y)</span>
<span id="cb3-16"></span>
<span id="cb3-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"B0: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>B0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"B1: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>B1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb3-19"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"np.allclose(B0, B1): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>allclose(B0, B1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>B0: [ 0.42402765 -1.21951527  0.22396056  0.26773935 -0.72067314]
B1: [ 0.42402765 -1.21951527  0.22396056  0.26773935 -0.72067314]
np.allclose(B0, B1): True</code></pre>
</div>
</div>
<p>Using the QR Decomposition, we’ve eliminated the need to explicitly create the Gram matrix, and no longer need to invert matrices, which is computationally expensive and has its own set of precision degradation issues.</p>
</section>
<section id="the-singular-value-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="the-singular-value-decomposition">The Singular Value Decomposition</h3>
<p>The Singular Value Decomposition is a generalization of the Eigendecomposition to any <img src="https://latex.codecogs.com/png.latex?nxp"> matrix. The SVD decomposes a matrix <img src="https://latex.codecogs.com/png.latex?A"> into 3 matrices (<img src="https://latex.codecogs.com/png.latex?A%20=%20U%20%5CSigma%20V%5E%7BT%7D">):</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?U"> is a <img src="https://latex.codecogs.com/png.latex?n%20%5Ctimes%20p"> orthogonal matrix (assuming <img src="https://latex.codecogs.com/png.latex?A"> is real); columns represent <em>left singular vectors</em>.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5CSigma"> is a <img src="https://latex.codecogs.com/png.latex?p%20%5Ctimes%20p"> diagonal matrix with diagonal entries representing the <em>singular values</em> of <img src="https://latex.codecogs.com/png.latex?A">.</li>
<li><img src="https://latex.codecogs.com/png.latex?V%5E%7BT%7D"> is a <img src="https://latex.codecogs.com/png.latex?p%20%5Ctimes%20p"> orthogonal matrix (assuming <img src="https://latex.codecogs.com/png.latex?A"> is real); rows represent <em>right singular vectors</em>.</li>
</ul>
<p>Beginning with the normal equations solution, replace <img src="https://latex.codecogs.com/png.latex?X"> with <img src="https://latex.codecogs.com/png.latex?U%20%5CSigma%20V%5E%7BT%7D"> and solve for <img src="https://latex.codecogs.com/png.latex?%5Cbeta">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0AX%5E%7BT%7DX%20%5Cbeta%20&amp;=%20X%5E%7BT%7Dy%5C%5C%0A(U%20%5CSigma%20V%5E%7BT%7D)%5E%7BT%7DU%20%5CSigma%20V%5E%7BT%7D%5Cbeta%20&amp;=%20(U%20%5CSigma%20V%5E%7BT%7D)%5E%7BT%7Dy%5C%5C%0AV%20%5CSigma%5E%7BT%7D%20U%5E%7BT%7D%20U%20%5CSigma%20V%5E%7BT%7D%20%5Cbeta%20&amp;=%20V%20%5CSigma%20U%5E%7BT%7D%20y%5C%5C%0AV%20%5CSigma%5E%7BT%7D%20%5CSigma%20V%5E%7BT%7D%20%5Cbeta%20&amp;=V%20%5CSigma%20U%5E%7BT%7D%20y%5C%5C%0AV%20V%5E%7BT%7D%20%5Cbeta%20&amp;=%20V%20%5CSigma%5E%7B-1%7D%20U%5E%7BT%7D%20y%5C%5C%0A%5Cbeta%20&amp;=%20V%20%5CSigma%5E%7B-1%7D%20U%5E%7BT%7D%20y%0A%5Cend%7Balign*%7D%0A"></p>
<p>Since <img src="https://latex.codecogs.com/png.latex?%5CSigma"> is a diagonal matrix, the inverse is simply the reciprocal of the diagonal elements, which doesn’t incur the runtime associated with a conventional matrix inversion. In addition, <img src="https://latex.codecogs.com/png.latex?VV%5E%7BT%7D%20=%20I">. Note that we assume the singular values are strictly greater than 0. If this is not the case, the condition number would be infinite, and a well-defined solution wouldn’t exist.</p>
<p>Determining the estimated coefficients using SVD can be accomplished as follows:</p>
<div id="cell-7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"></span>
<span id="cb5-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Solving for regression coefficients using normal equations and SVD. </span></span>
<span id="cb5-3"><span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> numpy <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> np</span>
<span id="cb5-4">rng <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.random.default_rng(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">516</span>)</span>
<span id="cb5-5"></span>
<span id="cb5-6">X <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.normal(size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>))</span>
<span id="cb5-7">y <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> rng.normal(scale<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb5-8"></span>
<span id="cb5-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Normal equations solution.</span></span>
<span id="cb5-10">B0 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.inv(X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> X.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> y</span>
<span id="cb5-11"></span>
<span id="cb5-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># SVD solution.</span></span>
<span id="cb5-13">U, S, Vt <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.linalg.svd(X, full_matrices<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb5-14">B1 <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Vt.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> np.diag(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> S) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> U.T <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span> y</span>
<span id="cb5-15"></span>
<span id="cb5-16"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"B0: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>B0<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-17"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"B1: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>B1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb5-18"><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"np.allclose(B0, B1): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>np<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span>allclose(B0, B1)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>B0: [ 0.42402765 -1.21951527  0.22396056  0.26773935 -0.72067314]
B1: [ 0.42402765 -1.21951527  0.22396056  0.26773935 -0.72067314]
np.allclose(B0, B1): True</code></pre>
</div>
</div>
<p>Each of these methods (normal equations, QR Decomposition, SVD) incur different computational cost. From Golub &amp; Van Loan, the flop count associated with each algorithm is presented below:</p>
<pre><code>-------------------------------------------
Normal Equations       |  mn^2 + n^3 / 3  |
-------------------------------------------
Householder QR         |  n^3 / 3         |
-------------------------------------------
Modified Gram-Schmidt  |  2mn^2           |
-------------------------------------------
SVD                    |  2mn^2 + 11n^3   |
-------------------------------------------</code></pre>
<p>Householder and Modified Gram-Schmidt are two approaches used in the first step of the QR Decomposition. SVD offers far more stability, but comes with added runtime complexity. Other matrix decomposition methods such as LU and Cholesky can be leveraged, but the QR Decomposition represents a good trade-off between runtime and numerical stability. This explains its wide use in statistical software packages. Check out <a href="http://madrury.github.io/jekyll/update/statistics/2016/07/20/lm-in-R.html">A Deep Dive into how R Fits a Linear Model</a> for an in-depth explanation of how the QR Decomposition is used to fit linear models in R.</p>


</section>

 ]]></description>
  <category>Statistical Modeling</category>
  <category>Python</category>
  <guid>https://www.jtrive.com/posts/mat-fact-lin-reg/mat-fact-lin-reg.html</guid>
  <pubDate>Thu, 01 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>Derivation of the Poisson Distribution as a Limiting Case of the Binomial PDF</title>
  <link>https://www.jtrive.com/posts/poisson-binomial/poisson-binomial.html</link>
  <description><![CDATA[ 





<p>The Poisson distribution is a discrete probability distribution with identical mean and variance that expresses the probability of a given number of events occurring in a fixed interval of time. In this post, we derive the Poisson probability mass function beginning with the Binomial PDF.</p>
<p>The binomial distribution represents the number of successes, <img src="https://latex.codecogs.com/png.latex?k"> in <img src="https://latex.codecogs.com/png.latex?n"> independent Bernoulli trials, where the probability of success <img src="https://latex.codecogs.com/png.latex?p"> for any given trial is <img src="https://latex.codecogs.com/png.latex?0%20%5Cleq%20p%20%5Cleq%201">. Formally, the binomial PDF is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(k;%20p,%20n)%20=%20%5Cbinom%7Bn%7D%7Bk%7Dp%5E%7Bk%7D(1-p)%5E%7Bn-k%7D,%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cbinom%7Bn%7D%7Bk%7D"> represents the binomial coefficient, which equates to</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbinom%7Bn%7D%7Bk%7D%20=%20%5Cfrac%7Bn!%7D%7Bn!(n-k)!%7D.%0A"></p>
<p>The expanded binomial PDF then appears as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(k;%20p,%20n)%20=%20%5Cfrac%7Bn!%7D%7Bn!(n-k)!%7Dp%5E%7Bk%7D(1-p)%5E%7Bn-k%7D.%0A"></p>
<p>The mean of the binomial distribution is</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmu%20=%20%5Clambda%20=%20np,%0A"></p>
<p>which can be rearranged in terms of <img src="https://latex.codecogs.com/png.latex?p"> yielding</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap%20=%20%5Cfrac%7B%5Clambda%7D%7Bn%7D.%0A"></p>
<p>Substituting this expression for <img src="https://latex.codecogs.com/png.latex?p"> into the binomial PDF results in</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(k;%20p,%20n)%20=%20%5Cfrac%7Bn!%7D%7Bn!(n-k)!%7D%5CBig(%5Cfrac%7B%5Clambda%7D%7Bn%7D%5CBig)%5E%7Bk%7D%5CBig(1-%5Cfrac%7B%5Clambda%7D%7Bn%7D%5CBig)%5E%7Bn-k%7D%0A"></p>
<p>If we let <img src="https://latex.codecogs.com/png.latex?n"> grow very large and <img src="https://latex.codecogs.com/png.latex?p"> grow very small, after a bit of re-expression we can formulate the binomial distribution as</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Clim_%7Bn%5Cto%5Cinfty%20,%20p%20%5Cto%200%7D%20f(k;%20p,%20n)%20=%20%5Cfrac%7Bn(n-1)%20%5Ccdots%20(n-k+1)%7D%7Bk!%7D%20%5Cfrac%7B%5Clambda%5E%7Bk%7D%7D%7Bn%5E%7Bk%7D%7D%20%5CBig(1-%5Cfrac%7B%5Clambda%7D%7Bn%7D%5CBig)%5E%7Bn%7D%20%5CBig(1-%5Cfrac%7B%5Clambda%7D%7Bn%7D%5CBig)%5E%7B-k%7D.%0A"></p>
<p>Swapping denominator terms yields</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A=%20%5Cfrac%7Bn(n-1)%20%5Ccdots%20(n-k+1)%7D%7Bn%5E%7Bk%7D%7D%20%5Cfrac%7B%5Clambda%5E%7Bk%7D%7D%7Bk!%7D%20%5CBig(1-%5Cfrac%7B%5Clambda%7D%7Bn%7D%5CBig)%5E%7Bn%7D%20%5CBig(1-%5Cfrac%7B%5Clambda%7D%7Bn%7D%5CBig)%5E%7B-k%7D%0A"></p>
<p>Recall from calculus that <img src="https://latex.codecogs.com/png.latex?e%20=%20%5Clim_%7Bk%5Cto%5Cinfty%7D%20(1%20+%201/k)%5E%7Bk%7D"> and similarly <img src="https://latex.codecogs.com/png.latex?e%5E%7Bx%7D%20=%20%5Clim_%7Bk%5Cto%5Cinfty%7D%20(1%20+%20x/k)%5E%7Bk%7D">. Leveraging these identities, <img src="https://latex.codecogs.com/png.latex?(1%20-%20%5Cfrac%7B%5Clambda%7D%7Bn%7D)%5E%7Bn%7D"> becomes <img src="https://latex.codecogs.com/png.latex?e%5E%7B-%5Clambda%7D"> in the limit. With very large <img src="https://latex.codecogs.com/png.latex?n">, the expression for the PDF reduces to</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Clim_%7Bn%5Cto%5Cinfty%7D%20f(k;%20p,%20n)%20=%20(1)%20%5CBig(%20%5Cfrac%7B%5Clambda%5E%7Bk%7D%7D%7Bk!%7D%5CBig)(e%5E%7B-%5Clambda%7D)(1).%0A"></p>
<p>After a little cleanup, we obtain the familiar expression for the Poisson density with mean <img src="https://latex.codecogs.com/png.latex?%5Clambda">:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Af(k;%20%5Clambda)%20%20=%20%5Cfrac%7B%5Clambda%5E%7Bk%7D%7D%7Bk!%7De%5E%7B-%5Clambda%7D%20%5Chspace%7B1cm%7D%20k%20%5Cin%200,%201,%202,%20%5Ccdots.%0A"></p>
<p>An interesting property of the Poisson distribution (as well as the binomial and negative binomial distributions) is that successive probabilities can be found recursively. The recurrence relation is given by</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cfrac%7Bp_%7Bk%7D%7D%7Bp_%7Bk-1%7D%7D%20=%20a%20+%5Cfrac%7Bb%7D%7Bk%7D,%20%5Chspace%7B2mm%7D%20k%20=%202,3,4,%20%5Ccdots,%0A"></p>
<p>where in the case of the Poisson distribution, <img src="https://latex.codecogs.com/png.latex?a=0"> and <img src="https://latex.codecogs.com/png.latex?b=%5Clambda">, resulting in</p>
<p><img src="https://latex.codecogs.com/png.latex?%0Ap_%7Bk%7D%20=%20%5Cfrac%7B%5Clambda%7D%7Bk%7Dp_%7Bk-1%7D,%20%5Chspace%7B2mm%7D%20k%20=%201,2,3,%20%5Ccdots.%0A"></p>
<p>To demonstrate, for a system approximated by a Poisson distribution with <img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%203">, the probabilities for <img src="https://latex.codecogs.com/png.latex?0%20%5Cleq%20k%20%5Cleq%206"> are:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ap_%7B0%7D%20&amp;=%20.049787068%20%5C%5C%0Ap_%7B1%7D%20&amp;=%20.149361205%20%5C%5C%0Ap_%7B2%7D%20&amp;=%20.224041808%20%5C%5C%0Ap_%7B3%7D%20&amp;=%20.224041808%20%5C%5C%0Ap_%7B4%7D%20&amp;=%20.168031356%20%5C%5C%0Ap_%7B5%7D%20&amp;=%20.100818813%20%5C%5C%0Ap_%7B6%7D%20&amp;=%20.050409407.%0A%5Cend%7Balign*%7D%0A"></p>
<p>To use the recurrence relation, we first calculate <img src="https://latex.codecogs.com/png.latex?p_0"> as above. Then:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Balign*%7D%0Ap_%7B0%7D%20&amp;=.049787068%20%5C%5C%0Ap_%7B1%7D%20&amp;=p_%7B0%7D%5Cfrac%7B%5Clambda%7D%7Bk%7D%20=.049787068*%5Cfrac%7B3%7D%7B1%7D=.149361205%20%20%5C%5C%0Ap_%7B2%7D%20&amp;=p_%7B1%7D%5Cfrac%7B%5Clambda%7D%7Bk%7D%20=.149361205*%5Cfrac%7B3%7D%7B2%7D=.224041808%20%20%5C%5C%0Ap_%7B3%7D%20&amp;=p_%7B2%7D%5Cfrac%7B%5Clambda%7D%7Bk%7D%20=.224041808*%5Cfrac%7B3%7D%7B3%7D=.224041808%20%20%5C%5C%0Ap_%7B4%7D%20&amp;=p_%7B3%7D%5Cfrac%7B%5Clambda%7D%7Bk%7D%20=.224041808*%5Cfrac%7B3%7D%7B4%7D=.168031356%20%20%5C%5C%0Ap_%7B5%7D%20&amp;=p_%7B4%7D%5Cfrac%7B%5Clambda%7D%7Bk%7D%20=.168031356*%5Cfrac%7B3%7D%7B5%7D=.100818813%20%20%5C%5C%0Ap_%7B6%7D%20&amp;=p_%7B5%7D%5Cfrac%7B%5Clambda%7D%7Bk%7D%20=.100818813*%5Cfrac%7B3%7D%7B6%7D=.050409407,%0A%5Cend%7Balign*%7D%0A"></p>
<p>which are identical to the probabilities obtained from evaluating the Poisson PDF directly.</p>



 ]]></description>
  <category>Statistical Modeling</category>
  <guid>https://www.jtrive.com/posts/poisson-binomial/poisson-binomial.html</guid>
  <pubDate>Thu, 01 Feb 2024 06:00:00 GMT</pubDate>
</item>
<item>
  <title>The Buried Assumption in Constant Dispersion Tweedie Models</title>
  <link>https://www.jtrive.com/posts/tweedie-dispersion/tweedie-dispersion.html</link>
  <description><![CDATA[ 





<p>Instead of building separate models for claim frequency and claim severity, the Tweedie distribution can be used to model pure premium directly. The Tweedie family of distributions are Exponential Dispersion Models with variance function <img src="https://latex.codecogs.com/png.latex?V(%5Cmu)%20=%20%5Cmu%5E%7Bp%7D"> where <img src="https://latex.codecogs.com/png.latex?1%20%5Clt%20p%20%5Clt%202">.</p>
<p>However, the Tweedie distribution has an important limitation: Buried in the model parameterization is the assumption of positive correlation between claim frequency and severity. Put another way, as commonly implemented within various GLM frameworks, the Tweedie distribution assumes that each covariate impacts frequency and severity in the same direction.</p>
<p>Tweedie is a compund Poisson-gamma process, where claim frequency is assumed to follow Poisson distribution and claim severity assumed to follow a gamma distribution (conditional on the occurrence of a claim). In the original <a href="https://www.casact.org/sites/default/files/old/astin_vol32no1_143.pdf">Smyth and Jorgensen paper</a>, the Tweedie distribution is parameterized as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cmu%20=%20%5Clambda%20%5Ccdot%20%5Calpha%20%5Ccdot%20%5Ctheta;%20%5Chspace%7B.75em%7D%20p%20=%20%5Cfrac%7B%5Calpha%20+%202%7D%7B%5Calpha%20+%201%7D;%20%5Chspace%7B.75em%7D%20%5Cphi%20=%20%5Cfrac%7B%5Clambda%5E%7B1%20-%20p%7D%20%5Ccdot%20(%5Calpha%20%5Ccdot%20%5Ctheta)%5E%7B2%20-%20p%7D%7D%7B2%20-%20p%7D%0A"></p>
<p>Where:</p>
<ul>
<li><img src="https://latex.codecogs.com/png.latex?%5Clambda"> is the mean of the underlying Poisson distribution.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Calpha"> is the gamma distribution shape parameter.</li>
<li><img src="https://latex.codecogs.com/png.latex?%5Ctheta"> is the gamma distribution scale parameter.</li>
<li><img src="https://latex.codecogs.com/png.latex?p"> is constant across the dataset, specified by the user. Since <img src="https://latex.codecogs.com/png.latex?%5Calpha%20%5Cgt%200">, <img src="https://latex.codecogs.com/png.latex?1%20%5Clt%20p%20%5Clt%202">.</li>
</ul>
<p>Because <img src="https://latex.codecogs.com/png.latex?p"> is constant, we have:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cphi%20%5Csim%20%5Cfrac%7B(%5Calpha%20%5Ccdot%20%5Ctheta)%5E%7B2%20-%20p%7D%7D%7B%5Clambda%5E%7Bp-1%7D%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cphi"> is proportional to the mean severity raised to some positive power divided by the mean frequency raised to some positive power. If <img src="https://latex.codecogs.com/png.latex?%5Cphi"> is assumed to be constant across the dataset (as is the default assumption in many popular libraries such as scikit-learn and statsmodels), any factor that increases mean severity must also increase mean frequency. To ensure that <img src="https://latex.codecogs.com/png.latex?%5Cphi"> remains constant, mean frequency and mean severity must move in the same direction. However, the assumption that frequency and severity move in the same direction is often unrealistic. Think of how auto claims are usually distributed: A large number of low severity claims, along with fewer of high severity.</p>
<p>The Tweedie distribution can still be used in situations in which frequency and severity move in opposite directions, as long as <img src="https://latex.codecogs.com/png.latex?%5Cphi"> and <img src="https://latex.codecogs.com/png.latex?%5Cmu"> are modeled together. This is referred to as a double GLM, and is outlined in the Smyth and Jorgensen paper. If the dispersion parameter is allowed to vary across the dataset, the assumption of positive association between frequency and severity no longer applies.</p>
<p>Fitting a Tweedie double GLM can be accomplished as follows:</p>
<ol type="1">
<li><p>Using pure premium as the target, fit a Tweedie GLM for the mean. The weight is exposures divided by <img src="https://latex.codecogs.com/png.latex?%5Cphi">, where initially <img src="https://latex.codecogs.com/png.latex?%5Cphi%20=%201"> for all inputs.</p></li>
<li><p>Calculate the weighted deviance for each record. The sum of these unit deviances equals the total deviance for the initial model for the mean.</p></li>
<li><p>Fit a gamma GLM for dispersion. The target variable is the unit deviance with each record given equal weight. The predictions from this model represent the new per observation dispersion.</p></li>
<li><p>Re-fit the GLM for the mean from step 1., this time using the dispersion parameters obtained in step 3. The weight for this GLM is exposure divided by the new dispersion parameters.</p></li>
</ol>
<p>This is straightforward to implement, and is left as an exercise for the reader. For R users, the <a href="https://cran.r-project.org/web/packages/dglm/dglm.pdf">dglm package</a> is available.</p>
<p>I recall a few years back it wasn’t possible to set <code>p</code> to a variable when using the dglm package; <code>p</code> had to be hard-coded with a scalar value, which was inconvenient if you wanted to evaluate a number of Tweedie models with different <code>p</code>s in an iterative fashion. A work-around was proposed <a href="https://stackoverflow.com/questions/28810479/package-dglm-in-r">here</a>, but the package creator may have since incorporated the update into the codebase.</p>



 ]]></description>
  <category>Statistical Modeling</category>
  <category>Actuarial</category>
  <guid>https://www.jtrive.com/posts/tweedie-dispersion/tweedie-dispersion.html</guid>
  <pubDate>Thu, 01 Feb 2024 06:00:00 GMT</pubDate>
</item>
</channel>
</rss>
