<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-07-31">
<meta name="description" content="Four approaches to creating runoff triangles in R">

<title>Four Approaches to Creating Runoff Triangles in R – The Pleasure of Finding Things Out: A blog by James Triveri</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">The Pleasure of Finding Things Out: A blog by James Triveri</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jtrive84/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/jamestriveri/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://python-bloggers.com/"> <i class="bi bi-p-square" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Four Approaches to Creating Runoff Triangles in R</h1>
                  <div>
        <div class="description">
          Four approaches to creating runoff triangles in R
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">Statistical Modeling</div>
                <div class="quarto-category">Actuarial</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 31, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>The runoff triangle is a data structure familiar to both pricing and reserving actuaries commonly used to organize losses by date of occurrence (generally the vertical axis), and in the case of paid loss triangles, the date of payment (horizontal axis). In practice, triangles present losses in one of two states: Incremental loss triangles represent losses for a given accident period an a particular point in time. Cumulative loss triangles represent the cumulative losses to date up to and including the development period from which losses are evaluated.</p>
<p>The following article demonstrates four approaches that can be used to create runoff triangles in R: Using base R, foreach, data.table and the ChainLadder package. All examples reference a loss dataset made available by the Reinsurance Association of America, which can be downloaded <a href="https://gist.githubusercontent.com/jtrive84/976c80786a6e97cce7483e306562f85b/raw/06a5c8b1f823fbe2b6da15f90a672517fa5b4571/RAA.csv">here</a>. This is the same dataset identified as RAA in the ChainLadder package, the only difference being the above referenced dataset contains incremental (as opposed to cumulative) losses. The columns are:</p>
<ul>
<li><p><strong>ORIGIN</strong> The year in which the loss occurred.</p></li>
<li><p><strong>DEV</strong> The development period. In the case of paid losses, the number of periods (months, years, etc.) after the occurance that payment was made.</p></li>
<li><p><strong>VALUE</strong> In the case of paid losses, the paid loss amount (in dollars) for losses at each valid cell representing the intersection of <strong>ORIGIN</strong> and <strong>DEV</strong>.</p></li>
</ul>
<p><br></p>
<section id="method-i-base-r" class="level3">
<h3 class="anchored" data-anchor-id="method-i-base-r">Method I: Base R</h3>
<p>It is possible to convert transactional loss data into a triangle format without the use of 3rd-party libraries. The next example demonstrates one method:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loss Triangle Compilation in R: Method I.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>raaPath <span class="ot">=</span> <span class="st">"https://gist.githubusercontent.com/jtrive84/976c80786a6e97cce7483e306562f85b/raw/06a5c8b1f823fbe2b6da15f90a672517fa5b4571/RAA.csv"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">=</span> <span class="fu">read.table</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">file=</span>raaPath, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">row.names=</span><span class="cn">NULL</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>triData1 <span class="ot">=</span> <span class="fu">matrix</span>(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">nrow=</span><span class="fu">length</span>(<span class="fu">unique</span>(DF<span class="sc">$</span>ORIGIN)),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol=</span><span class="fu">length</span>(<span class="fu">unique</span>(DF<span class="sc">$</span>DEV)),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">dimnames=</span><span class="fu">list</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">ORIGIN=</span><span class="fu">sort</span>(<span class="fu">unique</span>(DF<span class="sc">$</span>ORIGIN)), <span class="at">DEV=</span><span class="fu">sort</span>(<span class="fu">unique</span>(DF<span class="sc">$</span>DEV))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>triData1[<span class="fu">cbind</span>(<span class="fu">factor</span>(DF<span class="sc">$</span>ORIGIN), DF<span class="sc">$</span>DEV)] <span class="ot">=</span> DF<span class="sc">$</span>VALUE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Inspecting <code>triData1</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData1</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ORIGIN    <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">3</span>    <span class="dv">4</span>    <span class="dv">5</span>    <span class="dv">6</span>    <span class="dv">7</span>   <span class="dv">8</span>   <span class="dv">9</span>  <span class="dv">10</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span> <span class="dv">5012</span> <span class="dv">3257</span> <span class="dv">2638</span>  <span class="dv">898</span> <span class="dv">1734</span> <span class="dv">2642</span> <span class="dv">1828</span> <span class="dv">599</span>  <span class="dv">54</span> <span class="dv">172</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">106</span> <span class="dv">4179</span> <span class="dv">1111</span> <span class="dv">5270</span> <span class="dv">3116</span> <span class="dv">1817</span> <span class="sc">-</span><span class="dv">103</span> <span class="dv">673</span> <span class="dv">535</span>  <span class="cn">NA</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span> <span class="dv">3410</span> <span class="dv">5582</span> <span class="dv">4881</span> <span class="dv">2268</span> <span class="dv">2594</span> <span class="dv">3479</span>  <span class="dv">649</span> <span class="dv">603</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">5655</span> <span class="dv">5900</span> <span class="dv">4211</span> <span class="dv">5500</span> <span class="dv">2159</span> <span class="dv">2658</span>  <span class="dv">984</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">1092</span> <span class="dv">8473</span> <span class="dv">6271</span> <span class="dv">6333</span> <span class="dv">3786</span>  <span class="dv">225</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">1513</span> <span class="dv">4932</span> <span class="dv">5257</span> <span class="dv">1233</span> <span class="dv">2917</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span>  <span class="dv">557</span> <span class="dv">3463</span> <span class="dv">6926</span> <span class="dv">1368</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">1351</span> <span class="dv">5596</span> <span class="dv">6165</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">3133</span> <span class="dv">2262</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">2063</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>The base R method returns the triangle as a matrix of incremental losses. A triangle of cumulative losses can be obtained by running:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData1c <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">apply</span>(<span class="fu">apply</span>(triData1, <span class="dv">2</span>, cumsum), <span class="dv">1</span>, cumsum))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData1c</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>ORIGIN     <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">3</span>      <span class="dv">4</span>      <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span>     <span class="dv">8</span>     <span class="dv">9</span>    <span class="dv">10</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span>  <span class="dv">5012</span>  <span class="dv">8269</span> <span class="dv">10907</span>  <span class="dv">11805</span>  <span class="dv">13539</span>  <span class="dv">16181</span> <span class="dv">18009</span> <span class="dv">18608</span> <span class="dv">18662</span> <span class="dv">18834</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">5118</span> <span class="dv">12554</span> <span class="dv">16303</span>  <span class="dv">22471</span>  <span class="dv">27321</span>  <span class="dv">31780</span> <span class="dv">33505</span> <span class="dv">34777</span> <span class="dv">35366</span>    <span class="cn">NA</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span>  <span class="dv">8528</span> <span class="dv">21546</span> <span class="dv">30176</span>  <span class="dv">38612</span>  <span class="dv">46056</span>  <span class="dv">53994</span> <span class="dv">56368</span> <span class="dv">58243</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">14183</span> <span class="dv">33101</span> <span class="dv">45942</span>  <span class="dv">59878</span>  <span class="dv">69481</span>  <span class="dv">80077</span> <span class="dv">83435</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">15275</span> <span class="dv">42666</span> <span class="dv">61778</span>  <span class="dv">82047</span>  <span class="dv">95436</span> <span class="dv">106257</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">16788</span> <span class="dv">49111</span> <span class="dv">73480</span>  <span class="dv">94982</span> <span class="dv">111288</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span> <span class="dv">17345</span> <span class="dv">53131</span> <span class="dv">84426</span> <span class="dv">107296</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">18696</span> <span class="dv">60078</span> <span class="dv">97538</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">21829</span> <span class="dv">65473</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">23892</span>    <span class="cn">NA</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
</section>
<section id="method-ii-using-foreach-data.table" class="level2">
<h2 class="anchored" data-anchor-id="method-ii-using-foreach-data.table">Method II: Using foreach + data.table</h2>
<p>The foreach package provides a looping construct for executing R code repeatedly. It is especially useful in developing platform-independent applications that distribute tasks across multiple cores. data.table facilitates fast aggregation of large datasets, fast ordered joins and fast add/modify/delete of columns by group using no copies. In this example, we use foreach along with data.table’s <code>rbindlist</code> function to create a triangle of incremental losses:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loss Triangle Compilation in R: Method II.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"data.table"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"foreach"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">=</span> <span class="fu">fread</span>(<span class="at">file=</span>raaPath, <span class="at">sep=</span><span class="st">","</span>, <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>lossList <span class="ot">=</span> <span class="fu">split</span>(DF, <span class="at">by=</span><span class="st">"ORIGIN"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>triData2 <span class="ot">=</span> <span class="fu">foreach</span>(</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lossList), </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.final=</span><span class="cf">function</span>(ll) <span class="fu">rbindlist</span>(ll, <span class="at">fill=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%do%</span> {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    iterList <span class="ot">=</span> <span class="fu">setNames</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.list</span>(lossList[[i]]<span class="sc">$</span>VALUE),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">nm=</span><span class="fu">as.character</span>(lossList[[i]]<span class="sc">$</span>DEV)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">append</span>(<span class="fu">list</span>(<span class="at">ORIGIN=</span><span class="fu">names</span>(lossList)[i]), iterList)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Inspecting <code>triData2</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> print triData2</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ORIGIN    <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">3</span>    <span class="dv">4</span>    <span class="dv">5</span>    <span class="dv">6</span>    <span class="dv">7</span>   <span class="dv">8</span>   <span class="dv">9</span>  <span class="dv">10</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span> <span class="dv">5012</span> <span class="dv">3257</span> <span class="dv">2638</span>  <span class="dv">898</span> <span class="dv">1734</span> <span class="dv">2642</span> <span class="dv">1828</span> <span class="dv">599</span>  <span class="dv">54</span> <span class="dv">172</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">106</span> <span class="dv">4179</span> <span class="dv">1111</span> <span class="dv">5270</span> <span class="dv">3116</span> <span class="dv">1817</span> <span class="sc">-</span><span class="dv">103</span> <span class="dv">673</span> <span class="dv">535</span>  <span class="cn">NA</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span> <span class="dv">3410</span> <span class="dv">5582</span> <span class="dv">4881</span> <span class="dv">2268</span> <span class="dv">2594</span> <span class="dv">3479</span>  <span class="dv">649</span> <span class="dv">603</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">5655</span> <span class="dv">5900</span> <span class="dv">4211</span> <span class="dv">5500</span> <span class="dv">2159</span> <span class="dv">2658</span>  <span class="dv">984</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">1092</span> <span class="dv">8473</span> <span class="dv">6271</span> <span class="dv">6333</span> <span class="dv">3786</span>  <span class="dv">225</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">1513</span> <span class="dv">4932</span> <span class="dv">5257</span> <span class="dv">1233</span> <span class="dv">2917</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span>  <span class="dv">557</span> <span class="dv">3463</span> <span class="dv">6926</span> <span class="dv">1368</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">1351</span> <span class="dv">5596</span> <span class="dv">6165</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">3133</span> <span class="dv">2262</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">2063</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>In method II, the transactional loss data is first split into a list of data.tables by common ORIGIN which was then bound to <code>lossList</code>. The foreach constructor then iterates over <code>lossList</code>, transforming each data.table into what amounts to a single row in the incremental triangle. Notice that within the foreach constructor, the <code>.final</code> parameter is set to a function: When specified, <code>.final</code> represents a function of one argument that is called to return the final result. data.table’s <code>rbindlist</code> takes as input a list of data.tables/data.frames and concatenates them horizontally, returning a single data.table.</p>
<p>When the resulting triangle of incremental losses is returned as a data.table/data.frame, we can generate the cumulative loss triangle as follows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> devDF <span class="ot">=</span> triData2[,<span class="sc">-</span><span class="fu">c</span>(<span class="st">"ORIGIN"</span>)]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> devDF[,<span class="fu">names</span>(devDF)<span class="sc">:</span><span class="er">=</span><span class="fu">Reduce</span>(<span class="st">`</span><span class="at">+</span><span class="st">`</span>, devDF, <span class="at">accumulate=</span><span class="cn">TRUE</span>)]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData2c <span class="ot">=</span> <span class="fu">cbind</span>(triData2[, .(ORIGIN)], devDF)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData2c</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>ORIGIN     <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">3</span>      <span class="dv">4</span>      <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span>     <span class="dv">8</span>     <span class="dv">9</span>    <span class="dv">10</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span>  <span class="dv">5012</span>  <span class="dv">8269</span> <span class="dv">10907</span>  <span class="dv">11805</span>  <span class="dv">13539</span>  <span class="dv">16181</span> <span class="dv">18009</span> <span class="dv">18608</span> <span class="dv">18662</span> <span class="dv">18834</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">5118</span> <span class="dv">12554</span> <span class="dv">16303</span>  <span class="dv">22471</span>  <span class="dv">27321</span>  <span class="dv">31780</span> <span class="dv">33505</span> <span class="dv">34777</span> <span class="dv">35366</span>    <span class="cn">NA</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span>  <span class="dv">8528</span> <span class="dv">21546</span> <span class="dv">30176</span>  <span class="dv">38612</span>  <span class="dv">46056</span>  <span class="dv">53994</span> <span class="dv">56368</span> <span class="dv">58243</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">14183</span> <span class="dv">33101</span> <span class="dv">45942</span>  <span class="dv">59878</span>  <span class="dv">69481</span>  <span class="dv">80077</span> <span class="dv">83435</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">15275</span> <span class="dv">42666</span> <span class="dv">61778</span>  <span class="dv">82047</span>  <span class="dv">95436</span> <span class="dv">106257</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">16788</span> <span class="dv">49111</span> <span class="dv">73480</span>  <span class="dv">94982</span> <span class="dv">111288</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span> <span class="dv">17345</span> <span class="dv">53131</span> <span class="dv">84426</span> <span class="dv">107296</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">18696</span> <span class="dv">60078</span> <span class="dv">97538</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">21829</span> <span class="dv">65473</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">23892</span>    <span class="cn">NA</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>First ORIGIN is removed from <code>triData2</code>, so that <code>devDF</code> consists only of the development period columns. Next <code>Reduce</code> is applied to all rows, specifying <code>accumulate=TRUE</code> so that a cumulative sum is calculated. Finally, ORIGIN is vertically concatenated back with the cumulated losses by development period and bound to <code>triData2c</code>.</p>
<p><br></p>
</section>
<section id="method-iii-data.table" class="level2">
<h2 class="anchored" data-anchor-id="method-iii-data.table">Method III: data.table</h2>
<p>data.table’s <code>dcast</code> function is a powerful and flexibile utility used primarily for reshaping datasets. Fieldnames are specified and used as column and row indicies in terms of a formula expression that follows the form <code>LHS ~ RHS</code>. For Method III, <code>dcast</code> is used to convert the transactional loss data into an incremental loss triangle:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loss Triangle Compilation in R: Method III.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"data.table"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">=</span> <span class="fu">fread</span>(<span class="at">file=</span>raaPath, <span class="at">sep=</span><span class="st">","</span>, <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>triData3 <span class="ot">=</span> <span class="fu">dcast</span>(DF, ORIGIN <span class="sc">~</span> DEV, <span class="at">value.var=</span><span class="st">"VALUE"</span>, <span class="at">fill=</span><span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>A description of the arguments passed to <code>dcast</code>:</p>
<ul>
<li><code>DF</code>: The data.table to transform into a runoff triangle.</li>
<li><code>ORIGIN ~ DEV</code>: A formulaic expression of the form <code>LHS ~ RHS</code> dictating how to transform <code>DF</code>. The argument on the LHS, in this example <code>ORIGIN</code>, represents the key in the resulting table. The RHS argument, in this example <code>DEV</code> represents the column whose levels become column names in the new table.</li>
<li><code>fun.aggregate=sum</code>: Although not required in this case, if our original data wasn’t aggregated by yyyy and dev, including this argument would perform the aggregation. In our example, this argument has no effect.</li>
<li><code>fill=NA</code>: Specifies how to populate missing values. Excluding values in cells intentionally removed to provide a more robust example, for a given <code>ORIGIN</code>, development periods in excess of <code>(1990 - ORIGIN + 1) * 12</code> represent future evaluation dates which should be set to <code>NA</code>.</li>
</ul>
<p><br></p>
<p>Inspecting triData3:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData3</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>ORIGIN    <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">3</span>    <span class="dv">4</span>    <span class="dv">5</span>    <span class="dv">6</span>    <span class="dv">7</span>   <span class="dv">8</span>   <span class="dv">9</span>  <span class="dv">10</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span> <span class="dv">5012</span> <span class="dv">3257</span> <span class="dv">2638</span>  <span class="dv">898</span> <span class="dv">1734</span> <span class="dv">2642</span> <span class="dv">1828</span> <span class="dv">599</span>  <span class="dv">54</span> <span class="dv">172</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">106</span> <span class="dv">4179</span> <span class="dv">1111</span> <span class="dv">5270</span> <span class="dv">3116</span> <span class="dv">1817</span> <span class="sc">-</span><span class="dv">103</span> <span class="dv">673</span> <span class="dv">535</span>  <span class="cn">NA</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span> <span class="dv">3410</span> <span class="dv">5582</span> <span class="dv">4881</span> <span class="dv">2268</span> <span class="dv">2594</span> <span class="dv">3479</span>  <span class="dv">649</span> <span class="dv">603</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">5655</span> <span class="dv">5900</span> <span class="dv">4211</span> <span class="dv">5500</span> <span class="dv">2159</span> <span class="dv">2658</span>  <span class="dv">984</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">1092</span> <span class="dv">8473</span> <span class="dv">6271</span> <span class="dv">6333</span> <span class="dv">3786</span>  <span class="dv">225</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">1513</span> <span class="dv">4932</span> <span class="dv">5257</span> <span class="dv">1233</span> <span class="dv">2917</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span>  <span class="dv">557</span> <span class="dv">3463</span> <span class="dv">6926</span> <span class="dv">1368</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">1351</span> <span class="dv">5596</span> <span class="dv">6165</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">3133</span> <span class="dv">2262</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">2063</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Since <code>dcast</code> returns a data.table, the approach demonstrated in Method II can be used to obtain a triangle of cumulative losses, and so it will not be repeated here. However, the data.table approach enables us to perform a task which is non-trivial to perform using the other methods as easily: Converting a loss triangle back into a dataset of transactional losses. This is accomplished with data.table’s <code>melt</code> function. In the next example, we convert <code>triData3</code> back into the original RAA dataset:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert a loss triangle back into transactional loss data.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assume triData3 exists and represents incremental loss </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># data compiled from RAA.csv.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"data.table"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>DF2 <span class="ot">=</span> data.table<span class="sc">::</span><span class="fu">melt</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    triData3, <span class="at">id.vars=</span><span class="st">"ORIGIN"</span>, <span class="at">variable.name=</span><span class="st">"DEV"</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">value.name=</span><span class="st">"VALUE"</span>, <span class="at">value.factor=</span><span class="cn">FALSE</span>,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">variable.factor=</span><span class="cn">FALSE</span>, <span class="at">na.rm=</span><span class="cn">TRUE</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert DEV back to numeric and order records.</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>DF2[,DEV<span class="sc">:</span><span class="er">=</span><span class="fu">as.integer</span>(DEV)]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">setorderv</span>(DF2, <span class="fu">c</span>(<span class="st">"ORIGIN"</span>, <span class="st">"DEV"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Test equivalence between DF and DF2:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">all.equal</span>(DF, DF2)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
</section>
<section id="method-iv-chainladder" class="level2">
<h2 class="anchored" data-anchor-id="method-iv-chainladder">Method IV: ChainLadder</h2>
<p><a href="https://cran.r-project.org/web/packages/ChainLadder/vignettes/ChainLadder.pdf">The ChainLadder package</a> provides various statistical methods which are typically used for the estimation of outstanding claims reserves in general insurance. It includes a suite of utilities that can be used to estimate outstanding claim liabilities, but those utilities will not be covered here. Of interest is the <code>triangle</code> class made available by the ChainLadder package. The <code>as.triangle</code> specification is provided below:</p>
<blockquote class="blockquote">
<p><code>as.triangle(Triangle, origin="origin", dev="dev", value="value",â€¦)</code></p>
</blockquote>
<p><code>Triangle</code> represents the transactional loss dataset. For <code>origin</code>, <code>dev</code> and <code>value</code>, specify the corresponding fieldnames present in the loss data. Referring again to the RAA dataset:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loss Triangle Compilation in R: Method IV.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ChainLadder"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>DF <span class="ot">=</span> <span class="fu">fread</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">file=</span>raaPath, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">row.names=</span><span class="cn">NULL</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fieldnames in DF are "ORIGIN", "DEV", "VALUE".</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>triData4 <span class="ot">=</span> <span class="fu">as.triangle</span>(DF, <span class="at">origin=</span><span class="st">"ORIGIN"</span>, <span class="at">dev=</span><span class="st">"DEV"</span>, <span class="at">value=</span><span class="st">"VALUE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>Inspecting triData4:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>ORIGIN    <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">3</span>    <span class="dv">4</span>    <span class="dv">5</span>    <span class="dv">6</span>    <span class="dv">7</span>   <span class="dv">8</span>   <span class="dv">9</span>  <span class="dv">10</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span> <span class="dv">5012</span> <span class="dv">3257</span> <span class="dv">2638</span>  <span class="dv">898</span> <span class="dv">1734</span> <span class="dv">2642</span> <span class="dv">1828</span> <span class="dv">599</span>  <span class="dv">54</span> <span class="dv">172</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">106</span> <span class="dv">4179</span> <span class="dv">1111</span> <span class="dv">5270</span> <span class="dv">3116</span> <span class="dv">1817</span> <span class="sc">-</span><span class="dv">103</span> <span class="dv">673</span> <span class="dv">535</span>  <span class="cn">NA</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span> <span class="dv">3410</span> <span class="dv">5582</span> <span class="dv">4881</span> <span class="dv">2268</span> <span class="dv">2594</span> <span class="dv">3479</span>  <span class="dv">649</span> <span class="dv">603</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">5655</span> <span class="dv">5900</span> <span class="dv">4211</span> <span class="dv">5500</span> <span class="dv">2159</span> <span class="dv">2658</span>  <span class="dv">984</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">1092</span> <span class="dv">8473</span> <span class="dv">6271</span> <span class="dv">6333</span> <span class="dv">3786</span>  <span class="dv">225</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">1513</span> <span class="dv">4932</span> <span class="dv">5257</span> <span class="dv">1233</span> <span class="dv">2917</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span>  <span class="dv">557</span> <span class="dv">3463</span> <span class="dv">6926</span> <span class="dv">1368</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">1351</span> <span class="dv">5596</span> <span class="dv">6165</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">3133</span> <span class="dv">2262</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">2063</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>   <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span>  <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>The ChainLadder package comes with two convenience functions that allow for conversion from incremental-to-cumulative or cumulative-to-incremental triangles, identified as <code>incr2cum</code> and <code>cum2incr</code> respectively. Next <code>incr2cum</code> is used to create the cumulative counterpart of <code>triData4</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4c <span class="ot">=</span> <span class="fu">incr2cum</span>(triData4)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4c</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>ORIGIN     <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">3</span>      <span class="dv">4</span>      <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span>     <span class="dv">8</span>     <span class="dv">9</span>    <span class="dv">10</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span>  <span class="dv">5012</span>  <span class="dv">8269</span> <span class="dv">10907</span>  <span class="dv">11805</span>  <span class="dv">13539</span>  <span class="dv">16181</span> <span class="dv">18009</span> <span class="dv">18608</span> <span class="dv">18662</span> <span class="dv">18834</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">5118</span> <span class="dv">12554</span> <span class="dv">16303</span>  <span class="dv">22471</span>  <span class="dv">27321</span>  <span class="dv">31780</span> <span class="dv">33505</span> <span class="dv">34777</span> <span class="dv">35366</span>    <span class="cn">NA</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span>  <span class="dv">8528</span> <span class="dv">21546</span> <span class="dv">30176</span>  <span class="dv">38612</span>  <span class="dv">46056</span>  <span class="dv">53994</span> <span class="dv">56368</span> <span class="dv">58243</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">14183</span> <span class="dv">33101</span> <span class="dv">45942</span>  <span class="dv">59878</span>  <span class="dv">69481</span>  <span class="dv">80077</span> <span class="dv">83435</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">15275</span> <span class="dv">42666</span> <span class="dv">61778</span>  <span class="dv">82047</span>  <span class="dv">95436</span> <span class="dv">106257</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">16788</span> <span class="dv">49111</span> <span class="dv">73480</span>  <span class="dv">94982</span> <span class="dv">111288</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span> <span class="dv">17345</span> <span class="dv">53131</span> <span class="dv">84426</span> <span class="dv">107296</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">18696</span> <span class="dv">60078</span> <span class="dv">97538</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">21829</span> <span class="dv">65473</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">23892</span>    <span class="cn">NA</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A point worth mentioning with respect to the behavior of <code>incr2cum</code> and <code>cum2incr</code>: After converting tabular loss data into a triangle object, there is no internal reference that tracks whether the data originally represented cumulative or incremental losses. If you have incremental losses that have been transformed into a triangle instance and then run <code>incr2cum</code> on that triangle, a triangle of incremental losses is returned as expected. However, if you pass that cumulative loss triangle <code>incr2cum</code> again, the function will cumulate the already cumulated losses. For example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in RAA.csv.</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> DF <span class="ot">=</span> <span class="fu">fread</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">file=</span>raaPath, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">","</span>, <span class="at">row.names=</span><span class="cn">NULL</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">stringsAsFactors=</span><span class="cn">FALSE</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4 <span class="ot">=</span> <span class="fu">as.triangle</span>(DF, <span class="at">origin=</span><span class="st">"ORIGIN"</span>, <span class="at">dev=</span><span class="st">"DEV"</span>, <span class="at">value=</span><span class="st">"VALUE"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4c <span class="ot">=</span> <span class="fu">incr2cum</span>(triData4)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span>triData4c</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>ORIGIN     <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">3</span>      <span class="dv">4</span>      <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span>     <span class="dv">8</span>     <span class="dv">9</span>    <span class="dv">10</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span>  <span class="dv">5012</span>  <span class="dv">8269</span> <span class="dv">10907</span>  <span class="dv">11805</span>  <span class="dv">13539</span>  <span class="dv">16181</span> <span class="dv">18009</span> <span class="dv">18608</span> <span class="dv">18662</span> <span class="dv">18834</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">5118</span> <span class="dv">12554</span> <span class="dv">16303</span>  <span class="dv">22471</span>  <span class="dv">27321</span>  <span class="dv">31780</span> <span class="dv">33505</span> <span class="dv">34777</span> <span class="dv">35366</span>    <span class="cn">NA</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span>  <span class="dv">8528</span> <span class="dv">21546</span> <span class="dv">30176</span>  <span class="dv">38612</span>  <span class="dv">46056</span>  <span class="dv">53994</span> <span class="dv">56368</span> <span class="dv">58243</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">14183</span> <span class="dv">33101</span> <span class="dv">45942</span>  <span class="dv">59878</span>  <span class="dv">69481</span>  <span class="dv">80077</span> <span class="dv">83435</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">15275</span> <span class="dv">42666</span> <span class="dv">61778</span>  <span class="dv">82047</span>  <span class="dv">95436</span> <span class="dv">106257</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">16788</span> <span class="dv">49111</span> <span class="dv">73480</span>  <span class="dv">94982</span> <span class="dv">111288</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span> <span class="dv">17345</span> <span class="dv">53131</span> <span class="dv">84426</span> <span class="dv">107296</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">18696</span> <span class="dv">60078</span> <span class="dv">97538</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">21829</span> <span class="dv">65473</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">23892</span>    <span class="cn">NA</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># So far so good...Pass triData4c to incr2cum again.</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4c2 <span class="ot">=</span> <span class="fu">incr2cum</span>(triData4c)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4c2</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>ORIGIN    <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">3</span>     <span class="dv">4</span>     <span class="dv">5</span>      <span class="dv">6</span>      <span class="dv">7</span>      <span class="dv">8</span>      <span class="dv">9</span>     <span class="dv">10</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span> <span class="dv">5012</span> <span class="dv">13281</span> <span class="dv">24188</span> <span class="dv">35993</span> <span class="dv">49532</span>  <span class="dv">65713</span>  <span class="dv">83722</span> <span class="dv">102330</span> <span class="dv">120992</span> <span class="dv">139826</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">106</span>  <span class="dv">4391</span>  <span class="dv">9787</span> <span class="dv">20453</span> <span class="dv">34235</span>  <span class="dv">49834</span>  <span class="dv">65330</span>  <span class="dv">81499</span>  <span class="dv">98203</span>     <span class="cn">NA</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span> <span class="dv">3410</span> <span class="dv">12402</span> <span class="dv">26275</span> <span class="dv">42416</span> <span class="dv">61151</span>  <span class="dv">83365</span> <span class="dv">106228</span> <span class="dv">129694</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">5655</span> <span class="dv">17210</span> <span class="dv">32976</span> <span class="dv">54242</span> <span class="dv">77667</span> <span class="dv">103750</span> <span class="dv">130817</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">1092</span> <span class="dv">10657</span> <span class="dv">26493</span> <span class="dv">48662</span> <span class="dv">74617</span> <span class="dv">100797</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">1513</span>  <span class="dv">7958</span> <span class="dv">19660</span> <span class="dv">32595</span> <span class="dv">48447</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span>  <span class="dv">557</span>  <span class="dv">4577</span> <span class="dv">15523</span> <span class="dv">27837</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">1351</span>  <span class="dv">8298</span> <span class="dv">21410</span>    <span class="cn">NA</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">3133</span>  <span class="dv">8528</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">2063</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>Pass triData4c2 to incr2cum again.</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4c3 <span class="ot">=</span> <span class="fu">incr2cum</span>(triData4c2)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> triData4c3</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>      DEV</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>ORIGIN    <span class="dv">1</span>     <span class="dv">2</span>     <span class="dv">3</span>      <span class="dv">4</span>      <span class="dv">5</span>      <span class="dv">6</span>      <span class="dv">7</span>      <span class="dv">8</span>      <span class="dv">9</span>     <span class="dv">10</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1981</span> <span class="dv">5012</span> <span class="dv">18293</span> <span class="dv">42481</span>  <span class="dv">78474</span> <span class="dv">128006</span> <span class="dv">193719</span> <span class="dv">277441</span> <span class="dv">379771</span> <span class="dv">500763</span> <span class="dv">640589</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1982</span>  <span class="dv">106</span>  <span class="dv">4497</span> <span class="dv">14284</span>  <span class="dv">34737</span>  <span class="dv">68972</span> <span class="dv">118806</span> <span class="dv">184136</span> <span class="dv">265635</span> <span class="dv">363838</span>     <span class="cn">NA</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1983</span> <span class="dv">3410</span> <span class="dv">15812</span> <span class="dv">42087</span>  <span class="dv">84503</span> <span class="dv">145654</span> <span class="dv">229019</span> <span class="dv">335247</span> <span class="dv">464941</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1984</span> <span class="dv">5655</span> <span class="dv">22865</span> <span class="dv">55841</span> <span class="dv">110083</span> <span class="dv">187750</span> <span class="dv">291500</span> <span class="dv">422317</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1985</span> <span class="dv">1092</span> <span class="dv">11749</span> <span class="dv">38242</span>  <span class="dv">86904</span> <span class="dv">161521</span> <span class="dv">262318</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1986</span> <span class="dv">1513</span>  <span class="dv">9471</span> <span class="dv">29131</span>  <span class="dv">61726</span> <span class="dv">110173</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1987</span>  <span class="dv">557</span>  <span class="dv">5134</span> <span class="dv">20657</span>  <span class="dv">48494</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1988</span> <span class="dv">1351</span>  <span class="dv">9649</span> <span class="dv">31059</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1989</span> <span class="dv">3133</span> <span class="dv">11661</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1990</span> <span class="dv">2063</span>    <span class="cn">NA</span>    <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span>     <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<p>This usually won’t be a problem, especially for the conscientious actuary. Just be sure to track the state of your data when relying on ChainLadder to convert between cumulative and incremental losses.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/www\.jtrive\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>